
<!doctype html>
<html lang="de" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://example.local/_historie/cursor_25.08.15_integration_von_mkdocs_in_python/">
      
      
      
      
      <link rel="icon" href="../../assets/images/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Integration von mkdocs in Python-Anwendung - Common Secretary Services</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#integration-von-mkdocs-in-python-anwendung" class="md-skip">
          Zum Inhalt
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Kopfzeile">
    <a href="../.." title="Common Secretary Services" class="md-header__button md-logo" aria-label="Common Secretary Services" data-md-component="logo">
      
  <img src="../../assets/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Common Secretary Services
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Integration von mkdocs in Python-Anwendung
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Suche" placeholder="Suche" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Suche">
        
        <button type="reset" class="md-search__icon md-icon" title="Zurücksetzen" aria-label="Zurücksetzen" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Suche wird initialisiert
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://example.local/repo" title="Zum Repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Example
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Common Secretary Services" class="md-nav__button md-logo" aria-label="Common Secretary Services" data-md-component="logo">
      
  <img src="../../assets/images/logo.png" alt="logo">

    </a>
    Common Secretary Services
  </label>
  
    <div class="md-nav__source">
      <a href="https://example.local/repo" title="Zum Repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Example
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    « Zur Anwendung
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/getting-started/development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UI
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            UI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/ui/dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dashboard
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    How‑Tos
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            How‑Tos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/how-tos/session-archive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Session‑Archive
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Explanations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Explanations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architektur
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Architektur
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/architecture/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Überblick
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/architecture/details/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Details
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Async Events
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Async Events
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/async-events/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Überblick
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/async-events/how-to-n8n/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    n8n
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/caching/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Caching
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/templates/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Templates
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/types/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Typen & Dataclasses
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/metaprocessor/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metaprocessor
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/metadata/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metadaten
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/llm/optimization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLM‑Optimierung
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Processors
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Processors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/audio/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Audio
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/video/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Video
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    PDF
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            PDF
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/pdf/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Überblick
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/pdf/ocr-refactoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OCR-Refactoring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/pdf/endpoints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PDF/ImageOCR Details
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/image-ocr/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Image-OCR
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/transformer/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transformer
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/session/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Session
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/event-job/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Event-Job
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/story/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Story
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/track/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Track
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Überblick
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/openapi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI / Swagger
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ops
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Ops
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deployment
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sicherheit
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Analysis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_analysis/docs_inventory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Doku-Inventur
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_analysis/routes_index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Routes-Index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_analysis/drift_audit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Drift-Audit
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Archiv (nur intern)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Archiv (nur intern)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/01_architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    01_architecture (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/02_installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    02_installation (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/03_development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    03_development (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/04_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    04_api (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/05_webinterface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    05_webinterface (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/06_audio_processing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    06_audio_processing (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/07_youtube/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    07_youtube (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/07_async_event_processing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    07_async_event_processing (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/07_async_event_processing_implementation.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    07_async_event_processing_implementation (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/08_templates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    08_templates (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/template_content_feature/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    template_content_feature (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/09_security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    09_security (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/10_development_guidelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    10_development_guidelines (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/11_security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    11_security (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/11_deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    11_deployment (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/12_troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    12_troubleshooting (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/13_api_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    13_api_reference (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/13_changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    13_changelog (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/14_changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    14_changelog (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/15_faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    15_faq (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/15_support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    15_support (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/CommonSecretaryServicesAPI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CommonSecretaryServicesAPI (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/HowToUseimageocr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HowToUseimageocr (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/swagger_llm_ocr_integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    swagger_llm_ocr_integration (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/vimeo_support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vimeo_support (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/api-responses-concept/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    api-responses-concept (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/concept_storytelling_processor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    concept_storytelling_processor (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/dataclasses-types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dataclasses-types (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    events (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/generic_typing_improvements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    generic_typing_improvements (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/historie/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    historie
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/linting_strategy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    linting_strategy (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/llm_ocr_configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    llm_ocr_configuration (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/llm_ocr_integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    llm_ocr_integration (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/llm-optimierung/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    llm-optimierung (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/localbrain_architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    localbrain_architecture (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/metadata-concept/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    metadata-concept (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/metaprocessor-concept/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    metaprocessor-* (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/mongodb_caching_implementation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mongodb_caching_implementation (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/n8nEventsProcessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    n8nEventsProcessing (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/optimizeProzessWithBaseprocess/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    optimizeProzessWithBaseprocess (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/process_events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    process_events (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/process-events-mongo-db/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    process-events-mongo-db (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/ProcessorArchitecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ProcessorArchitecture (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/refact-metaprocessor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    refact-metaprocessor (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/scrape-notion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    scrape-notion (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/session_archive_usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    session_archive_usage (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/storytelling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    storytelling (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/template_content_feature/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    template_content_feature (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/testroutine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    testroutine (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/track_processor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    track_processor (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/track-processor-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    track-processor-api (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/transformer_mongodb_caching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    transformer_mongodb_caching (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/type-migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    type-migration (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/videoprocessor_typisierung/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    videoprocessor_typisierung (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_archive/youtubeprocessor_typisierung/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    youtubeprocessor_typisierung (alt)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Inhaltsverzeichnis">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Inhaltsverzeichnis
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#was-ist-ublich" class="md-nav__link">
    <span class="md-ellipsis">
      Was ist üblich?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deine-integrierte-losung-jetzt-umgesetzt" class="md-nav__link">
    <span class="md-ellipsis">
      Deine integrierte Lösung (jetzt umgesetzt)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alternativen-falls-du-spater-anders-willst" class="md-nav__link">
    <span class="md-ellipsis">
      Alternativen (falls du später anders willst)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="integration-von-mkdocs-in-python-anwendung">Integration von mkdocs in Python-Anwendung<a class="headerlink" href="#integration-von-mkdocs-in-python-anwendung" title="Permanent link">&para;</a></h1>
<p><em>Exported on 8/15/2025 at 10:01:35 GMT+2 from Cursor (1.4.5)</em></p>
<hr />
<p><strong>User</strong></p>
<p>Ich hatte ja meine Python-Anwendung mit diesem Link @http://127.0.0.1:5001/ . und doe dokumentation mit @http://127.0.0.1:8000/<br />
Und wie könnte ich jetzt die Dokumentation vom mkdocs in diese Anwendung integrieren? Das Menüpunkt oben, Doc, sodass ich ein einheitliches User Experience habe. Oder läuft diese mkdocs immer als eigenständige Anwendung? Ich möchte es aber nur einmal deployen. oder ist das normalerweise nicht üblich?</p>
<hr />
<p><strong>Cursor</strong></p>
<p>Ich schaue mir kurz den Code und die Container-Konfiguration an, um herauszufinden, welches Web-Framework läuft und wie wir die MkDocs-HTML unter einem Pfad wie <code>/docs</code> mit ausliefern können. Danach schlage ich dir 2-3 saubere Varianten vor (inkl. minimaler Code-/Compose-Änderungen) für ein Single-Deployment mit einheitlicher UX. Ich starte mit einem kurzen Read der zentralen Dateien und einer Suche nach FastAPI/Flask.</p>
<p>Ich binde die bereits generierte MkDocs-Static-Site (<code>site/</code>) unter dem Pfad <code>/docs</code> in die bestehende Flask-App ein. Dafür erstelle ich eine neue Blueprint mit Routen für <code>index.html</code> und alle Unterpfade, registriere sie in <code>src/dashboard/app.py</code> und ergänze einen Menüpunkt "Docs" im Navbar-Template. Anschließend kannst du unter <code>http://127.0.0.1:5001/docs/</code> die Doku aus derselben App erreichen.</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Docs routes to serve the MkDocs-generated static site from the unified Flask app.</span>

<span class="sd">Diese Blueprint liefert die Inhalte des bereits gebauten MkDocs-Verzeichnisses</span>
<span class="sd">(`site/`) unter dem Pfad `/docs` aus. Damit kann die Anwendung und die Doku</span>
<span class="sd">aus einem Prozess/Container bereitgestellt werden (einheitliche Deployment-Unit).</span>

<span class="sd">Hinweis:</span>
<span class="sd">- Erwartet, dass das Verzeichnis `site/` im Projektwurzelverzeichnis existiert</span>
<span class="sd">  (wie bei `mkdocs build` üblich). In der lokalen Entwicklung kann die Doku mit</span>
<span class="sd">  `mkdocs serve` laufen; in Produktion sollte die statische Site mit ausgeliefert</span>
<span class="sd">  werden.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Blueprint</span><span class="p">,</span> <span class="n">abort</span><span class="p">,</span> <span class="n">send_from_directory</span>


<span class="c1"># Blueprint anlegen</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s2">&quot;docs&quot;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">)</span>


<span class="c1"># Absoluter Pfad zum MkDocs-Build-Verzeichnis (site)</span>
<span class="n">SITE_DIR</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="s2">&quot;site&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_site_path_exists</span><span class="p">(</span><span class="n">relative_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prüft, ob eine Datei oder ein Verzeichnis in `site/` existiert.&quot;&quot;&quot;</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">SITE_DIR</span> <span class="k">if</span> <span class="n">relative_path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="n">SITE_DIR</span> <span class="o">/</span> <span class="n">relative_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">target</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>


<span class="nd">@docs</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/docs/&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">docs_index</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Liefert die Startseite der Dokumentation (index.html).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_site_path_exists</span><span class="p">(</span><span class="s2">&quot;index.html&quot;</span><span class="p">):</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">SITE_DIR</span><span class="p">),</span> <span class="s2">&quot;index.html&quot;</span><span class="p">)</span>


<span class="nd">@docs</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/docs/&lt;path:filename&gt;&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">docs_files</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Liefert beliebige Dateien aus `site/` unterhalb von `/docs` aus.</span>

<span class="sd">    Unterstützt auch Verzeichnis-URLs, indem automatisch auf `index.html`</span>
<span class="sd">    innerhalb des Zielverzeichnisses zurückgegriffen wird.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Verzeichnis-URLs auf index.html abbilden</span>
    <span class="n">target_dir</span> <span class="o">=</span> <span class="n">SITE_DIR</span> <span class="o">/</span> <span class="n">filename</span>
    <span class="k">if</span> <span class="n">target_dir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
        <span class="n">index_file</span> <span class="o">=</span> <span class="n">target_dir</span> <span class="o">/</span> <span class="s2">&quot;index.html&quot;</span>
        <span class="k">if</span> <span class="n">index_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="c1"># Sicherstellen, dass der Pfad korrekt bleibt (z.B. &quot;guide/&quot;)</span>
            <span class="n">normalized</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/index.html&quot;</span>
            <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">SITE_DIR</span><span class="p">),</span> <span class="n">normalized</span><span class="p">)</span>

    <span class="c1"># Direkte Datei ausliefern, falls vorhanden</span>
    <span class="k">if</span> <span class="n">_site_path_exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">SITE_DIR</span><span class="p">),</span> <span class="n">filename</span><span class="p">)</span>

    <span class="c1"># Fallback auf 404 der Doku, falls vorhanden</span>
    <span class="k">if</span> <span class="n">_site_path_exists</span><span class="p">(</span><span class="s2">&quot;404.html&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">SITE_DIR</span><span class="p">),</span> <span class="s2">&quot;404.html&quot;</span><span class="p">),</span> <span class="mi">404</span>

    <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Main Flask application module.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">signal</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">atexit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">types</span><span class="w"> </span><span class="kn">import</span> <span class="n">FrameType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">NoReturn</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">src.api.routes</span><span class="w"> </span><span class="kn">import</span> <span class="n">blueprint</span> <span class="k">as</span> <span class="n">api_blueprint</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.utils.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_logger</span><span class="p">,</span> <span class="n">logger_service</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.mongodb</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_worker_manager</span><span class="p">,</span> <span class="n">close_mongodb_connection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.mongodb.cache_setup</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup_mongodb_caching</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.utils.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessingLogger</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.routes.config_routes</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.routes.log_routes</span><span class="w"> </span><span class="kn">import</span> <span class="n">logs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.routes.main_routes</span><span class="w"> </span><span class="kn">import</span> <span class="n">main</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.routes.docs_routes</span><span class="w"> </span><span class="kn">import</span> <span class="n">docs</span>

<span class="c1"># Reset Logger beim Start</span>
<span class="n">logger_service</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Nur Logger initialisieren, wenn es nicht der Reloader-Prozess ist</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WERKZEUG_RUN_MAIN&#39;</span><span class="p">):</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">ProcessingLogger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="n">process_id</span><span class="o">=</span><span class="s2">&quot;flask-app&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">ProcessingLogger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="n">process_id</span><span class="o">=</span><span class="s2">&quot;flask-app-reloader&quot;</span><span class="p">)</span>

<span class="c1"># Register blueprints</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">logs</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">api_blueprint</span><span class="p">,</span> <span class="n">url_prefix</span><span class="o">=</span><span class="s1">&#39;/api&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

<span class="c1"># Flag für den ersten Request</span>
<span class="n">_first_request</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># Worker-Manager-Instanz (Typ: SessionWorkerManager oder None)</span>
<span class="n">_worker_manager</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># Cache-Setup durchgeführt</span>
<span class="n">_cache_setup_done</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">def</span><span class="w"> </span><span class="nf">signal_handler</span><span class="p">(</span><span class="n">sig</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FrameType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handler für System-Signale (SIGINT, SIGTERM)</span>

<span class="sd">    Args:</span>
<span class="sd">        sig: Signal-Nummer</span>
<span class="sd">        frame: Stack-Frame (wird nicht verwendet)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WERKZEUG_RUN_MAIN&#39;</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Signal </span><span class="si">{</span><span class="n">sig</span><span class="si">}</span><span class="s2"> empfangen, beende Anwendung...&quot;</span><span class="p">)</span>

        <span class="c1"># Worker-Manager beenden</span>
        <span class="k">global</span> <span class="n">_worker_manager</span>
        <span class="k">if</span> <span class="n">_worker_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_worker_manager</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Worker-Manager beendet&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Beenden des Worker-Managers: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># MongoDB-Verbindung schließen</span>
        <span class="n">close_mongodb_connection</span><span class="p">()</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">before_request</span>
<span class="k">def</span><span class="w"> </span><span class="nf">before_request</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wird vor jedem Request ausgeführt&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_first_request</span><span class="p">,</span> <span class="n">_worker_manager</span><span class="p">,</span> <span class="n">_cache_setup_done</span>

    <span class="k">if</span> <span class="n">_first_request</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WERKZEUG_RUN_MAIN&#39;</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Erste Anfrage an die Anwendung&quot;</span><span class="p">)</span>

        <span class="c1"># MongoDB-Cache-Collections einrichten</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_cache_setup_done</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">setup_mongodb_caching</span><span class="p">(</span><span class="n">force_recreate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MongoDB-Cache-Collections eingerichtet&quot;</span><span class="p">)</span>
                <span class="n">_cache_setup_done</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Einrichten der Cache-Collections: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Worker-Manager starten</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_worker_manager</span> <span class="o">=</span> <span class="n">get_worker_manager</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">_worker_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_worker_manager</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Worker-Manager gestartet&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Worker-Manager ist deaktiviert (event_worker.active=False in config.yaml)&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Starten des Worker-Managers: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">_first_request</span> <span class="o">=</span> <span class="kc">False</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">teardown_appcontext</span>
<span class="k">def</span><span class="w"> </span><span class="nf">teardown_app</span><span class="p">(</span><span class="n">exception</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="ne">Exception</span><span class="p">,</span> <span class="ne">BaseException</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wird beim Beenden der Anwendung ausgeführt</span>

<span class="sd">    Args:</span>
<span class="sd">        exception: Optional auftretende Exception</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WERKZEUG_RUN_MAIN&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Anwendung wird mit Fehler beendet: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Funktion zum Aufräumen beim Beenden der Anwendung</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wird beim Beenden der Anwendung ausgeführt&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WERKZEUG_RUN_MAIN&#39;</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Anwendung wird beendet&quot;</span><span class="p">)</span>

        <span class="c1"># Worker-Manager stoppen</span>
        <span class="k">if</span> <span class="n">_worker_manager</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Worker-Manager wird gestoppt...&quot;</span><span class="p">)</span>
            <span class="n">_worker_manager</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

        <span class="c1"># MongoDB-Verbindung schließen</span>
        <span class="n">close_mongodb_connection</span><span class="p">()</span>

<span class="c1"># Registriere Cleanup-Funktion</span>
<span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">cleanup</span><span class="p">)</span>

<span class="c1"># Registriere Signal-Handler</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>   <span class="c1"># Ctrl+C</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>  <span class="c1"># Termination request </span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Secretary Services Dashboard<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>
    {% block extra_css %}{% endblock %}
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar navbar-expand-lg navbar-dark bg-dark&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container-fluid&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-brand&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;main.home&#39;) }}&quot;</span><span class="p">&gt;</span>Secretary Services v0.1.44<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-toggler&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">data-bs-toggle</span><span class="o">=</span><span class="s">&quot;collapse&quot;</span> <span class="na">data-bs-target</span><span class="o">=</span><span class="s">&quot;#navbarNav&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-toggler-icon&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;collapse navbar-collapse&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;navbarNav&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-nav&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link {% if request.endpoint == &#39;main.home&#39; %}active{% endif %}&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;main.home&#39;) }}&quot;</span><span class="p">&gt;</span>Dashboard<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link {% if request.endpoint == &#39;main.logs&#39; %}active{% endif %}&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;main.logs&#39;) }}&quot;</span><span class="p">&gt;</span>Logs<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link {% if request.endpoint == &#39;main.event_monitor&#39; %}active{% endif %}&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;main.event_monitor&#39;) }}&quot;</span><span class="p">&gt;</span>Event-Monitor<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link {% if request.endpoint == &#39;main.config_page&#39; %}active{% endif %}&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;main.config_page&#39;) }}&quot;</span><span class="p">&gt;</span>Config<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link {% if request.endpoint == &#39;main.test_procedures&#39; %}active{% endif %}&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;main.test_procedures&#39;) }}&quot;</span><span class="p">&gt;</span>Tests<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/api/doc&quot;</span><span class="p">&gt;</span>API<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/docs/&quot;</span><span class="p">&gt;</span>Docs<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container mt-4&quot;</span><span class="p">&gt;</span>
        {% block content %}{% endblock %}
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://code.jquery.com/jquery-3.6.0.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    {% block scripts %}{% endblock %}
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span> 
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Main Flask application module.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">signal</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">atexit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">types</span><span class="w"> </span><span class="kn">import</span> <span class="n">FrameType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">NoReturn</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">src.api.routes</span><span class="w"> </span><span class="kn">import</span> <span class="n">blueprint</span> <span class="k">as</span> <span class="n">api_blueprint</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.utils.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_logger</span><span class="p">,</span> <span class="n">logger_service</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.mongodb</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_worker_manager</span><span class="p">,</span> <span class="n">close_mongodb_connection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.mongodb.cache_setup</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup_mongodb_caching</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.utils.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessingLogger</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.routes.config_routes</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.routes.log_routes</span><span class="w"> </span><span class="kn">import</span> <span class="n">logs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.routes.main_routes</span><span class="w"> </span><span class="kn">import</span> <span class="n">main</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.routes.docs_routes</span><span class="w"> </span><span class="kn">import</span> <span class="n">docs</span>

<span class="c1"># Reset Logger beim Start</span>
<span class="n">logger_service</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Nur Logger initialisieren, wenn es nicht der Reloader-Prozess ist</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WERKZEUG_RUN_MAIN&#39;</span><span class="p">):</span>
    <span class="n">app_logger</span><span class="p">:</span> <span class="n">ProcessingLogger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="n">process_id</span><span class="o">=</span><span class="s2">&quot;flask-app&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">app_logger</span><span class="p">:</span> <span class="n">ProcessingLogger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="n">process_id</span><span class="o">=</span><span class="s2">&quot;flask-app-reloader&quot;</span><span class="p">)</span>

<span class="c1"># Register blueprints</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">logs</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">api_blueprint</span><span class="p">,</span> <span class="n">url_prefix</span><span class="o">=</span><span class="s1">&#39;/api&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

<span class="c1"># Flag für den ersten Request</span>
<span class="n">_first_request</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># Worker-Manager-Instanz (Typ: SessionWorkerManager oder None)</span>
<span class="n">_worker_manager</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># Cache-Setup durchgeführt</span>
<span class="n">_cache_setup_done</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">def</span><span class="w"> </span><span class="nf">signal_handler</span><span class="p">(</span><span class="n">sig</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FrameType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handler für System-Signale (SIGINT, SIGTERM)</span>

<span class="sd">    Args:</span>
<span class="sd">        sig: Signal-Nummer</span>
<span class="sd">        frame: Stack-Frame (wird nicht verwendet)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WERKZEUG_RUN_MAIN&#39;</span><span class="p">):</span>
        <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Signal </span><span class="si">{</span><span class="n">sig</span><span class="si">}</span><span class="s2"> empfangen, beende Anwendung...&quot;</span><span class="p">)</span>

        <span class="c1"># Worker-Manager beenden</span>
        <span class="k">global</span> <span class="n">_worker_manager</span>
        <span class="k">if</span> <span class="n">_worker_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_worker_manager</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Worker-Manager beendet&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">app_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Beenden des Worker-Managers: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># MongoDB-Verbindung schließen</span>
        <span class="n">close_mongodb_connection</span><span class="p">()</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">before_request</span>
<span class="k">def</span><span class="w"> </span><span class="nf">before_request</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wird vor jedem Request ausgeführt&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_first_request</span><span class="p">,</span> <span class="n">_worker_manager</span><span class="p">,</span> <span class="n">_cache_setup_done</span>

    <span class="k">if</span> <span class="n">_first_request</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WERKZEUG_RUN_MAIN&#39;</span><span class="p">):</span>
        <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Erste Anfrage an die Anwendung&quot;</span><span class="p">)</span>

        <span class="c1"># MongoDB-Cache-Collections einrichten</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_cache_setup_done</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">setup_mongodb_caching</span><span class="p">(</span><span class="n">force_recreate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MongoDB-Cache-Collections eingerichtet&quot;</span><span class="p">)</span>
                <span class="n">_cache_setup_done</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">app_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Einrichten der Cache-Collections: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Worker-Manager starten</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_worker_manager</span> <span class="o">=</span> <span class="n">get_worker_manager</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">_worker_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_worker_manager</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Worker-Manager gestartet&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Worker-Manager ist deaktiviert (event_worker.active=False in config.yaml)&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">app_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Starten des Worker-Managers: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">_first_request</span> <span class="o">=</span> <span class="kc">False</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">teardown_appcontext</span>
<span class="k">def</span><span class="w"> </span><span class="nf">teardown_app</span><span class="p">(</span><span class="n">exception</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="ne">Exception</span><span class="p">,</span> <span class="ne">BaseException</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wird beim Beenden der Anwendung ausgeführt</span>

<span class="sd">    Args:</span>
<span class="sd">        exception: Optional auftretende Exception</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WERKZEUG_RUN_MAIN&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exception</span><span class="p">:</span>
            <span class="n">app_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Anwendung wird mit Fehler beendet: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Funktion zum Aufräumen beim Beenden der Anwendung</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wird beim Beenden der Anwendung ausgeführt&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WERKZEUG_RUN_MAIN&#39;</span><span class="p">):</span>
        <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Anwendung wird beendet&quot;</span><span class="p">)</span>

        <span class="c1"># Worker-Manager stoppen</span>
        <span class="k">if</span> <span class="n">_worker_manager</span><span class="p">:</span>
            <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Worker-Manager wird gestoppt...&quot;</span><span class="p">)</span>
            <span class="n">_worker_manager</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

        <span class="c1"># MongoDB-Verbindung schließen</span>
        <span class="n">close_mongodb_connection</span><span class="p">()</span>

<span class="c1"># Registriere Cleanup-Funktion</span>
<span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">cleanup</span><span class="p">)</span>

<span class="c1"># Registriere Signal-Handler</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>   <span class="c1"># Ctrl+C</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>  <span class="c1"># Termination request </span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Main Flask application module.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">signal</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">atexit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">types</span><span class="w"> </span><span class="kn">import</span> <span class="n">FrameType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">NoReturn</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">src.api.routes</span><span class="w"> </span><span class="kn">import</span> <span class="n">blueprint</span> <span class="k">as</span> <span class="n">api_blueprint</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.utils.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_logger</span><span class="p">,</span> <span class="n">logger_service</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.mongodb</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_worker_manager</span><span class="p">,</span> <span class="n">close_mongodb_connection</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.mongodb.cache_setup</span><span class="w"> </span><span class="kn">import</span> <span class="n">setup_mongodb_caching</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.utils.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessingLogger</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.routes.config_routes</span><span class="w"> </span><span class="kn">import</span> <span class="n">config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.routes.log_routes</span><span class="w"> </span><span class="kn">import</span> <span class="n">logs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.routes.main_routes</span><span class="w"> </span><span class="kn">import</span> <span class="n">main</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.routes.docs_routes</span><span class="w"> </span><span class="kn">import</span> <span class="n">docs</span>

<span class="c1"># Reset Logger beim Start</span>
<span class="n">logger_service</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Nur Logger initialisieren, wenn es nicht der Reloader-Prozess ist</span>
<span class="n">app_logger</span><span class="p">:</span> <span class="n">ProcessingLogger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="n">process_id</span><span class="o">=</span><span class="s2">&quot;flask-app&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WERKZEUG_RUN_MAIN&#39;</span><span class="p">):</span>
    <span class="n">app_logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="n">process_id</span><span class="o">=</span><span class="s2">&quot;flask-app-reloader&quot;</span><span class="p">)</span>

<span class="c1"># Register blueprints</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">logs</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">api_blueprint</span><span class="p">,</span> <span class="n">url_prefix</span><span class="o">=</span><span class="s1">&#39;/api&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

<span class="c1"># Flag für den ersten Request</span>
<span class="n">_first_request</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># Worker-Manager-Instanz (Typ: SessionWorkerManager oder None)</span>
<span class="n">_worker_manager</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c1"># Cache-Setup durchgeführt</span>
<span class="n">_cache_setup_done</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">def</span><span class="w"> </span><span class="nf">signal_handler</span><span class="p">(</span><span class="n">sig</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FrameType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handler für System-Signale (SIGINT, SIGTERM)</span>

<span class="sd">    Args:</span>
<span class="sd">        sig: Signal-Nummer</span>
<span class="sd">        frame: Stack-Frame (wird nicht verwendet)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WERKZEUG_RUN_MAIN&#39;</span><span class="p">):</span>
        <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Signal </span><span class="si">{</span><span class="n">sig</span><span class="si">}</span><span class="s2"> empfangen, beende Anwendung...&quot;</span><span class="p">)</span>

        <span class="c1"># Worker-Manager beenden</span>
        <span class="k">global</span> <span class="n">_worker_manager</span>
        <span class="k">if</span> <span class="n">_worker_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_worker_manager</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Worker-Manager beendet&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">app_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Beenden des Worker-Managers: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># MongoDB-Verbindung schließen</span>
        <span class="n">close_mongodb_connection</span><span class="p">()</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">before_request</span>
<span class="k">def</span><span class="w"> </span><span class="nf">before_request</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wird vor jedem Request ausgeführt&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_first_request</span><span class="p">,</span> <span class="n">_worker_manager</span><span class="p">,</span> <span class="n">_cache_setup_done</span>

    <span class="k">if</span> <span class="n">_first_request</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WERKZEUG_RUN_MAIN&#39;</span><span class="p">):</span>
        <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Erste Anfrage an die Anwendung&quot;</span><span class="p">)</span>

        <span class="c1"># MongoDB-Cache-Collections einrichten</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_cache_setup_done</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">setup_mongodb_caching</span><span class="p">(</span><span class="n">force_recreate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;MongoDB-Cache-Collections eingerichtet&quot;</span><span class="p">)</span>
                <span class="n">_cache_setup_done</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">app_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Einrichten der Cache-Collections: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Worker-Manager starten</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_worker_manager</span> <span class="o">=</span> <span class="n">get_worker_manager</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">_worker_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_worker_manager</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Worker-Manager gestartet&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Worker-Manager ist deaktiviert (event_worker.active=False in config.yaml)&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">app_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Starten des Worker-Managers: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">_first_request</span> <span class="o">=</span> <span class="kc">False</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">teardown_appcontext</span>
<span class="k">def</span><span class="w"> </span><span class="nf">teardown_app</span><span class="p">(</span><span class="n">exception</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="ne">Exception</span><span class="p">,</span> <span class="ne">BaseException</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wird beim Beenden der Anwendung ausgeführt</span>

<span class="sd">    Args:</span>
<span class="sd">        exception: Optional auftretende Exception</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WERKZEUG_RUN_MAIN&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exception</span><span class="p">:</span>
            <span class="n">app_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Anwendung wird mit Fehler beendet: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Funktion zum Aufräumen beim Beenden der Anwendung</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wird beim Beenden der Anwendung ausgeführt&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WERKZEUG_RUN_MAIN&#39;</span><span class="p">):</span>
        <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Anwendung wird beendet&quot;</span><span class="p">)</span>

        <span class="c1"># Worker-Manager stoppen</span>
        <span class="k">if</span> <span class="n">_worker_manager</span><span class="p">:</span>
            <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Worker-Manager wird gestoppt...&quot;</span><span class="p">)</span>
            <span class="n">_worker_manager</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

        <span class="c1"># MongoDB-Verbindung schließen</span>
        <span class="n">close_mongodb_connection</span><span class="p">()</span>

<span class="c1"># Registriere Cleanup-Funktion</span>
<span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">cleanup</span><span class="p">)</span>

<span class="c1"># Registriere Signal-Handler</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>   <span class="c1"># Ctrl+C</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>  <span class="c1"># Termination request </span>
</code></pre></div>
<p>Kurzer Stand: Ich habe die vorhandene Flask-App identifiziert und die bereits gebaute MkDocs-Site (<code>site/</code>) als statische Dateien unter dem Pfad <code>/docs</code> integriert. Dazu gibt es jetzt eine Blueprint, die alles unter <code>/docs</code> ausliefert, sowie einen Menüpunkt „Docs“ in der Navbar.</p>
<h3 id="was-ist-ublich">Was ist üblich?<a class="headerlink" href="#was-ist-ublich" title="Permanent link">&para;</a></h3>
<ul>
<li>MkDocs muss nicht als separater Server laufen. Häufig wird die gebaute statische Site mit derselben App ausgeliefert (einheitliches Deployment).</li>
<li>Alternativ: getrennte Services hinter einem Reverse-Proxy unter einem Pfad wie <code>/docs</code>. Ist aber nicht nötig, wenn du es einfach halten willst.</li>
</ul>
<h3 id="deine-integrierte-losung-jetzt-umgesetzt">Deine integrierte Lösung (jetzt umgesetzt)<a class="headerlink" href="#deine-integrierte-losung-jetzt-umgesetzt" title="Permanent link">&para;</a></h3>
<ul>
<li>Neuer Blueprint <code>docs</code> liefert <code>site/</code> unter <code>/docs</code> aus.</li>
<li>Navbar hat Eintrag „Docs“, der auf <code>/docs/</code> zeigt.</li>
<li>Single-Deployment bleibt erhalten; kein zweiter Port nötig.</li>
</ul>
<p>Testen:
- Starte wie gewohnt (lokal): <code>venv\Scripts\activate; $env:PYTHONPATH = "."; python src/main.py</code>
- Öffne <code>http://127.0.0.1:5001/docs/</code> und eine Unterseite z. B. <code>http://127.0.0.1:5001/docs/guide/getting-started/</code>.
- Falls du die Doku neu bauen willst: <code>mkdocs build -c -d site</code> (vor dem Start). In Docker genügt <code>docker-compose up --build</code>, wenn <code>site/</code> im Repo liegt.</p>
<h3 id="alternativen-falls-du-spater-anders-willst">Alternativen (falls du später anders willst)<a class="headerlink" href="#alternativen-falls-du-spater-anders-willst" title="Permanent link">&para;</a></h3>
<ul>
<li>Reverse-Proxy: App bleibt auf <code>:5001</code>, MkDocs als zweiter Container, aber via Nginx/Traefik unter <code>/docs</code> gemountet (auch Single-Entry-Domain).</li>
<li>Build-Time-Integration: Im Dockerfile <code>mkdocs build</code> ausführen und <code>site/</code> ins Image kopieren. Vorteil: Immer konsistent, keine lokalen Artefakte nötig. Nachteil: <code>mkdocs</code> muss im Build installiert sein.</li>
</ul>
<p>Hinweise:
- Deine <code>site/</code> ist bereits im Repo. Dadurch wird sie mit ins Image kopiert und lokal ausgeliefert. Wenn du stattdessen immer frisch bauen willst, ergänzen wir im Dockerfile optional <code>RUN pip install mkdocs mkdocs-material &amp;&amp; mkdocs build -c -d site</code>.</p>
<p>Kurz wie umgesetzt:
- Neue Routen in <code>src/dashboard/routes/docs_routes.py</code> zum Ausliefern von <code>site/</code> unter <code>/docs</code> (inkl. Directory-Index-Handhabung).
- Blueprint-Registrierung in <code>src/dashboard/app.py</code>.
- Navbar-Link „Docs“ in <code>src/dashboard/templates/base.html</code>.</p>
<p>Zusammenfassung
- Docs unter <code>/docs</code> in die Flask-App integriert; Menü „Docs“ ergänzt.
- Single-Deployment ohne zweiten Server/Port.
- Dateien: <code>src/dashboard/routes/docs_routes.py</code>, <code>src/dashboard/app.py</code>, <code>src/dashboard/templates/base.html</code>.
- Test: Starten und <code>http://127.0.0.1:5001/docs/</code> aufrufen; bei Bedarf <code>mkdocs build -c -d site</code> ausführen.</p>
<hr />
<p><strong>User</strong></p>
<!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>


---

**Cursor**

Ich prüfe, ob das Verzeichnis `site/` und insbesondere `site/index.html` vorhanden ist, da die Route `/docs/` genau diese Datei erwartet. Falls es fehlt, müssen wir `mkdocs build` ausführen. Danach leite ich dich an, wie du es lokal testest.

<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Docs routes to serve the MkDocs-generated static site from the unified Flask app.</span>

<span class="sd">Diese Blueprint liefert die Inhalte des bereits gebauten MkDocs-Verzeichnisses</span>
<span class="sd">(`site/`) unter dem Pfad `/docs` aus. Damit kann die Anwendung und die Doku</span>
<span class="sd">aus einem Prozess/Container bereitgestellt werden (einheitliche Deployment-Unit).</span>

<span class="sd">Hinweis:</span>
<span class="sd">- Erwartet, dass das Verzeichnis `site/` im Projektwurzelverzeichnis existiert</span>
<span class="sd">  (wie bei `mkdocs build` üblich). In der lokalen Entwicklung kann die Doku mit</span>
<span class="sd">  `mkdocs serve` laufen; in Produktion sollte die statische Site mit ausgeliefert</span>
<span class="sd">  werden.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Blueprint</span><span class="p">,</span> <span class="n">abort</span><span class="p">,</span> <span class="n">send_from_directory</span><span class="p">,</span> <span class="n">redirect</span>


<span class="c1"># Blueprint anlegen</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s2">&quot;docs&quot;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">)</span>


<span class="c1"># Absoluter Pfad zum MkDocs-Build-Verzeichnis (site)</span>
<span class="n">SITE_DIR</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="s2">&quot;site&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_site_path_exists</span><span class="p">(</span><span class="n">relative_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prüft, ob eine Datei oder ein Verzeichnis in `site/` existiert.&quot;&quot;&quot;</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">SITE_DIR</span> <span class="k">if</span> <span class="n">relative_path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="n">SITE_DIR</span> <span class="o">/</span> <span class="n">relative_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">target</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>


<span class="nd">@docs</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/docs&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">docs_slash_redirect</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sorge dafür, dass `/docs` auf `/docs/` weiterleitet (kanonische URL).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s2">&quot;/docs/&quot;</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mi">301</span><span class="p">)</span>


<span class="nd">@docs</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/docs/&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">docs_index</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Liefert die Startseite der Dokumentation (index.html).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">_site_path_exists</span><span class="p">(</span><span class="s2">&quot;index.html&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">SITE_DIR</span><span class="p">),</span> <span class="s2">&quot;index.html&quot;</span><span class="p">)</span>

    <span class="c1"># Fallback: auf die erste Sektion mit index.html weiterleiten</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">SITE_DIR</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="n">entry</span> <span class="o">/</span> <span class="s2">&quot;index.html&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/docs/</span><span class="si">{</span><span class="n">entry</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>

    <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>


<span class="nd">@docs</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/docs/&lt;path:filename&gt;&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">docs_files</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Liefert beliebige Dateien aus `site/` unterhalb von `/docs` aus.</span>

<span class="sd">    Unterstützt auch Verzeichnis-URLs, indem automatisch auf `index.html`</span>
<span class="sd">    innerhalb des Zielverzeichnisses zurückgegriffen wird.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Verzeichnis-URLs auf index.html abbilden</span>
    <span class="n">target_dir</span> <span class="o">=</span> <span class="n">SITE_DIR</span> <span class="o">/</span> <span class="n">filename</span>
    <span class="k">if</span> <span class="n">target_dir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
        <span class="n">index_file</span> <span class="o">=</span> <span class="n">target_dir</span> <span class="o">/</span> <span class="s2">&quot;index.html&quot;</span>
        <span class="k">if</span> <span class="n">index_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="c1"># Sicherstellen, dass der Pfad korrekt bleibt (z.B. &quot;guide/&quot;)</span>
            <span class="n">normalized</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/index.html&quot;</span>
            <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">SITE_DIR</span><span class="p">),</span> <span class="n">normalized</span><span class="p">)</span>

    <span class="c1"># Direkte Datei ausliefern, falls vorhanden</span>
    <span class="k">if</span> <span class="n">_site_path_exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">SITE_DIR</span><span class="p">),</span> <span class="n">filename</span><span class="p">)</span>

    <span class="c1"># Fallback auf 404 der Doku, falls vorhanden</span>
    <span class="k">if</span> <span class="n">_site_path_exists</span><span class="p">(</span><span class="s2">&quot;404.html&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">SITE_DIR</span><span class="p">),</span> <span class="s2">&quot;404.html&quot;</span><span class="p">),</span> <span class="mi">404</span>

    <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</code></pre></div>

Danke für den Hinweis. Ursache: Der Einstiegspunkt `/docs/` erwartete `site/index.html`. In deinem `site/`-Ordner ist aber offenbar kein `index.html` auf Top-Level, sondern nur in Unterverzeichnissen (z. B. `01_architecture/index.html`). Ich habe die Doku-Blueprint so erweitert, dass:
- Aufruf von `/docs` hart auf `/docs/` weiterleitet.
- `/docs/` zuerst `site/index.html` liefert, falls vorhanden.
- Falls nicht vorhanden, automatisch auf die erste verfügbare Sektion mit `index.html` (z. B. `/docs/01_architecture/`) weiterleitet.

Bitte neu laden:
- `http://127.0.0.1:5001/docs` → wird zu `/docs/` umgeleitet → sollte jetzt auf eine vorhandene Untersektion weiterleiten.
- Einzelne Seiten direkt: z. B. `http://127.0.0.1:5001/docs/01_architecture/` oder `http://127.0.0.1:5001/docs/guide/getting-started/`.

Optional: Wenn du eine echte Startseite willst
- Füge eine `index.md` in `docs/` hinzu und baue neu: `mkdocs build -c -d site`. Dann liefert `/docs/` direkt `site/index.html`.

Kurzfazit
- 404 behoben durch Redirect-Logik und robusteren Index-Fallback.
- `/docs` und alle Unterpfade sollten nun funktionieren.

---

**User**

wir haben jetzt eine Startseite docs/index.md - diese sollte geöffnet werden.
Wenn ich de Dokumentation aus der Anwendung heraus öffne, verliere ich aber die Top-Navigation. Kann man das irgendwie stehen lassen, sodass ich jederzeit wieder zurückwechseln kann in die Anwendung?

---

**Cursor**

Ich füge eine Wrapper-Seite mit iframe hinzu, damit die App-Top-Navigation sichtbar bleibt, und passe den Navbar-Link auf diese neue Route an. Anschließend lege ich das zugehörige Template an.

<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Main routes for the dashboard application.</span>
<span class="sd">Contains the main dashboard view and test routes.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Blueprint</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">current_app</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span><span class="p">,</span> <span class="n">timezone</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">cast</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">ApplicationConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.models.job_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Batch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.utils.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessingLogger</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_system_info</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">Config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.utils.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_logger</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.tests</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_youtube_test</span><span class="p">,</span> <span class="n">run_audio_test</span><span class="p">,</span> <span class="n">run_transformer_test</span><span class="p">,</span> <span class="n">run_health_test</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>  <span class="c1"># Neu hinzugefügt für API-Anfragen</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">markdown</span>  <span class="c1"># type: ignore</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.mongodb.repository</span><span class="w"> </span><span class="kn">import</span> <span class="n">SessionJobRepository</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.mongodb</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_job_repository</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.models.job_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">JobStatus</span>

<span class="c1"># Create the blueprint</span>
<span class="n">main</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="p">:</span> <span class="n">ProcessingLogger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="n">process_id</span><span class="o">=</span><span class="s2">&quot;dashboard&quot;</span><span class="p">)</span>

<span class="c1"># Funktion zur Markdown-Konvertierung</span>
<span class="k">def</span><span class="w"> </span><span class="nf">render_markdown</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Konvertiert Markdown-Text in HTML&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">load_logs_for_requests</span><span class="p">(</span><span class="n">recent_requests</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load log entries for a list of requests from the detailed log file</span>

<span class="sd">    Args:</span>
<span class="sd">        recent_requests (list): List of request entries to load logs for</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Dictionary mapping process_ids to their log entries</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Lade Log-Pfad aus der Konfiguration</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
    <span class="n">log_file</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_all</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;logging&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;logs/detailed.log&#39;</span><span class="p">)</span>
    <span class="n">log_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="n">log_file</span><span class="p">)</span>
    <span class="n">request_logs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">current_entry</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">details_lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">collecting_details</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="c1"># Check if this is a new log entry</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d</span><span class="si">{4}</span><span class="s1">-\d</span><span class="si">{2}</span><span class="s1">-\d</span><span class="si">{2}</span><span class="s1"> \d</span><span class="si">{2}</span><span class="s1">:\d</span><span class="si">{2}</span><span class="s1">:\d</span><span class="si">{2}</span><span class="s1">,\d</span><span class="si">{3}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                    <span class="c1"># Save previous entry if exists</span>
                    <span class="k">if</span> <span class="n">current_entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">details_lines</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">details_text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">details_lines</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">details_text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Details: &#39;</span><span class="p">):</span>
                                    <span class="n">details_text</span> <span class="o">=</span> <span class="n">details_text</span><span class="p">[</span><span class="mi">9</span><span class="p">:]</span>
                                <span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">details_text</span><span class="p">))</span>
                            <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
                                <span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;raw&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">details_lines</span><span class="p">)})</span>

                        <span class="k">if</span> <span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;process_id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">request_logs</span><span class="p">:</span>
                            <span class="n">request_logs</span><span class="p">[</span><span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;process_id&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_entry</span><span class="p">)</span>

                    <span class="c1"># Parse new entry</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; - &#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">level</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">source</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># [logger.py:97]</span>
                        <span class="n">process_info</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># [TransformerProcessor] Process[1735640951800]</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39; - &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span>  <span class="c1"># Join remaining parts in case message contains &#39; - &#39;</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Extrahiere processor_name und process_id</span>
                            <span class="c1"># Format: &quot;[YoutubeProcessor] Process[1735641423754]&quot;</span>
                            <span class="k">if</span> <span class="s1">&#39;] Process[&#39;</span> <span class="ow">in</span> <span class="n">process_info</span><span class="p">:</span>
                                <span class="n">parts</span> <span class="o">=</span> <span class="n">process_info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;] Process[&#39;</span><span class="p">)</span>
                                <span class="n">processor_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span>  <span class="c1"># YoutubeProcessor</span>
                                <span class="n">process_id</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>      <span class="c1"># 1735641423754</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">processor_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                                <span class="n">process_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                            <span class="c1"># Initialize logs list for process_id if it&#39;s in recent requests</span>
                            <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;process_id&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">process_id</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="n">process_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">request_logs</span><span class="p">:</span>
                                        <span class="n">request_logs</span><span class="p">[</span><span class="n">process_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                            <span class="n">current_entry</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                                <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="n">level</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                                <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">source</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">),</span>
                                <span class="s1">&#39;processor_name&#39;</span><span class="p">:</span> <span class="n">processor_name</span><span class="p">,</span>
                                <span class="s1">&#39;process_id&#39;</span><span class="p">:</span> <span class="n">process_id</span><span class="p">,</span>
                                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="p">}</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error parsing log line: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">current_entry</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                                <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="n">level</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                                <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">source</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">),</span>
                                <span class="s1">&#39;processor_name&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                <span class="s1">&#39;process_id&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="p">}</span>
                        <span class="n">details_lines</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">collecting_details</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1"># Check if this is the start of details</span>
                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Details: &#39;</span><span class="p">):</span>
                    <span class="n">collecting_details</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">details_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">]</span>

                <span class="c1"># Add to details if we&#39;re collecting them</span>
                <span class="k">elif</span> <span class="n">collecting_details</span> <span class="ow">and</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">details_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>


            <span class="c1"># Don&#39;t forget to add the last entry</span>
            <span class="k">if</span> <span class="n">current_entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">details_lines</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">details_text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">details_lines</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">details_text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Details: &#39;</span><span class="p">):</span>
                            <span class="n">details_text</span> <span class="o">=</span> <span class="n">details_text</span><span class="p">[</span><span class="mi">9</span><span class="p">:]</span>
                        <span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">details_text</span><span class="p">))</span>
                    <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
                        <span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;raw&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">details_lines</span><span class="p">)})</span>

                <span class="c1"># Add to request logs if process_id matches</span>
                <span class="k">if</span> <span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;process_id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">request_logs</span><span class="p">:</span>
                    <span class="n">request_logs</span><span class="p">[</span><span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;process_id&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_entry</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading log file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">request_logs</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">home</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dashboard main page route.</span>
<span class="sd">    Displays statistics about recent requests.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize statistics</span>
    <span class="n">stats</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;total_requests&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;avg_duration&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s1">&#39;success_rate&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s1">&#39;total_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;hourly_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;operations&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;processor_stats&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;hourly_stats&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;recent_requests&#39;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Load performance data</span>
        <span class="n">perf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;logs&#39;</span><span class="p">,</span> <span class="s1">&#39;performance.json&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading performance data from </span><span class="si">{</span><span class="n">perf_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">perf_path</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Performance file not found at </span><span class="si">{</span><span class="n">perf_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;dashboard.html&#39;</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span> <span class="n">system_info</span><span class="o">=</span><span class="n">get_system_info</span><span class="p">())</span>

        <span class="c1"># Prüfe, ob die Datei leer ist</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">perf_path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Performance file is empty&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;dashboard.html&#39;</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span> <span class="n">system_info</span><span class="o">=</span><span class="n">get_system_info</span><span class="p">())</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">perf_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">perf_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">perf_data</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Performance data is empty&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;dashboard.html&#39;</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span> <span class="n">system_info</span><span class="o">=</span><span class="n">get_system_info</span><span class="p">())</span>

        <span class="c1"># Calculate time window</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="n">day_ago</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Filter recent requests and ensure timestamp is valid</span>
        <span class="n">recent_requests</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">perf_data</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;+00:00&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">timestamp</span> <span class="o">&gt;</span> <span class="n">day_ago</span><span class="p">:</span>
                    <span class="n">r</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
                    <span class="n">recent_requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing request timestamp: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="k">if</span> <span class="n">recent_requests</span><span class="p">:</span>
            <span class="c1"># Basic statistics</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_requests&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_requests</span><span class="p">)</span>
            <span class="n">total_duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_duration&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">)</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;avg_duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_duration</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_requests</span><span class="p">)</span>

            <span class="c1"># Success rate calculation</span>
            <span class="n">success_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recent_requests</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;success&#39;</span><span class="p">)</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;success_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">success_count</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_requests</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>

            <span class="c1"># Token calculation</span>
            <span class="n">total_tokens</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_tokens&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">)</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;hourly_tokens&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_tokens</span> <span class="o">//</span> <span class="mi">24</span> <span class="k">if</span> <span class="n">total_tokens</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

            <span class="c1"># Operation statistics</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;operations&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">op_name</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;operations&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">:</span>
                        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;operations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">operations_dict</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;operations&#39;</span><span class="p">])</span>
                    <span class="n">operations_dict</span><span class="p">[</span><span class="n">op_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">operations_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">op_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="c1"># Processor statistics</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">processor</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;processors&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">processor</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;processor_stats&#39;</span><span class="p">]:</span>
                        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;processor_stats&#39;</span><span class="p">][</span><span class="n">processor</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;request_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;total_duration&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;success_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;error_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;total_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;total_cost&#39;</span><span class="p">:</span> <span class="mi">0</span>
                        <span class="p">}</span>

                    <span class="n">proc_stats</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;processor_stats&#39;</span><span class="p">][</span><span class="n">processor</span><span class="p">]</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;request_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;total_duration&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_duration&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;success_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;success_count&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;error_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error_count&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                    <span class="c1"># Add token and cost data if available</span>
                    <span class="n">resources</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;total_tokens&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_tokens&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;total_cost&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_cost&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

            <span class="c1"># Calculate averages for processor stats</span>
            <span class="k">for</span> <span class="n">proc_stats</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;processor_stats&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">req_count</span> <span class="o">=</span> <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;request_count&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">req_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;avg_duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;total_duration&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">req_count</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;success_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;success_count&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">req_count</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;avg_tokens&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;total_tokens&#39;</span><span class="p">]</span> <span class="o">//</span> <span class="n">req_count</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;avg_cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;total_cost&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">req_count</span>

            <span class="c1"># Hourly statistics</span>
            <span class="n">hour_counts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">hour</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:00&#39;</span><span class="p">)</span>
                    <span class="n">hour_counts</span><span class="p">[</span><span class="n">hour</span><span class="p">]</span> <span class="o">=</span> <span class="n">hour_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hour</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing hour statistics: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>

            <span class="c1"># Sort hours and create final hourly stats</span>
            <span class="n">sorted_hours</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">hour_counts</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;hourly_stats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">hour</span><span class="p">:</span> <span class="n">hour_counts</span><span class="p">[</span><span class="n">hour</span><span class="p">]</span> <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="n">sorted_hours</span><span class="p">}</span>

            <span class="c1"># Process recent requests (last 10)</span>
            <span class="n">recent_requests</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">recent_requests</span><span class="p">,</span> 
                                  <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span>
                                  <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>

            <span class="c1"># Add logs to recent requests</span>
            <span class="n">request_logs</span> <span class="o">=</span> <span class="n">load_logs_for_requests</span><span class="p">(</span><span class="n">recent_requests</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">:</span>
                <span class="n">process_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;process_id&#39;</span><span class="p">)</span>
                <span class="n">request</span><span class="p">[</span><span class="s1">&#39;logs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request_logs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">process_id</span><span class="p">,</span> <span class="p">[])</span> <span class="k">if</span> <span class="n">process_id</span> <span class="k">else</span> <span class="p">[]</span>

                <span class="c1"># Get the main operation</span>
                <span class="n">main_op</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;operations&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;operation&#39;</span><span class="p">):</span>
                        <span class="n">main_op</span> <span class="o">=</span> <span class="n">op</span>
                        <span class="k">break</span>

                <span class="c1"># Prepare the main process data</span>
                <span class="n">request</span><span class="p">[</span><span class="s1">&#39;main_process&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;duration_seconds&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_duration&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
                    <span class="s1">&#39;operation&#39;</span><span class="p">:</span> <span class="n">main_op</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;processor&#39;</span><span class="p">:</span> <span class="n">main_op</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;processor&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;file_size&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file_size&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="s1">&#39;duration&#39;</span><span class="p">:</span> <span class="n">main_op</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;text_length&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)),</span>
                    <span class="s1">&#39;llm_model&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;models_used&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s1">&#39;tokens&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_tokens&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">}</span>

            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;recent_requests&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recent_requests</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing dashboard data: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;dashboard.html&#39;</span><span class="p">,</span> 
                         <span class="n">stats</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span>
                         <span class="n">system_info</span><span class="o">=</span><span class="n">get_system_info</span><span class="p">())</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/config&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">save_config</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Speichert die Konfiguration in der config.yaml.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">yaml_content</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">yaml_content</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Keine YAML-Daten empfangen&quot;</span><span class="p">}),</span> <span class="mi">400</span>

        <span class="c1"># Parse YAML-String zu Dictionary</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">config_data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">yaml_content</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Ungültiges YAML Format: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}),</span> <span class="mi">400</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="c1"># Extrahiere und validiere API Key, falls vorhanden</span>
        <span class="n">api_key_updated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;api_keys&#39;</span> <span class="ow">in</span> <span class="n">config_data</span> <span class="ow">and</span> <span class="s1">&#39;openai_api_key&#39;</span> <span class="ow">in</span> <span class="n">config_data</span><span class="p">[</span><span class="s1">&#39;api_keys&#39;</span><span class="p">]:</span>
            <span class="n">api_key</span> <span class="o">=</span> <span class="n">config_data</span><span class="p">[</span><span class="s1">&#39;api_keys&#39;</span><span class="p">][</span><span class="s1">&#39;openai_api_key&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">api_key</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">api_key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;sk-...&#39;</span><span class="p">):</span>  <span class="c1"># Nur speichern wenn es kein maskierter Key ist</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Verwende die ConfigKeys-Klasse anstatt config.set_api_key</span>
                    <span class="kn">from</span><span class="w"> </span><span class="nn">src.core.config_keys</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigKeys</span>
                    <span class="n">config_keys</span> <span class="o">=</span> <span class="n">ConfigKeys</span><span class="p">()</span>
                    <span class="n">config_keys</span><span class="o">.</span><span class="n">set_openai_api_key</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>
                    <span class="n">api_key_updated</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}),</span> <span class="mi">400</span>
            <span class="c1"># Entferne API Keys aus config_data</span>
            <span class="k">del</span> <span class="n">config_data</span><span class="p">[</span><span class="s1">&#39;api_keys&#39;</span><span class="p">]</span>

        <span class="c1"># Hole den Pfad zur config.yaml</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="s1">&#39;config&#39;</span> <span class="o">/</span> <span class="s1">&#39;config.yaml&#39;</span>

        <span class="c1"># Speichere die aktualisierte Konfiguration</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">config_data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;API Key aktualisiert. &quot;</span> <span class="k">if</span> <span class="n">api_key_updated</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Lade die aktuelle Konfiguration neu</span>
        <span class="n">config_yaml</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_all</span><span class="p">(),</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">Konfiguration erfolgreich gespeichert&quot;</span><span class="p">,</span>
            <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="n">config_yaml</span>
        <span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Fehler beim Speichern der Konfiguration&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Speichern: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/config&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">config_page</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zeigt die Konfigurationsseite an.</span>

<span class="sd">    Returns:</span>
<span class="sd">        rendered template: Die config.html Template mit der aktuellen Konfiguration</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Lade die aktuelle Konfiguration</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">config_data</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_all</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Config Data:&quot;</span><span class="p">,</span> <span class="n">config_data</span><span class="p">)</span>  <span class="c1"># Debug-Ausgabe</span>

        <span class="c1"># Konvertiere zu YAML</span>
        <span class="n">config_yaml</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">config_data</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Config YAML:&quot;</span><span class="p">,</span> <span class="n">config_yaml</span><span class="p">)</span>  <span class="c1"># Debug-Ausgabe</span>

        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;config.html&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config_yaml</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Fehler beim Laden der Konfiguration&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>  <span class="c1"># Debug-Ausgabe</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;config.html&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/test&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_page</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test page with Swagger UI integration for API testing</span>

<span class="sd">    Returns:</span>
<span class="sd">        rendered template: The apitest.html template with Swagger UI</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;apitest.html&#39;</span><span class="p">)</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/test-procedures&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_procedures</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zeigt die Testseite an.</span>

<span class="sd">    Returns:</span>
<span class="sd">        rendered template: Die test_procedures.html Template</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;test_procedures.html&#39;</span><span class="p">)</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/run_youtube_test&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">youtube_test</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Route handler for Youtube test&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">run_youtube_test</span><span class="p">()</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/run_audio_test&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">audio_test</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Route handler for audio test&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">run_audio_test</span><span class="p">()</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/run_transformer_test&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">transformer_test</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Route handler for transformer test&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">run_transformer_test</span><span class="p">()</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/run_health_test&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">health_test</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Route handler for health test&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">run_health_test</span><span class="p">()</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/logs&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">logs</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zeigt die Logs der Anwendung an.</span>

<span class="sd">    Diese Funktion lädt die in der config.yaml definierte Log-Datei und zeigt die letzten X Einträge an.</span>
<span class="sd">    Die Log-Datei wird zentral durch den LoggerService initialisiert.</span>

<span class="sd">    Returns:</span>
<span class="sd">        rendered template: Die logs.html Template mit den Log-Einträgen</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Lade Konfiguration</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">config_data</span><span class="p">:</span> <span class="n">ApplicationConfig</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_all</span><span class="p">()</span>

        <span class="n">max_entries</span> <span class="o">=</span> <span class="n">config_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;logging&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_log_entries&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">log_file</span> <span class="o">=</span> <span class="n">config_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;logging&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;logs/detailed.log&#39;</span><span class="p">)</span>
        <span class="n">log_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span>

        <span class="n">log_files</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Lese die Log-Datei</span>
        <span class="k">if</span> <span class="n">log_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">log_files</span><span class="p">[</span><span class="n">log_file</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="o">-</span><span class="n">max_entries</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log_files</span><span class="p">[</span><span class="n">log_file</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;logs.html&#39;</span><span class="p">,</span> <span class="n">log_files</span><span class="o">=</span><span class="n">log_files</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Laden der Logs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Laden der Logs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/clear-logs&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">clear_logs</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Löscht den Inhalt der Log-Datei und stellt sicher, dass sie danach wieder existiert.</span>
<span class="sd">    Die Log-Datei wird mit einem leeren Inhalt neu erstellt.</span>

<span class="sd">    Returns:</span>
<span class="sd">        redirect: Leitet zurück zur Logs-Ansicht</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Lade Log-Pfad aus der Konfiguration</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">log_file</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_all</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;logging&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;logs/detailed.log&#39;</span><span class="p">)</span>
        <span class="n">log_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span>

        <span class="c1"># Stelle sicher, dass das Verzeichnis existiert</span>
        <span class="n">log_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Leere die Datei oder erstelle sie neu</span>
        <span class="n">log_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;main.logs&#39;</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error clearing logs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/recent-requests&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_recent_requests</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Abrufen der neuesten Anfragen.</span>
<span class="sd">    Gibt die letzten 10 Anfragen zurück.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Response: JSON mit den neuesten Anfragen</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Load performance data</span>
        <span class="n">perf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;logs&#39;</span><span class="p">,</span> <span class="s1">&#39;performance.json&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">perf_path</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">([])</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">perf_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">perf_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">perf_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">([])</span>

        <span class="c1"># Calculate time window</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="n">day_ago</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Filter recent requests and ensure timestamp is valid</span>
        <span class="n">recent_requests</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">perf_data</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;+00:00&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">timestamp</span> <span class="o">&gt;</span> <span class="n">day_ago</span><span class="p">:</span>
                    <span class="n">r</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
                    <span class="n">recent_requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing request timestamp: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="c1"># Sort by timestamp (newest first) and take last 10</span>
        <span class="n">recent_requests</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">recent_requests</span><span class="p">,</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>

        <span class="c1"># Render only the requests list part</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;_recent_requests.html&#39;</span><span class="p">,</span> 
                             <span class="n">recent_requests</span><span class="o">=</span><span class="n">recent_requests</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;html&#39;</span><span class="p">:</span> <span class="n">html</span><span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting recent requests: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;html&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;&lt;div class=&quot;text-danger&quot;&gt;Fehler beim Laden: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&lt;/div&gt;&#39;</span><span class="p">})</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/docs-view/&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">docs_view</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper-Ansicht für die Dokumentation mit App-Navigation.</span>
<span class="sd">    Lädt die MkDocs-Site in einem iframe, damit die Top-Navigation erhalten bleibt.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;docs_wrapper.html&#39;</span><span class="p">)</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/event-monitor&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">event_monitor</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zeigt die Monitoring-Seite für asynchrone Event-Verarbeitung an.</span>
<span class="sd">    Hier werden aktuelle Batches und archivierte Batches aus dem event-job API-Endpoint angezeigt.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Konfigurationsdaten laden (sofern benötigt)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">event_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;processors.event&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">max_concurrent_tasks</span> <span class="o">=</span> <span class="n">event_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_concurrent_tasks&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Basis-URL für API-Anfragen</span>
        <span class="n">api_base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="c1"># Filterparameter aus dem Request</span>
        <span class="n">status_filter</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">date_filter</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># Aktuelle (nicht-archivierte) Batches abrufen</span>
        <span class="n">current_batches_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_base_url</span><span class="si">}</span><span class="s2">/api/event-job/batches?archived=false&quot;</span>
        <span class="k">if</span> <span class="n">status_filter</span><span class="p">:</span>
            <span class="n">current_batches_url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&amp;status=</span><span class="si">{</span><span class="n">status_filter</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># HTTP-Request für aktuelle Batches</span>
            <span class="n">current_batches_response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">current_batches_url</span><span class="p">)</span>
            <span class="n">current_batches_response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="n">current_batches_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_batches_response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

            <span class="c1"># KEINE Jobs mehr vorab laden - das wird bei Bedarf über JavaScript gemacht</span>
            <span class="n">jobs_data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der aktuellen Batch-Daten: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">current_batches_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;batches&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="n">jobs_data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Daten für das Template vorbereiten</span>
        <span class="n">event_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;current_batches&quot;</span><span class="p">:</span> <span class="n">current_batches_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;batches&#39;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="s2">&quot;jobs_data&quot;</span><span class="p">:</span> <span class="n">jobs_data</span><span class="p">,</span>
            <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status_filter</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">date_filter</span>
            <span class="p">},</span>
            <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;max_concurrent_tasks&quot;</span><span class="p">:</span> <span class="n">max_concurrent_tasks</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;event_monitor.html&#39;</span><span class="p">,</span> <span class="n">event_data</span><span class="o">=</span><span class="n">event_data</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Laden der Event-Monitor-Seite: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Laden der Event-Monitor-Seite: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_batches</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Abrufen von Batch-Daten für die Event-Monitor-Oberfläche.</span>
<span class="sd">    Unterstützt Paginierung und Filterung.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Query-Parameter extrahieren</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span>
        <span class="n">status_filter</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">archived_filter</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;archived&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># Normalisieren zu Kleinbuchstaben</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;limit&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>

        <span class="c1"># Verwende verschiedene Routen basierend auf dem Status-Filter</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">api_base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="c1"># URL mit Status- und Archiv-Filter erstellen</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_base_url</span><span class="si">}</span><span class="s2">/api/event-job/batches?limit=</span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Filter hinzufügen</span>
        <span class="n">filters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">status_filter</span><span class="p">:</span>
            <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;status=</span><span class="si">{</span><span class="n">status_filter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Archived-Parameter korrekt übergeben (als String &#39;true&#39; oder &#39;false&#39;)</span>
        <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;archived=</span><span class="si">{</span><span class="n">archived_filter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Filter zur URL hinzufügen</span>
        <span class="k">if</span> <span class="n">filters</span><span class="p">:</span>
            <span class="n">filter_string</span> <span class="o">=</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">&amp;</span><span class="si">{</span><span class="n">filter_string</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">base_url</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch-Anfrage an: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Batch-Daten: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Batch-Daten: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Batch-Daten: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Batch-Daten: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/job/&lt;job_id&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_job_detail</span><span class="p">(</span><span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Abrufen der Details eines einzelnen Jobs anhand seiner ID.</span>

<span class="sd">    :param job_id: Die ID des Jobs, dessen Details abgerufen werden sollen.</span>
<span class="sd">    :return: JSON-Antwort mit den Job-Details oder einer Fehlermeldung.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">job_id</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine job_id in der Anfrage&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;job_id ist ein erforderlicher Parameter&quot;</span>
        <span class="p">}),</span> <span class="mi">400</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># API-Basis-URL aus der Konfiguration laden</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lade Job-Details für job_id: </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Verwende die generische get-Methode für die API-Basis-URL</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">base_url</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine API-Basis-URL konfiguriert&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;API-Basis-URL nicht konfiguriert&quot;</span>
            <span class="p">}),</span> <span class="mi">500</span>

        <span class="c1"># Erstelle die Anfrage-URL für einen einzelnen Job</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/event-job/jobs/</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rufe API auf: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Führe die Anfrage durch</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Verarbeite die Antwort</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job-Detail API-Antwort erhalten: </span><span class="si">{</span><span class="n">response_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Prüfe, ob der Job in der Antwort enthalten ist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Kein Job in der API-Antwort gefunden für job_id: </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Job mit ID </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> nicht gefunden&quot;</span>
            <span class="p">}),</span> <span class="mi">404</span>

        <span class="c1"># Bereite die Antwort vor - direkte Struktur ohne Wrapping in &#39;data&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;job&quot;</span><span class="p">:</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Formatierte Antwort: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/jobs&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_jobs</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># API-Basis-URL aus der Konfiguration laden</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Lade Jobs&quot;</span><span class="p">)</span>

        <span class="c1"># Verwende die generische get-Methode anstelle einer nicht existierenden get_api_base_url-Methode</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">base_url</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine API-Basis-URL konfiguriert&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;API-Basis-URL nicht konfiguriert&quot;</span>
            <span class="p">}),</span> <span class="mi">500</span>

        <span class="c1"># Extrahiere alle Query-Parameter</span>
        <span class="n">batch_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;batch_id&#39;</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span>

        <span class="c1"># Erstelle die Basis-URL für Jobs</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/event-job/jobs&quot;</span>

        <span class="c1"># Füge Query-Parameter hinzu, wenn vorhanden</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">batch_id</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;batch_id=</span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;status=</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">?</span><span class="si">{</span><span class="s1">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rufe API auf: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Führe die Anfrage durch</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Verarbeite die Antwort</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jobs API-Antwort erhalten: </span><span class="si">{</span><span class="n">response_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Bereite die Antwort vor</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;jobs&quot;</span><span class="p">:</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;jobs&#39;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Formatierte Antwort: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;jobs&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/job/&lt;job_id&gt;/restart&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_job_restart</span><span class="p">(</span><span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Neustarten eines Jobs durch Zurücksetzen seines Status.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Konfiguration laden für API-Basis-URL</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="c1"># Request-Daten extrahieren (optional: batch_id)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;batch_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># Verwende die generische get-Methode für die API-Basis-URL</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>
        <span class="c1"># Korrigierter API-Pfad mit /api/ Präfix</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/event-job/</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">/restart&quot;</span>

        <span class="c1"># Debug-Ausgabe für die Problemdiagnose</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sende Neustart-Anfrage an: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Führe die API-Anfrage durch</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span> 
            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;batch_id&#39;</span><span class="p">:</span> <span class="n">batch_id</span><span class="p">},</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Verarbeite die Antwort</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job-Neustart API-Antwort erhalten: </span><span class="si">{</span><span class="n">response_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Bereite die Antwort vor</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> wurde erfolgreich für den Neustart markiert&quot;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;job&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Formatierte Antwort: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Neustarten des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Neustarten des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/job/&lt;job_id&gt;/archive&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_job_archive</span><span class="p">(</span><span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Archivieren eines Jobs durch Änderung des Status.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Konfiguration laden für API-Basis-URL</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="c1"># Request-Daten extrahieren (optional: batch_id)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;batch_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># Verwende die generische get-Methode für die API-Basis-URL</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/event-job/</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">/archive&quot;</span>

        <span class="c1"># Führe die API-Anfrage durch</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span> 
            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;batch_id&#39;</span><span class="p">:</span> <span class="n">batch_id</span><span class="p">},</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Verarbeite die Antwort</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job-Archivierung API-Antwort erhalten: </span><span class="si">{</span><span class="n">response_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Bereite die Antwort vor</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> wurde erfolgreich archiviert&quot;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;job&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Formatierte Antwort: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Archivieren des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Archivieren des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>


<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/jobs/&lt;job_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DELETE&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_job_delete</span><span class="p">(</span><span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Löschen eines Jobs.</span>

<span class="sd">    :param job_id: Die ID des Jobs, der gelöscht werden soll.</span>
<span class="sd">    :return: JSON-Antwort mit Erfolgsmeldung oder Fehlermeldung.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">job_id</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine job_id in der Anfrage&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;job_id ist ein erforderlicher Parameter&quot;</span>
        <span class="p">}),</span> <span class="mi">400</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># API-Basis-URL aus der Konfiguration laden</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lösche Job mit job_id: </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Verwende die generische get-Methode für die API-Basis-URL</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">base_url</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine API-Basis-URL konfiguriert&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;API-Basis-URL nicht konfiguriert&quot;</span>
            <span class="p">}),</span> <span class="mi">500</span>

        <span class="c1"># Erstelle die Anfrage-URL für das Löschen eines Jobs</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/event-job/jobs/</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rufe API auf (DELETE): </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Führe die Anfrage durch</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Verarbeite die Antwort</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job-Löschung API-Antwort erhalten: </span><span class="si">{</span><span class="n">response_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Bereite die Antwort vor</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> wurde erfolgreich gelöscht&quot;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Formatierte Antwort: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Löschen des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Löschen des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/&lt;batch_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DELETE&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_batch_delete</span><span class="p">(</span><span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Löschen eines Batches und aller zugehörigen Jobs.</span>

<span class="sd">    :param batch_id: Die ID des Batches, der gelöscht werden soll.</span>
<span class="sd">    :return: JSON-Antwort mit Erfolgsmeldung oder Fehlermeldung.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">batch_id</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine batch_id in der Anfrage&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;batch_id ist ein erforderlicher Parameter&quot;</span>
        <span class="p">}),</span> <span class="mi">400</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># API-Basis-URL aus der Konfiguration laden</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lösche Batch mit batch_id: </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Verwende die generische get-Methode für die API-Basis-URL</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">base_url</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine API-Basis-URL konfiguriert&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;API-Basis-URL nicht konfiguriert&quot;</span>
            <span class="p">}),</span> <span class="mi">500</span>

        <span class="c1"># Erstelle die Anfrage-URL für das Löschen eines Batches</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/event-job/batches/</span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rufe API auf (DELETE): </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Führe die Anfrage durch</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Verarbeite die Antwort</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch-Löschung API-Antwort erhalten: </span><span class="si">{</span><span class="n">response_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Bereite die Antwort vor</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Batch </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2"> wurde erfolgreich gelöscht&quot;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Formatierte Antwort: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Löschen des Batches: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Löschen des Batches: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/&lt;string:batch_id&gt;/stats&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_batch_stats</span><span class="p">(</span><span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Abrufen aktueller Statistiken eines Batches ohne Änderungen in der Datenbank.</span>
<span class="sd">    Dies ist nützlich für Live-Updates im Frontend ohne vollständige Seitenneuladen.</span>

<span class="sd">    :param batch_id: Die ID des Batches, dessen Statistiken abgerufen werden sollen.</span>
<span class="sd">    :return: JSON-Antwort mit den aktuellen Batch-Statistiken.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">batch_id</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine batch_id in der Anfrage&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;batch_id ist ein erforderlicher Parameter&quot;</span>
        <span class="p">}),</span> <span class="mi">400</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Direkt das Repository für effizientere Abfragen verwenden</span>
        <span class="n">job_repo</span><span class="p">:</span> <span class="n">SessionJobRepository</span> <span class="o">=</span> <span class="n">get_job_repository</span><span class="p">()</span>

        <span class="c1"># Batch mit aktuellen Statistiken abrufen, ohne Status zu ändern</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">get_batch_with_current_stats</span><span class="p">(</span><span class="n">batch_id</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">batch</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch nicht gefunden: </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Batch mit ID </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2"> nicht gefunden&quot;</span>
            <span class="p">}),</span> <span class="mi">404</span>

        <span class="c1"># Erfolgsantwort zurückgeben</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;batch&quot;</span><span class="p">:</span> <span class="n">batch</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
        <span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Batch-Statistiken: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Batch-Statistiken: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/&lt;string:batch_id&gt;/toggle-active&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_toggle_active</span><span class="p">(</span><span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Umschalten des isActive-Status eines Batches.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Konfiguration laden für API-Basis-URL</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">api_base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="c1"># Request-Daten (falls vorhanden) weitergeben</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">is_json</span> <span class="k">else</span> <span class="p">{})</span>

        <span class="c1"># API-Anfrage zur Umschaltung des isActive-Status</span>
        <span class="c1"># Verwende standardisierte Event-Job-API-URL</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_base_url</span><span class="si">}</span><span class="s2">/api/event-job/batches/</span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">/toggle-active&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Toggle-Active-Anfrage an: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> mit Daten: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Antwort verarbeiten</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="c1"># Erfolgsantwort zurückgeben</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Umschalten des isActive-Status: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Umschalten des isActive-Status: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/&lt;string:batch_id&gt;/archive&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_batch_archive</span><span class="p">(</span><span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Archivieren eines Batches.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Konfiguration laden für API-Basis-URL</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">api_base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="c1"># Request-Daten (falls vorhanden) weitergeben oder Standarddaten verwenden</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">is_json</span> <span class="k">else</span> <span class="p">{})</span>

        <span class="c1"># Sicherstellen, dass die Mindestanforderungen erfüllt sind</span>
        <span class="k">if</span> <span class="s1">&#39;batch_id&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;batch_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">batch_id</span>
        <span class="k">if</span> <span class="s1">&#39;archived&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;archived&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archiviere Batch </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2"> mit Daten: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># API-Anfrage zum Archivieren des Batches</span>
        <span class="c1"># Korrigierte URL-Konstruktion - prüfe, ob Basis-URL bereits den API-Pfad enthält</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_base_url</span><span class="si">}</span><span class="s2">/api/event-job/batches/</span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">/archive&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch-Archivierung-Anfrage an: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Initialisiere response als None</span>
        <span class="n">response</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

            <span class="c1"># Antwort verarbeiten</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

            <span class="c1"># Erfolgsantwort zurückgeben</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">http_err</span><span class="p">:</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;HTTP-Fehler beim Archivieren des Batches: </span><span class="si">{</span><span class="n">http_err</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>

            <span class="c1"># Versuche, Details aus der Antwort zu extrahieren, wenn response existiert</span>
            <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">error_details</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;API-Fehlerdetails: </span><span class="si">{</span><span class="n">error_details</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">error_message</span><span class="p">,</span>
                        <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="n">error_details</span>
                    <span class="p">}),</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">error_message</span>
                <span class="p">}),</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

            <span class="c1"># Standardantwort, wenn keine Antwort vom Server kam</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">error_message</span>
            <span class="p">}),</span> <span class="mi">500</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Archivieren des Batches </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/&lt;string:batch_id&gt;/restart&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_batch_restart</span><span class="p">(</span><span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Neustarten aller Jobs in einem Batch.</span>

<span class="sd">    :param batch_id: Die ID des Batches, dessen Jobs neu gestartet werden sollen.</span>
<span class="sd">    :return: JSON-Antwort mit Erfolgsmeldung oder Fehlermeldung.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">batch_id</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine batch_id in der Anfrage&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;batch_id ist ein erforderlicher Parameter&quot;</span>
        <span class="p">}),</span> <span class="mi">400</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Repository-Instanz holen</span>
        <span class="n">job_repo</span> <span class="o">=</span> <span class="n">get_job_repository</span><span class="p">()</span>

        <span class="c1"># Alle Jobs des Batches auf einmal auf PENDING setzen</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">update_jobs_status_by_batch</span><span class="p">(</span><span class="n">batch_id</span><span class="p">,</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Erfolgsantwort zurückgeben</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2"> Jobs wurden neu gestartet&quot;</span><span class="p">,</span>
                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;restarted_jobs&quot;</span><span class="p">:</span> <span class="n">result</span>
                <span class="p">}</span>
            <span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Keine Jobs für diesen Batch gefunden&quot;</span><span class="p">,</span>
                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;restarted_jobs&quot;</span><span class="p">:</span> <span class="mi">0</span>
                <span class="p">}</span>
            <span class="p">}),</span> <span class="mi">200</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Neustarten des Batches </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/fail-all&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_fail_all_batches</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Setzen aller aktiven Batches auf failed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># API-URL zusammenbauen</span>
        <span class="n">api_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;API_BASE_URL&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/event-job/batches/fail-all&quot;</span>

        <span class="c1"># Headers vorbereiten</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span>
        <span class="p">}</span>

        <span class="c1"># Benutzer-ID aus den Headern weiterleiten</span>
        <span class="k">if</span> <span class="s1">&#39;X-User-ID&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
            <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-User-ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-User-ID&#39;</span><span class="p">]</span>

        <span class="c1"># API-Aufruf durchführen</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Erfolgreiche Antwort</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()),</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">http_err</span><span class="p">:</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;HTTP-Fehler beim Setzen der Batches auf failed: </span><span class="si">{</span><span class="n">http_err</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">error_message</span>
        <span class="p">}),</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">http_err</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;status_code&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Setzen der Batches auf failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">error_message</span>
        <span class="p">}),</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/force-fail-all&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_force_fail_all</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum direkten Setzen ALLER Batches und Jobs auf failed.</span>
<span class="sd">    Dies ist eine direkte Datenbankoperation, die alle Batches und Jobs betrifft.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Repository-Instanz holen</span>
        <span class="n">job_repo</span> <span class="o">=</span> <span class="n">get_job_repository</span><span class="p">()</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>  <span class="c1"># Verwende utcnow statt now(UTC)</span>

        <span class="c1"># Direkte Batch-Aktualisierung</span>
        <span class="n">batch_result</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;archived&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$ne&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>  <span class="c1"># Nicht archivierte Batches</span>
            <span class="p">{</span>
                <span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;failed&quot;</span><span class="p">,</span>  <span class="c1"># Kleinbuchstaben statt Großbuchstaben</span>
                    <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
                    <span class="s2">&quot;completed_at&quot;</span><span class="p">:</span> <span class="n">now</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Direkte Job-Aktualisierung für alle Jobs</span>
        <span class="n">job_result</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span>
            <span class="p">{},</span>  <span class="c1"># Alle Jobs</span>
            <span class="p">{</span>
                <span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;failed&quot;</span><span class="p">,</span>  <span class="c1"># Kleinbuchstaben statt Großbuchstaben</span>
                    <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
                    <span class="s2">&quot;completed_at&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
                    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;FORCED_FAILURE&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Job wurde manuell auf failed gesetzt&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;forced_at&quot;</span><span class="p">:</span> <span class="n">now</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                            <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Manuelle Massenaktualisierung&quot;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Log die Änderungen</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Force-fail-all ausgeführt&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;updated_batches&quot;</span><span class="p">:</span> <span class="n">batch_result</span><span class="o">.</span><span class="n">modified_count</span><span class="p">,</span>
                <span class="s2">&quot;updated_jobs&quot;</span><span class="p">:</span> <span class="n">job_result</span><span class="o">.</span><span class="n">modified_count</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">batch_result</span><span class="o">.</span><span class="n">modified_count</span><span class="si">}</span><span class="s2"> Batches und </span><span class="si">{</span><span class="n">job_result</span><span class="o">.</span><span class="n">modified_count</span><span class="si">}</span><span class="s2"> Jobs auf failed gesetzt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;updated_batches&quot;</span><span class="p">:</span> <span class="n">batch_result</span><span class="o">.</span><span class="n">modified_count</span><span class="p">,</span>
                <span class="s2">&quot;updated_jobs&quot;</span><span class="p">:</span> <span class="n">job_result</span><span class="o">.</span><span class="n">modified_count</span>
            <span class="p">}</span>
        <span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Setzen aller Batches und Jobs auf failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">error_message</span>
        <span class="p">}),</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/set-pending-all&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_set_pending_all</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setzt alle nicht archivierten Batches und deren Jobs auf &#39;pending&#39;.</span>
<span class="sd">    Parameter:</span>
<span class="sd">    - target_language: Die neue Zielsprache (z.B. &#39;de&#39;, &#39;en&#39;, etc.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">target_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;target_language&#39;</span><span class="p">)</span>
        <span class="n">job_repository</span> <span class="o">=</span> <span class="n">get_job_repository</span><span class="p">()</span>

        <span class="c1"># Hole alle nicht archivierten Batches</span>
        <span class="n">batches</span> <span class="o">=</span> <span class="n">job_repository</span><span class="o">.</span><span class="n">get_batches</span><span class="p">(</span><span class="n">archived</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">updated_batches</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">updated_jobs</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Aktualisiere jeden Batch und seine Jobs</span>
        <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">batches</span><span class="p">:</span>
            <span class="c1"># Aktualisiere Batch und alle zugehörigen Jobs auf PENDING</span>
            <span class="k">if</span> <span class="n">job_repository</span><span class="o">.</span><span class="n">update_batch_status</span><span class="p">(</span><span class="n">batch</span><span class="o">.</span><span class="n">batch_id</span><span class="p">,</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">):</span>
                <span class="n">updated_batches</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Aktualisiere alle Jobs des Batches</span>
            <span class="n">jobs_updated</span> <span class="o">=</span> <span class="n">job_repository</span><span class="o">.</span><span class="n">update_jobs_status_by_batch</span><span class="p">(</span>
                <span class="n">batch</span><span class="o">.</span><span class="n">batch_id</span><span class="p">,</span> 
                <span class="n">JobStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">,</span>
                <span class="n">language</span><span class="o">=</span><span class="n">target_language</span>
            <span class="p">)</span>
            <span class="n">updated_jobs</span> <span class="o">+=</span> <span class="n">jobs_updated</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Alle Batches auf pending gesetzt&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;updated_batches&quot;</span><span class="p">:</span> <span class="n">updated_batches</span><span class="p">,</span>
                <span class="s2">&quot;updated_jobs&quot;</span><span class="p">:</span> <span class="n">updated_jobs</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">updated_batches</span><span class="si">}</span><span class="s2"> Batches und </span><span class="si">{</span><span class="n">updated_jobs</span><span class="si">}</span><span class="s2"> Jobs auf pending gesetzt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;batches_updated&quot;</span><span class="p">:</span> <span class="n">updated_batches</span><span class="p">,</span>
                <span class="s2">&quot;jobs_updated&quot;</span><span class="p">:</span> <span class="n">updated_jobs</span>
            <span class="p">}</span>
        <span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Setzen der Batches auf pending: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="p">}),</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/change-language&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_change_language</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ändert die Zielsprache für alle Jobs oder einen einzelnen Job im Event-Monitor.</span>

<span class="sd">    Parameter:</span>
<span class="sd">    - target_language: Die neue Zielsprache (z.B. &#39;de&#39;, &#39;en&#39;, etc.)</span>
<span class="sd">    - job_id: (Optional) Die ID eines einzelnen Jobs, dessen Sprache geändert werden soll</span>
<span class="sd">    - reset_status: (Optional) Ob der Status der Jobs auf &#39;pending&#39; zurückgesetzt werden soll</span>
<span class="sd">    - current_batches_only: (Optional) Ob nur aktuelle (nicht archivierte) Batches betroffen sein sollen</span>

<span class="sd">    Returns:</span>
<span class="sd">        JSON mit Erfolgs- oder Fehlermeldung</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Daten aus dem Request auslesen</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span> <span class="ow">or</span> <span class="p">{})</span>

        <span class="n">target_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;target_language&#39;</span><span class="p">)</span>
        <span class="n">job_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job_id&#39;</span><span class="p">)</span>
        <span class="n">reset_status</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reset_status&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">current_batches_only</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_batches_only&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_language</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Zielsprache (target_language) ist erforderlich&#39;</span><span class="p">}),</span> <span class="mi">400</span>

        <span class="c1"># Repository und weitere benötigte Objekte initialisieren</span>
        <span class="n">job_repo</span> <span class="o">=</span> <span class="n">get_job_repository</span><span class="p">()</span>
        <span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Bestimmen, ob ein einzelner Job oder mehrere Jobs aktualisiert werden sollen</span>
        <span class="k">if</span> <span class="n">job_id</span><span class="p">:</span>
            <span class="c1"># Einzelnen Job aktualisieren</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ändere Zielsprache für Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> auf </span><span class="si">{</span><span class="n">target_language</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">job</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Job mit ID </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s1"> nicht gefunden&#39;</span><span class="p">}),</span> <span class="mi">404</span>

            <span class="c1"># Job-Parameter aktualisieren</span>
            <span class="n">job_parameters</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">parameters</span> <span class="k">else</span> <span class="p">{}</span>
            <span class="n">job_parameters</span><span class="p">[</span><span class="s1">&#39;target_language&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_language</span>

            <span class="c1"># Status zurücksetzen, falls gewünscht</span>
            <span class="k">if</span> <span class="n">reset_status</span><span class="p">:</span>
                <span class="n">job_repo</span><span class="o">.</span><span class="n">update_job_status</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">)</span>

            <span class="c1"># Job-Parameter aktualisieren</span>
            <span class="n">job_repo</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;job_id&quot;</span><span class="p">:</span> <span class="n">job_id</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">job_parameters</span><span class="p">}}</span>
            <span class="p">)</span>
            <span class="n">success_count</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Zielsprache für Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> erfolgreich auf </span><span class="si">{</span><span class="n">target_language</span><span class="si">}</span><span class="s2"> geändert&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Alle Jobs in Batches aktualisieren</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ändere Zielsprache für alle Jobs auf </span><span class="si">{</span><span class="n">target_language</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Batches abrufen (basierend auf dem &#39;current_batches_only&#39; Parameter)</span>
            <span class="n">batches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Batch</span><span class="p">]</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">get_batches</span><span class="p">(</span><span class="n">archived</span><span class="o">=</span><span class="ow">not</span> <span class="n">current_batches_only</span><span class="p">)</span>

            <span class="c1"># Durch alle Batches iterieren und Jobs aktualisieren</span>
            <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">batches</span><span class="p">:</span>
                <span class="n">batch_id</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">batch_id</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Verarbeite Batch </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Jobs für den aktuellen Batch abrufen</span>
                <span class="n">jobs</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">get_jobs_for_batch</span><span class="p">(</span><span class="n">batch_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
                    <span class="c1"># Parameter aktualisieren</span>
                    <span class="n">job_parameters</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">parameters</span> <span class="k">else</span> <span class="p">{}</span>
                    <span class="n">job_parameters</span><span class="p">[</span><span class="s1">&#39;target_language&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_language</span>

                    <span class="c1"># Job-Parameter aktualisieren</span>
                    <span class="n">job_repo</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                        <span class="p">{</span><span class="s2">&quot;job_id&quot;</span><span class="p">:</span> <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">},</span>
                        <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">job_parameters</span><span class="p">}}</span>
                    <span class="p">)</span>
                    <span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1"># Status zurücksetzen, falls gewünscht</span>
                <span class="k">if</span> <span class="n">reset_status</span> <span class="ow">and</span> <span class="n">jobs</span><span class="p">:</span>
                    <span class="n">job_repo</span><span class="o">.</span><span class="n">update_batch_status</span><span class="p">(</span><span class="n">batch_id</span><span class="p">,</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">)</span>
                    <span class="n">job_repo</span><span class="o">.</span><span class="n">update_jobs_status_by_batch</span><span class="p">(</span><span class="n">batch_id</span><span class="p">,</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Zielsprache für </span><span class="si">{</span><span class="n">success_count</span><span class="si">}</span><span class="s2"> Jobs erfolgreich auf </span><span class="si">{</span><span class="n">target_language</span><span class="si">}</span><span class="s2"> geändert&quot;</span><span class="p">)</span>

        <span class="c1"># Erfolgreiche Antwort zurückgeben</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Zielsprache für </span><span class="si">{</span><span class="n">success_count</span><span class="si">}</span><span class="s1"> Job(s) erfolgreich auf </span><span class="si">{</span><span class="n">target_language</span><span class="si">}</span><span class="s1"> geändert&#39;</span><span class="p">,</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;updated_count&#39;</span><span class="p">:</span> <span class="n">success_count</span><span class="p">,</span>
                <span class="s1">&#39;target_language&#39;</span><span class="p">:</span> <span class="n">target_language</span>
            <span class="p">}</span>
        <span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Ändern der Zielsprache: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Fehler beim Ändern der Zielsprache: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}),</span> <span class="mi">500</span> 
</code></pre></div>

<div class="highlight"><pre><span></span><code>{% extends &#39;base.html&#39; %}

{% block content %}
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container-fluid p-0&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;height: calc(100vh - 80px);&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">iframe</span>
        <span class="na">src</span><span class="o">=</span><span class="s">&quot;/docs/&quot;</span>
        <span class="na">title</span><span class="o">=</span><span class="s">&quot;Dokumentation&quot;</span>
        <span class="na">style</span><span class="o">=</span><span class="s">&quot;border: 0; width: 100%; height: 100%;&quot;</span>
        <span class="na">referrerpolicy</span><span class="o">=</span><span class="s">&quot;no-referrer&quot;</span>
        <span class="na">sandbox</span><span class="o">=</span><span class="s">&quot;allow-same-origin allow-scripts allow-forms allow-popups&quot;</span>
    <span class="p">&gt;&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-muted small mt-2 px-3&quot;</span><span class="p">&gt;</span>
        Hinweise: Die Dokumentation wird im iframe angezeigt. Externe Links können die App verlassen.
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Secretary Services Dashboard<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>
    {% block extra_css %}{% endblock %}
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar navbar-expand-lg navbar-dark bg-dark&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container-fluid&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-brand&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;main.home&#39;) }}&quot;</span><span class="p">&gt;</span>Secretary Services v0.1.44<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-toggler&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">data-bs-toggle</span><span class="o">=</span><span class="s">&quot;collapse&quot;</span> <span class="na">data-bs-target</span><span class="o">=</span><span class="s">&quot;#navbarNav&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-toggler-icon&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;collapse navbar-collapse&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;navbarNav&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-nav&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link {% if request.endpoint == &#39;main.home&#39; %}active{% endif %}&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;main.home&#39;) }}&quot;</span><span class="p">&gt;</span>Dashboard<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link {% if request.endpoint == &#39;main.logs&#39; %}active{% endif %}&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;main.logs&#39;) }}&quot;</span><span class="p">&gt;</span>Logs<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link {% if request.endpoint == &#39;main.event_monitor&#39; %}active{% endif %}&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;main.event_monitor&#39;) }}&quot;</span><span class="p">&gt;</span>Event-Monitor<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link {% if request.endpoint == &#39;main.config_page&#39; %}active{% endif %}&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;main.config_page&#39;) }}&quot;</span><span class="p">&gt;</span>Config<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link {% if request.endpoint == &#39;main.test_procedures&#39; %}active{% endif %}&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;main.test_procedures&#39;) }}&quot;</span><span class="p">&gt;</span>Tests<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/api/doc&quot;</span><span class="p">&gt;</span>API<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link {% if request.endpoint == &#39;main.docs_view&#39; %}active{% endif %}&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;main.docs_view&#39;) }}&quot;</span><span class="p">&gt;</span>Docs<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container mt-4&quot;</span><span class="p">&gt;</span>
        {% block content %}{% endblock %}
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://code.jquery.com/jquery-3.6.0.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    {% block scripts %}{% endblock %}
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span> 
</code></pre></div>

Ich passe die betroffene Funktion in `src/dashboard/routes/main_routes.py` minimal an, um die Linter-Warnung zur doppelten Deklaration von `current_batches_data` zu beheben. Danach prüfe ich die Linter-Ergebnisse erneut.

<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Main routes for the dashboard application.</span>
<span class="sd">Contains the main dashboard view and test routes.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Blueprint</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">current_app</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span><span class="p">,</span> <span class="n">timezone</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">cast</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">ApplicationConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.models.job_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Batch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.utils.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessingLogger</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_system_info</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">Config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.utils.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_logger</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.tests</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_youtube_test</span><span class="p">,</span> <span class="n">run_audio_test</span><span class="p">,</span> <span class="n">run_transformer_test</span><span class="p">,</span> <span class="n">run_health_test</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>  <span class="c1"># Neu hinzugefügt für API-Anfragen</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">markdown</span>  <span class="c1"># type: ignore</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.mongodb.repository</span><span class="w"> </span><span class="kn">import</span> <span class="n">SessionJobRepository</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.mongodb</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_job_repository</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.models.job_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">JobStatus</span>

<span class="c1"># Create the blueprint</span>
<span class="n">main</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="p">:</span> <span class="n">ProcessingLogger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="n">process_id</span><span class="o">=</span><span class="s2">&quot;dashboard&quot;</span><span class="p">)</span>

<span class="c1"># Funktion zur Markdown-Konvertierung</span>
<span class="k">def</span><span class="w"> </span><span class="nf">render_markdown</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Konvertiert Markdown-Text in HTML&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">load_logs_for_requests</span><span class="p">(</span><span class="n">recent_requests</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load log entries for a list of requests from the detailed log file</span>

<span class="sd">    Args:</span>
<span class="sd">        recent_requests (list): List of request entries to load logs for</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Dictionary mapping process_ids to their log entries</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Lade Log-Pfad aus der Konfiguration</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
    <span class="n">log_file</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_all</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;logging&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;logs/detailed.log&#39;</span><span class="p">)</span>
    <span class="n">log_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="n">log_file</span><span class="p">)</span>
    <span class="n">request_logs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">current_entry</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">details_lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">collecting_details</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="c1"># Check if this is a new log entry</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d</span><span class="si">{4}</span><span class="s1">-\d</span><span class="si">{2}</span><span class="s1">-\d</span><span class="si">{2}</span><span class="s1"> \d</span><span class="si">{2}</span><span class="s1">:\d</span><span class="si">{2}</span><span class="s1">:\d</span><span class="si">{2}</span><span class="s1">,\d</span><span class="si">{3}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                    <span class="c1"># Save previous entry if exists</span>
                    <span class="k">if</span> <span class="n">current_entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">details_lines</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">details_text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">details_lines</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">details_text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Details: &#39;</span><span class="p">):</span>
                                    <span class="n">details_text</span> <span class="o">=</span> <span class="n">details_text</span><span class="p">[</span><span class="mi">9</span><span class="p">:]</span>
                                <span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">details_text</span><span class="p">))</span>
                            <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
                                <span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;raw&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">details_lines</span><span class="p">)})</span>

                        <span class="k">if</span> <span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;process_id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">request_logs</span><span class="p">:</span>
                            <span class="n">request_logs</span><span class="p">[</span><span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;process_id&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_entry</span><span class="p">)</span>

                    <span class="c1"># Parse new entry</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; - &#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">level</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">source</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># [logger.py:97]</span>
                        <span class="n">process_info</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># [TransformerProcessor] Process[1735640951800]</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39; - &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span>  <span class="c1"># Join remaining parts in case message contains &#39; - &#39;</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Extrahiere processor_name und process_id</span>
                            <span class="c1"># Format: &quot;[YoutubeProcessor] Process[1735641423754]&quot;</span>
                            <span class="k">if</span> <span class="s1">&#39;] Process[&#39;</span> <span class="ow">in</span> <span class="n">process_info</span><span class="p">:</span>
                                <span class="n">parts</span> <span class="o">=</span> <span class="n">process_info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;] Process[&#39;</span><span class="p">)</span>
                                <span class="n">processor_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span>  <span class="c1"># YoutubeProcessor</span>
                                <span class="n">process_id</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>      <span class="c1"># 1735641423754</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">processor_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                                <span class="n">process_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                            <span class="c1"># Initialize logs list for process_id if it&#39;s in recent requests</span>
                            <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;process_id&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">process_id</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="n">process_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">request_logs</span><span class="p">:</span>
                                        <span class="n">request_logs</span><span class="p">[</span><span class="n">process_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                            <span class="n">current_entry</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                                <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="n">level</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                                <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">source</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">),</span>
                                <span class="s1">&#39;processor_name&#39;</span><span class="p">:</span> <span class="n">processor_name</span><span class="p">,</span>
                                <span class="s1">&#39;process_id&#39;</span><span class="p">:</span> <span class="n">process_id</span><span class="p">,</span>
                                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="p">}</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error parsing log line: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">current_entry</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                                <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="n">level</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                                <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">source</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">),</span>
                                <span class="s1">&#39;processor_name&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                <span class="s1">&#39;process_id&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="p">}</span>
                        <span class="n">details_lines</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">collecting_details</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1"># Check if this is the start of details</span>
                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Details: &#39;</span><span class="p">):</span>
                    <span class="n">collecting_details</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">details_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">]</span>

                <span class="c1"># Add to details if we&#39;re collecting them</span>
                <span class="k">elif</span> <span class="n">collecting_details</span> <span class="ow">and</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">details_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>


            <span class="c1"># Don&#39;t forget to add the last entry</span>
            <span class="k">if</span> <span class="n">current_entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">details_lines</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">details_text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">details_lines</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">details_text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Details: &#39;</span><span class="p">):</span>
                            <span class="n">details_text</span> <span class="o">=</span> <span class="n">details_text</span><span class="p">[</span><span class="mi">9</span><span class="p">:]</span>
                        <span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">details_text</span><span class="p">))</span>
                    <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
                        <span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;raw&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">details_lines</span><span class="p">)})</span>

                <span class="c1"># Add to request logs if process_id matches</span>
                <span class="k">if</span> <span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;process_id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">request_logs</span><span class="p">:</span>
                    <span class="n">request_logs</span><span class="p">[</span><span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;process_id&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_entry</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading log file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">request_logs</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">home</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dashboard main page route.</span>
<span class="sd">    Displays statistics about recent requests.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize statistics</span>
    <span class="n">stats</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;total_requests&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;avg_duration&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s1">&#39;success_rate&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s1">&#39;total_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;hourly_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;operations&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;processor_stats&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;hourly_stats&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;recent_requests&#39;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Load performance data</span>
        <span class="n">perf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;logs&#39;</span><span class="p">,</span> <span class="s1">&#39;performance.json&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading performance data from </span><span class="si">{</span><span class="n">perf_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">perf_path</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Performance file not found at </span><span class="si">{</span><span class="n">perf_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;dashboard.html&#39;</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span> <span class="n">system_info</span><span class="o">=</span><span class="n">get_system_info</span><span class="p">())</span>

        <span class="c1"># Prüfe, ob die Datei leer ist</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">perf_path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Performance file is empty&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;dashboard.html&#39;</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span> <span class="n">system_info</span><span class="o">=</span><span class="n">get_system_info</span><span class="p">())</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">perf_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">perf_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">perf_data</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Performance data is empty&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;dashboard.html&#39;</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span> <span class="n">system_info</span><span class="o">=</span><span class="n">get_system_info</span><span class="p">())</span>

        <span class="c1"># Calculate time window</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="n">day_ago</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Filter recent requests and ensure timestamp is valid</span>
        <span class="n">recent_requests</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">perf_data</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;+00:00&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">timestamp</span> <span class="o">&gt;</span> <span class="n">day_ago</span><span class="p">:</span>
                    <span class="n">r</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
                    <span class="n">recent_requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing request timestamp: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="k">if</span> <span class="n">recent_requests</span><span class="p">:</span>
            <span class="c1"># Basic statistics</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_requests&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_requests</span><span class="p">)</span>
            <span class="n">total_duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_duration&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">)</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;avg_duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_duration</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_requests</span><span class="p">)</span>

            <span class="c1"># Success rate calculation</span>
            <span class="n">success_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recent_requests</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;success&#39;</span><span class="p">)</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;success_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">success_count</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_requests</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>

            <span class="c1"># Token calculation</span>
            <span class="n">total_tokens</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_tokens&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">)</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;hourly_tokens&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_tokens</span> <span class="o">//</span> <span class="mi">24</span> <span class="k">if</span> <span class="n">total_tokens</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

            <span class="c1"># Operation statistics</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;operations&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">op_name</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;operations&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">:</span>
                        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;operations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">operations_dict</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;operations&#39;</span><span class="p">])</span>
                    <span class="n">operations_dict</span><span class="p">[</span><span class="n">op_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">operations_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">op_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="c1"># Processor statistics</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">processor</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;processors&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">processor</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;processor_stats&#39;</span><span class="p">]:</span>
                        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;processor_stats&#39;</span><span class="p">][</span><span class="n">processor</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;request_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;total_duration&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;success_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;error_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;total_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;total_cost&#39;</span><span class="p">:</span> <span class="mi">0</span>
                        <span class="p">}</span>

                    <span class="n">proc_stats</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;processor_stats&#39;</span><span class="p">][</span><span class="n">processor</span><span class="p">]</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;request_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;total_duration&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_duration&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;success_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;success_count&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;error_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error_count&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                    <span class="c1"># Add token and cost data if available</span>
                    <span class="n">resources</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;total_tokens&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_tokens&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;total_cost&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_cost&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

            <span class="c1"># Calculate averages for processor stats</span>
            <span class="k">for</span> <span class="n">proc_stats</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;processor_stats&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">req_count</span> <span class="o">=</span> <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;request_count&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">req_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;avg_duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;total_duration&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">req_count</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;success_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;success_count&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">req_count</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;avg_tokens&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;total_tokens&#39;</span><span class="p">]</span> <span class="o">//</span> <span class="n">req_count</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;avg_cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;total_cost&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">req_count</span>

            <span class="c1"># Hourly statistics</span>
            <span class="n">hour_counts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">hour</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:00&#39;</span><span class="p">)</span>
                    <span class="n">hour_counts</span><span class="p">[</span><span class="n">hour</span><span class="p">]</span> <span class="o">=</span> <span class="n">hour_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hour</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing hour statistics: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>

            <span class="c1"># Sort hours and create final hourly stats</span>
            <span class="n">sorted_hours</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">hour_counts</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;hourly_stats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">hour</span><span class="p">:</span> <span class="n">hour_counts</span><span class="p">[</span><span class="n">hour</span><span class="p">]</span> <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="n">sorted_hours</span><span class="p">}</span>

            <span class="c1"># Process recent requests (last 10)</span>
            <span class="n">recent_requests</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">recent_requests</span><span class="p">,</span> 
                                  <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span>
                                  <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>

            <span class="c1"># Add logs to recent requests</span>
            <span class="n">request_logs</span> <span class="o">=</span> <span class="n">load_logs_for_requests</span><span class="p">(</span><span class="n">recent_requests</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">:</span>
                <span class="n">process_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;process_id&#39;</span><span class="p">)</span>
                <span class="n">request</span><span class="p">[</span><span class="s1">&#39;logs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request_logs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">process_id</span><span class="p">,</span> <span class="p">[])</span> <span class="k">if</span> <span class="n">process_id</span> <span class="k">else</span> <span class="p">[]</span>

                <span class="c1"># Get the main operation</span>
                <span class="n">main_op</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;operations&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;operation&#39;</span><span class="p">):</span>
                        <span class="n">main_op</span> <span class="o">=</span> <span class="n">op</span>
                        <span class="k">break</span>

                <span class="c1"># Prepare the main process data</span>
                <span class="n">request</span><span class="p">[</span><span class="s1">&#39;main_process&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;duration_seconds&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_duration&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
                    <span class="s1">&#39;operation&#39;</span><span class="p">:</span> <span class="n">main_op</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;processor&#39;</span><span class="p">:</span> <span class="n">main_op</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;processor&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;file_size&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file_size&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="s1">&#39;duration&#39;</span><span class="p">:</span> <span class="n">main_op</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;text_length&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)),</span>
                    <span class="s1">&#39;llm_model&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;models_used&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s1">&#39;tokens&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_tokens&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">}</span>

            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;recent_requests&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recent_requests</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing dashboard data: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;dashboard.html&#39;</span><span class="p">,</span> 
                         <span class="n">stats</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span>
                         <span class="n">system_info</span><span class="o">=</span><span class="n">get_system_info</span><span class="p">())</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/config&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">save_config</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Speichert die Konfiguration in der config.yaml.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">yaml_content</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">yaml_content</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Keine YAML-Daten empfangen&quot;</span><span class="p">}),</span> <span class="mi">400</span>

        <span class="c1"># Parse YAML-String zu Dictionary</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">config_data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">yaml_content</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Ungültiges YAML Format: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}),</span> <span class="mi">400</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="c1"># Extrahiere und validiere API Key, falls vorhanden</span>
        <span class="n">api_key_updated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;api_keys&#39;</span> <span class="ow">in</span> <span class="n">config_data</span> <span class="ow">and</span> <span class="s1">&#39;openai_api_key&#39;</span> <span class="ow">in</span> <span class="n">config_data</span><span class="p">[</span><span class="s1">&#39;api_keys&#39;</span><span class="p">]:</span>
            <span class="n">api_key</span> <span class="o">=</span> <span class="n">config_data</span><span class="p">[</span><span class="s1">&#39;api_keys&#39;</span><span class="p">][</span><span class="s1">&#39;openai_api_key&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">api_key</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">api_key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;sk-...&#39;</span><span class="p">):</span>  <span class="c1"># Nur speichern wenn es kein maskierter Key ist</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Verwende die ConfigKeys-Klasse anstatt config.set_api_key</span>
                    <span class="kn">from</span><span class="w"> </span><span class="nn">src.core.config_keys</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigKeys</span>
                    <span class="n">config_keys</span> <span class="o">=</span> <span class="n">ConfigKeys</span><span class="p">()</span>
                    <span class="n">config_keys</span><span class="o">.</span><span class="n">set_openai_api_key</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>
                    <span class="n">api_key_updated</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}),</span> <span class="mi">400</span>
            <span class="c1"># Entferne API Keys aus config_data</span>
            <span class="k">del</span> <span class="n">config_data</span><span class="p">[</span><span class="s1">&#39;api_keys&#39;</span><span class="p">]</span>

        <span class="c1"># Hole den Pfad zur config.yaml</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="s1">&#39;config&#39;</span> <span class="o">/</span> <span class="s1">&#39;config.yaml&#39;</span>

        <span class="c1"># Speichere die aktualisierte Konfiguration</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">config_data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;API Key aktualisiert. &quot;</span> <span class="k">if</span> <span class="n">api_key_updated</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Lade die aktuelle Konfiguration neu</span>
        <span class="n">config_yaml</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_all</span><span class="p">(),</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">Konfiguration erfolgreich gespeichert&quot;</span><span class="p">,</span>
            <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="n">config_yaml</span>
        <span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Fehler beim Speichern der Konfiguration&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Speichern: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/config&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">config_page</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zeigt die Konfigurationsseite an.</span>

<span class="sd">    Returns:</span>
<span class="sd">        rendered template: Die config.html Template mit der aktuellen Konfiguration</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Lade die aktuelle Konfiguration</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">config_data</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_all</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Config Data:&quot;</span><span class="p">,</span> <span class="n">config_data</span><span class="p">)</span>  <span class="c1"># Debug-Ausgabe</span>

        <span class="c1"># Konvertiere zu YAML</span>
        <span class="n">config_yaml</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">config_data</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Config YAML:&quot;</span><span class="p">,</span> <span class="n">config_yaml</span><span class="p">)</span>  <span class="c1"># Debug-Ausgabe</span>

        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;config.html&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config_yaml</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Fehler beim Laden der Konfiguration&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>  <span class="c1"># Debug-Ausgabe</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;config.html&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/test&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_page</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test page with Swagger UI integration for API testing</span>

<span class="sd">    Returns:</span>
<span class="sd">        rendered template: The apitest.html template with Swagger UI</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;apitest.html&#39;</span><span class="p">)</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/test-procedures&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_procedures</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zeigt die Testseite an.</span>

<span class="sd">    Returns:</span>
<span class="sd">        rendered template: Die test_procedures.html Template</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;test_procedures.html&#39;</span><span class="p">)</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/run_youtube_test&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">youtube_test</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Route handler for Youtube test&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">run_youtube_test</span><span class="p">()</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/run_audio_test&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">audio_test</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Route handler for audio test&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">run_audio_test</span><span class="p">()</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/run_transformer_test&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">transformer_test</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Route handler for transformer test&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">run_transformer_test</span><span class="p">()</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/run_health_test&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">health_test</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Route handler for health test&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">run_health_test</span><span class="p">()</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/logs&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">logs</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zeigt die Logs der Anwendung an.</span>

<span class="sd">    Diese Funktion lädt die in der config.yaml definierte Log-Datei und zeigt die letzten X Einträge an.</span>
<span class="sd">    Die Log-Datei wird zentral durch den LoggerService initialisiert.</span>

<span class="sd">    Returns:</span>
<span class="sd">        rendered template: Die logs.html Template mit den Log-Einträgen</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Lade Konfiguration</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">config_data</span><span class="p">:</span> <span class="n">ApplicationConfig</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_all</span><span class="p">()</span>

        <span class="n">max_entries</span> <span class="o">=</span> <span class="n">config_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;logging&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_log_entries&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">log_file</span> <span class="o">=</span> <span class="n">config_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;logging&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;logs/detailed.log&#39;</span><span class="p">)</span>
        <span class="n">log_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span>

        <span class="n">log_files</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Lese die Log-Datei</span>
        <span class="k">if</span> <span class="n">log_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">log_files</span><span class="p">[</span><span class="n">log_file</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="o">-</span><span class="n">max_entries</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log_files</span><span class="p">[</span><span class="n">log_file</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;logs.html&#39;</span><span class="p">,</span> <span class="n">log_files</span><span class="o">=</span><span class="n">log_files</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Laden der Logs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Laden der Logs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/clear-logs&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">clear_logs</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Löscht den Inhalt der Log-Datei und stellt sicher, dass sie danach wieder existiert.</span>
<span class="sd">    Die Log-Datei wird mit einem leeren Inhalt neu erstellt.</span>

<span class="sd">    Returns:</span>
<span class="sd">        redirect: Leitet zurück zur Logs-Ansicht</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Lade Log-Pfad aus der Konfiguration</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">log_file</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_all</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;logging&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;logs/detailed.log&#39;</span><span class="p">)</span>
        <span class="n">log_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span>

        <span class="c1"># Stelle sicher, dass das Verzeichnis existiert</span>
        <span class="n">log_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Leere die Datei oder erstelle sie neu</span>
        <span class="n">log_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;main.logs&#39;</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error clearing logs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/recent-requests&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_recent_requests</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Abrufen der neuesten Anfragen.</span>
<span class="sd">    Gibt die letzten 10 Anfragen zurück.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Response: JSON mit den neuesten Anfragen</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Load performance data</span>
        <span class="n">perf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;logs&#39;</span><span class="p">,</span> <span class="s1">&#39;performance.json&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">perf_path</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">([])</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">perf_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">perf_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">perf_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">([])</span>

        <span class="c1"># Calculate time window</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="n">day_ago</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Filter recent requests and ensure timestamp is valid</span>
        <span class="n">recent_requests</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">perf_data</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;+00:00&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">timestamp</span> <span class="o">&gt;</span> <span class="n">day_ago</span><span class="p">:</span>
                    <span class="n">r</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
                    <span class="n">recent_requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing request timestamp: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="c1"># Sort by timestamp (newest first) and take last 10</span>
        <span class="n">recent_requests</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">recent_requests</span><span class="p">,</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>

        <span class="c1"># Render only the requests list part</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;_recent_requests.html&#39;</span><span class="p">,</span> 
                             <span class="n">recent_requests</span><span class="o">=</span><span class="n">recent_requests</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;html&#39;</span><span class="p">:</span> <span class="n">html</span><span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting recent requests: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;html&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;&lt;div class=&quot;text-danger&quot;&gt;Fehler beim Laden: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&lt;/div&gt;&#39;</span><span class="p">})</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/docs-view/&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">docs_view</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper-Ansicht für die Dokumentation mit App-Navigation.</span>
<span class="sd">    Lädt die MkDocs-Site in einem iframe, damit die Top-Navigation erhalten bleibt.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;docs_wrapper.html&#39;</span><span class="p">)</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/event-monitor&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">event_monitor</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zeigt die Monitoring-Seite für asynchrone Event-Verarbeitung an.</span>
<span class="sd">    Hier werden aktuelle Batches und archivierte Batches aus dem event-job API-Endpoint angezeigt.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Konfigurationsdaten laden (sofern benötigt)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">event_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;processors.event&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">max_concurrent_tasks</span> <span class="o">=</span> <span class="n">event_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_concurrent_tasks&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Basis-URL für API-Anfragen</span>
        <span class="n">api_base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="c1"># Filterparameter aus dem Request</span>
        <span class="n">status_filter</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">date_filter</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># Aktuelle (nicht-archivierte) Batches abrufen</span>
        <span class="n">current_batches_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_base_url</span><span class="si">}</span><span class="s2">/api/event-job/batches?archived=false&quot;</span>
        <span class="k">if</span> <span class="n">status_filter</span><span class="p">:</span>
            <span class="n">current_batches_url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&amp;status=</span><span class="si">{</span><span class="n">status_filter</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Standardwerte initialisieren, um Schattierung/Redeklaration zu vermeiden</span>
        <span class="n">current_batches_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;batches&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="n">jobs_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># HTTP-Request für aktuelle Batches</span>
            <span class="n">current_batches_response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">current_batches_url</span><span class="p">)</span>
            <span class="n">current_batches_response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="n">current_batches_data</span> <span class="o">=</span> <span class="n">current_batches_response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="c1"># KEINE Jobs mehr vorab laden - das wird bei Bedarf über JavaScript gemacht</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der aktuellen Batch-Daten: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Daten für das Template vorbereiten</span>
        <span class="n">event_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;current_batches&quot;</span><span class="p">:</span> <span class="n">current_batches_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;batches&#39;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="s2">&quot;jobs_data&quot;</span><span class="p">:</span> <span class="n">jobs_data</span><span class="p">,</span>
            <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status_filter</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">date_filter</span>
            <span class="p">},</span>
            <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;max_concurrent_tasks&quot;</span><span class="p">:</span> <span class="n">max_concurrent_tasks</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;event_monitor.html&#39;</span><span class="p">,</span> <span class="n">event_data</span><span class="o">=</span><span class="n">event_data</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Laden der Event-Monitor-Seite: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Laden der Event-Monitor-Seite: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_batches</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Abrufen von Batch-Daten für die Event-Monitor-Oberfläche.</span>
<span class="sd">    Unterstützt Paginierung und Filterung.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Query-Parameter extrahieren</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span>
        <span class="n">status_filter</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">archived_filter</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;archived&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># Normalisieren zu Kleinbuchstaben</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;limit&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>

        <span class="c1"># Verwende verschiedene Routen basierend auf dem Status-Filter</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">api_base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="c1"># URL mit Status- und Archiv-Filter erstellen</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_base_url</span><span class="si">}</span><span class="s2">/api/event-job/batches?limit=</span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Filter hinzufügen</span>
        <span class="n">filters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">status_filter</span><span class="p">:</span>
            <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;status=</span><span class="si">{</span><span class="n">status_filter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Archived-Parameter korrekt übergeben (als String &#39;true&#39; oder &#39;false&#39;)</span>
        <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;archived=</span><span class="si">{</span><span class="n">archived_filter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Filter zur URL hinzufügen</span>
        <span class="k">if</span> <span class="n">filters</span><span class="p">:</span>
            <span class="n">filter_string</span> <span class="o">=</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">&amp;</span><span class="si">{</span><span class="n">filter_string</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">base_url</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch-Anfrage an: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Batch-Daten: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Batch-Daten: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Batch-Daten: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Batch-Daten: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/job/&lt;job_id&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_job_detail</span><span class="p">(</span><span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Abrufen der Details eines einzelnen Jobs anhand seiner ID.</span>

<span class="sd">    :param job_id: Die ID des Jobs, dessen Details abgerufen werden sollen.</span>
<span class="sd">    :return: JSON-Antwort mit den Job-Details oder einer Fehlermeldung.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">job_id</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine job_id in der Anfrage&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;job_id ist ein erforderlicher Parameter&quot;</span>
        <span class="p">}),</span> <span class="mi">400</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># API-Basis-URL aus der Konfiguration laden</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lade Job-Details für job_id: </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Verwende die generische get-Methode für die API-Basis-URL</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">base_url</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine API-Basis-URL konfiguriert&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;API-Basis-URL nicht konfiguriert&quot;</span>
            <span class="p">}),</span> <span class="mi">500</span>

        <span class="c1"># Erstelle die Anfrage-URL für einen einzelnen Job</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/event-job/jobs/</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rufe API auf: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Führe die Anfrage durch</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Verarbeite die Antwort</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job-Detail API-Antwort erhalten: </span><span class="si">{</span><span class="n">response_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Prüfe, ob der Job in der Antwort enthalten ist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Kein Job in der API-Antwort gefunden für job_id: </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Job mit ID </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> nicht gefunden&quot;</span>
            <span class="p">}),</span> <span class="mi">404</span>

        <span class="c1"># Bereite die Antwort vor - direkte Struktur ohne Wrapping in &#39;data&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;job&quot;</span><span class="p">:</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Formatierte Antwort: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/jobs&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_jobs</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># API-Basis-URL aus der Konfiguration laden</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Lade Jobs&quot;</span><span class="p">)</span>

        <span class="c1"># Verwende die generische get-Methode anstelle einer nicht existierenden get_api_base_url-Methode</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">base_url</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine API-Basis-URL konfiguriert&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;API-Basis-URL nicht konfiguriert&quot;</span>
            <span class="p">}),</span> <span class="mi">500</span>

        <span class="c1"># Extrahiere alle Query-Parameter</span>
        <span class="n">batch_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;batch_id&#39;</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span>

        <span class="c1"># Erstelle die Basis-URL für Jobs</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/event-job/jobs&quot;</span>

        <span class="c1"># Füge Query-Parameter hinzu, wenn vorhanden</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">batch_id</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;batch_id=</span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;status=</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">?</span><span class="si">{</span><span class="s1">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rufe API auf: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Führe die Anfrage durch</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Verarbeite die Antwort</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jobs API-Antwort erhalten: </span><span class="si">{</span><span class="n">response_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Bereite die Antwort vor</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;jobs&quot;</span><span class="p">:</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;jobs&#39;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Formatierte Antwort: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;jobs&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/job/&lt;job_id&gt;/restart&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_job_restart</span><span class="p">(</span><span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Neustarten eines Jobs durch Zurücksetzen seines Status.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Konfiguration laden für API-Basis-URL</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="c1"># Request-Daten extrahieren (optional: batch_id)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;batch_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># Verwende die generische get-Methode für die API-Basis-URL</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>
        <span class="c1"># Korrigierter API-Pfad mit /api/ Präfix</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/event-job/</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">/restart&quot;</span>

        <span class="c1"># Debug-Ausgabe für die Problemdiagnose</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sende Neustart-Anfrage an: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Führe die API-Anfrage durch</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span> 
            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;batch_id&#39;</span><span class="p">:</span> <span class="n">batch_id</span><span class="p">},</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Verarbeite die Antwort</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job-Neustart API-Antwort erhalten: </span><span class="si">{</span><span class="n">response_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Bereite die Antwort vor</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> wurde erfolgreich für den Neustart markiert&quot;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;job&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Formatierte Antwort: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Neustarten des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Neustarten des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/job/&lt;job_id&gt;/archive&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_job_archive</span><span class="p">(</span><span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Archivieren eines Jobs durch Änderung des Status.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Konfiguration laden für API-Basis-URL</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="c1"># Request-Daten extrahieren (optional: batch_id)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;batch_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># Verwende die generische get-Methode für die API-Basis-URL</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/event-job/</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">/archive&quot;</span>

        <span class="c1"># Führe die API-Anfrage durch</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span> 
            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;batch_id&#39;</span><span class="p">:</span> <span class="n">batch_id</span><span class="p">},</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Verarbeite die Antwort</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job-Archivierung API-Antwort erhalten: </span><span class="si">{</span><span class="n">response_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Bereite die Antwort vor</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> wurde erfolgreich archiviert&quot;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;job&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Formatierte Antwort: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Archivieren des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Archivieren des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>


<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/jobs/&lt;job_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DELETE&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_job_delete</span><span class="p">(</span><span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Löschen eines Jobs.</span>

<span class="sd">    :param job_id: Die ID des Jobs, der gelöscht werden soll.</span>
<span class="sd">    :return: JSON-Antwort mit Erfolgsmeldung oder Fehlermeldung.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">job_id</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine job_id in der Anfrage&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;job_id ist ein erforderlicher Parameter&quot;</span>
        <span class="p">}),</span> <span class="mi">400</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># API-Basis-URL aus der Konfiguration laden</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lösche Job mit job_id: </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Verwende die generische get-Methode für die API-Basis-URL</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">base_url</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine API-Basis-URL konfiguriert&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;API-Basis-URL nicht konfiguriert&quot;</span>
            <span class="p">}),</span> <span class="mi">500</span>

        <span class="c1"># Erstelle die Anfrage-URL für das Löschen eines Jobs</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/event-job/jobs/</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rufe API auf (DELETE): </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Führe die Anfrage durch</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Verarbeite die Antwort</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job-Löschung API-Antwort erhalten: </span><span class="si">{</span><span class="n">response_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Bereite die Antwort vor</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> wurde erfolgreich gelöscht&quot;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Formatierte Antwort: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Löschen des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Löschen des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/&lt;batch_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DELETE&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_batch_delete</span><span class="p">(</span><span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Löschen eines Batches und aller zugehörigen Jobs.</span>

<span class="sd">    :param batch_id: Die ID des Batches, der gelöscht werden soll.</span>
<span class="sd">    :return: JSON-Antwort mit Erfolgsmeldung oder Fehlermeldung.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">batch_id</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine batch_id in der Anfrage&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;batch_id ist ein erforderlicher Parameter&quot;</span>
        <span class="p">}),</span> <span class="mi">400</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># API-Basis-URL aus der Konfiguration laden</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lösche Batch mit batch_id: </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Verwende die generische get-Methode für die API-Basis-URL</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">base_url</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine API-Basis-URL konfiguriert&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;API-Basis-URL nicht konfiguriert&quot;</span>
            <span class="p">}),</span> <span class="mi">500</span>

        <span class="c1"># Erstelle die Anfrage-URL für das Löschen eines Batches</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/event-job/batches/</span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rufe API auf (DELETE): </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Führe die Anfrage durch</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Verarbeite die Antwort</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch-Löschung API-Antwort erhalten: </span><span class="si">{</span><span class="n">response_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Bereite die Antwort vor</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Batch </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2"> wurde erfolgreich gelöscht&quot;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Formatierte Antwort: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Löschen des Batches: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Löschen des Batches: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/&lt;string:batch_id&gt;/stats&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_batch_stats</span><span class="p">(</span><span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Abrufen aktueller Statistiken eines Batches ohne Änderungen in der Datenbank.</span>
<span class="sd">    Dies ist nützlich für Live-Updates im Frontend ohne vollständige Seitenneuladen.</span>

<span class="sd">    :param batch_id: Die ID des Batches, dessen Statistiken abgerufen werden sollen.</span>
<span class="sd">    :return: JSON-Antwort mit den aktuellen Batch-Statistiken.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">batch_id</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine batch_id in der Anfrage&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;batch_id ist ein erforderlicher Parameter&quot;</span>
        <span class="p">}),</span> <span class="mi">400</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Direkt das Repository für effizientere Abfragen verwenden</span>
        <span class="n">job_repo</span><span class="p">:</span> <span class="n">SessionJobRepository</span> <span class="o">=</span> <span class="n">get_job_repository</span><span class="p">()</span>

        <span class="c1"># Batch mit aktuellen Statistiken abrufen, ohne Status zu ändern</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">get_batch_with_current_stats</span><span class="p">(</span><span class="n">batch_id</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">batch</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch nicht gefunden: </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Batch mit ID </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2"> nicht gefunden&quot;</span>
            <span class="p">}),</span> <span class="mi">404</span>

        <span class="c1"># Erfolgsantwort zurückgeben</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;batch&quot;</span><span class="p">:</span> <span class="n">batch</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
        <span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Batch-Statistiken: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Batch-Statistiken: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/&lt;string:batch_id&gt;/toggle-active&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_toggle_active</span><span class="p">(</span><span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Umschalten des isActive-Status eines Batches.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Konfiguration laden für API-Basis-URL</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">api_base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="c1"># Request-Daten (falls vorhanden) weitergeben</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">is_json</span> <span class="k">else</span> <span class="p">{})</span>

        <span class="c1"># API-Anfrage zur Umschaltung des isActive-Status</span>
        <span class="c1"># Verwende standardisierte Event-Job-API-URL</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_base_url</span><span class="si">}</span><span class="s2">/api/event-job/batches/</span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">/toggle-active&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Toggle-Active-Anfrage an: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> mit Daten: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Antwort verarbeiten</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="c1"># Erfolgsantwort zurückgeben</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Umschalten des isActive-Status: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Umschalten des isActive-Status: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/&lt;string:batch_id&gt;/archive&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_batch_archive</span><span class="p">(</span><span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Archivieren eines Batches.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Konfiguration laden für API-Basis-URL</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">api_base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="c1"># Request-Daten (falls vorhanden) weitergeben oder Standarddaten verwenden</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">is_json</span> <span class="k">else</span> <span class="p">{})</span>

        <span class="c1"># Sicherstellen, dass die Mindestanforderungen erfüllt sind</span>
        <span class="k">if</span> <span class="s1">&#39;batch_id&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;batch_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">batch_id</span>
        <span class="k">if</span> <span class="s1">&#39;archived&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;archived&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archiviere Batch </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2"> mit Daten: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># API-Anfrage zum Archivieren des Batches</span>
        <span class="c1"># Korrigierte URL-Konstruktion - prüfe, ob Basis-URL bereits den API-Pfad enthält</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_base_url</span><span class="si">}</span><span class="s2">/api/event-job/batches/</span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">/archive&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch-Archivierung-Anfrage an: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Initialisiere response als None</span>
        <span class="n">response</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

            <span class="c1"># Antwort verarbeiten</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

            <span class="c1"># Erfolgsantwort zurückgeben</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">http_err</span><span class="p">:</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;HTTP-Fehler beim Archivieren des Batches: </span><span class="si">{</span><span class="n">http_err</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>

            <span class="c1"># Versuche, Details aus der Antwort zu extrahieren, wenn response existiert</span>
            <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">error_details</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;API-Fehlerdetails: </span><span class="si">{</span><span class="n">error_details</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">error_message</span><span class="p">,</span>
                        <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="n">error_details</span>
                    <span class="p">}),</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">error_message</span>
                <span class="p">}),</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

            <span class="c1"># Standardantwort, wenn keine Antwort vom Server kam</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">error_message</span>
            <span class="p">}),</span> <span class="mi">500</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Archivieren des Batches </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/&lt;string:batch_id&gt;/restart&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_batch_restart</span><span class="p">(</span><span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Neustarten aller Jobs in einem Batch.</span>

<span class="sd">    :param batch_id: Die ID des Batches, dessen Jobs neu gestartet werden sollen.</span>
<span class="sd">    :return: JSON-Antwort mit Erfolgsmeldung oder Fehlermeldung.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">batch_id</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine batch_id in der Anfrage&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;batch_id ist ein erforderlicher Parameter&quot;</span>
        <span class="p">}),</span> <span class="mi">400</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Repository-Instanz holen</span>
        <span class="n">job_repo</span> <span class="o">=</span> <span class="n">get_job_repository</span><span class="p">()</span>

        <span class="c1"># Alle Jobs des Batches auf einmal auf PENDING setzen</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">update_jobs_status_by_batch</span><span class="p">(</span><span class="n">batch_id</span><span class="p">,</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Erfolgsantwort zurückgeben</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2"> Jobs wurden neu gestartet&quot;</span><span class="p">,</span>
                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;restarted_jobs&quot;</span><span class="p">:</span> <span class="n">result</span>
                <span class="p">}</span>
            <span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Keine Jobs für diesen Batch gefunden&quot;</span><span class="p">,</span>
                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;restarted_jobs&quot;</span><span class="p">:</span> <span class="mi">0</span>
                <span class="p">}</span>
            <span class="p">}),</span> <span class="mi">200</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Neustarten des Batches </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/fail-all&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_fail_all_batches</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Setzen aller aktiven Batches auf failed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># API-URL zusammenbauen</span>
        <span class="n">api_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;API_BASE_URL&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/event-job/batches/fail-all&quot;</span>

        <span class="c1"># Headers vorbereiten</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span>
        <span class="p">}</span>

        <span class="c1"># Benutzer-ID aus den Headern weiterleiten</span>
        <span class="k">if</span> <span class="s1">&#39;X-User-ID&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
            <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-User-ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-User-ID&#39;</span><span class="p">]</span>

        <span class="c1"># API-Aufruf durchführen</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Erfolgreiche Antwort</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()),</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">http_err</span><span class="p">:</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;HTTP-Fehler beim Setzen der Batches auf failed: </span><span class="si">{</span><span class="n">http_err</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">error_message</span>
        <span class="p">}),</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">http_err</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;status_code&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Setzen der Batches auf failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">error_message</span>
        <span class="p">}),</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/force-fail-all&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_force_fail_all</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum direkten Setzen ALLER Batches und Jobs auf failed.</span>
<span class="sd">    Dies ist eine direkte Datenbankoperation, die alle Batches und Jobs betrifft.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Repository-Instanz holen</span>
        <span class="n">job_repo</span> <span class="o">=</span> <span class="n">get_job_repository</span><span class="p">()</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>  <span class="c1"># Verwende utcnow statt now(UTC)</span>

        <span class="c1"># Direkte Batch-Aktualisierung</span>
        <span class="n">batch_result</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;archived&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$ne&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>  <span class="c1"># Nicht archivierte Batches</span>
            <span class="p">{</span>
                <span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;failed&quot;</span><span class="p">,</span>  <span class="c1"># Kleinbuchstaben statt Großbuchstaben</span>
                    <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
                    <span class="s2">&quot;completed_at&quot;</span><span class="p">:</span> <span class="n">now</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Direkte Job-Aktualisierung für alle Jobs</span>
        <span class="n">job_result</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span>
            <span class="p">{},</span>  <span class="c1"># Alle Jobs</span>
            <span class="p">{</span>
                <span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;failed&quot;</span><span class="p">,</span>  <span class="c1"># Kleinbuchstaben statt Großbuchstaben</span>
                    <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
                    <span class="s2">&quot;completed_at&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
                    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;FORCED_FAILURE&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Job wurde manuell auf failed gesetzt&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;forced_at&quot;</span><span class="p">:</span> <span class="n">now</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                            <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Manuelle Massenaktualisierung&quot;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Log die Änderungen</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Force-fail-all ausgeführt&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;updated_batches&quot;</span><span class="p">:</span> <span class="n">batch_result</span><span class="o">.</span><span class="n">modified_count</span><span class="p">,</span>
                <span class="s2">&quot;updated_jobs&quot;</span><span class="p">:</span> <span class="n">job_result</span><span class="o">.</span><span class="n">modified_count</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">batch_result</span><span class="o">.</span><span class="n">modified_count</span><span class="si">}</span><span class="s2"> Batches und </span><span class="si">{</span><span class="n">job_result</span><span class="o">.</span><span class="n">modified_count</span><span class="si">}</span><span class="s2"> Jobs auf failed gesetzt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;updated_batches&quot;</span><span class="p">:</span> <span class="n">batch_result</span><span class="o">.</span><span class="n">modified_count</span><span class="p">,</span>
                <span class="s2">&quot;updated_jobs&quot;</span><span class="p">:</span> <span class="n">job_result</span><span class="o">.</span><span class="n">modified_count</span>
            <span class="p">}</span>
        <span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Setzen aller Batches und Jobs auf failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">error_message</span>
        <span class="p">}),</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/set-pending-all&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_set_pending_all</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setzt alle nicht archivierten Batches und deren Jobs auf &#39;pending&#39;.</span>
<span class="sd">    Parameter:</span>
<span class="sd">    - target_language: Die neue Zielsprache (z.B. &#39;de&#39;, &#39;en&#39;, etc.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">target_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;target_language&#39;</span><span class="p">)</span>
        <span class="n">job_repository</span> <span class="o">=</span> <span class="n">get_job_repository</span><span class="p">()</span>

        <span class="c1"># Hole alle nicht archivierten Batches</span>
        <span class="n">batches</span> <span class="o">=</span> <span class="n">job_repository</span><span class="o">.</span><span class="n">get_batches</span><span class="p">(</span><span class="n">archived</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">updated_batches</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">updated_jobs</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Aktualisiere jeden Batch und seine Jobs</span>
        <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">batches</span><span class="p">:</span>
            <span class="c1"># Aktualisiere Batch und alle zugehörigen Jobs auf PENDING</span>
            <span class="k">if</span> <span class="n">job_repository</span><span class="o">.</span><span class="n">update_batch_status</span><span class="p">(</span><span class="n">batch</span><span class="o">.</span><span class="n">batch_id</span><span class="p">,</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">):</span>
                <span class="n">updated_batches</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Aktualisiere alle Jobs des Batches</span>
            <span class="n">jobs_updated</span> <span class="o">=</span> <span class="n">job_repository</span><span class="o">.</span><span class="n">update_jobs_status_by_batch</span><span class="p">(</span>
                <span class="n">batch</span><span class="o">.</span><span class="n">batch_id</span><span class="p">,</span> 
                <span class="n">JobStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">,</span>
                <span class="n">language</span><span class="o">=</span><span class="n">target_language</span>
            <span class="p">)</span>
            <span class="n">updated_jobs</span> <span class="o">+=</span> <span class="n">jobs_updated</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Alle Batches auf pending gesetzt&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;updated_batches&quot;</span><span class="p">:</span> <span class="n">updated_batches</span><span class="p">,</span>
                <span class="s2">&quot;updated_jobs&quot;</span><span class="p">:</span> <span class="n">updated_jobs</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">updated_batches</span><span class="si">}</span><span class="s2"> Batches und </span><span class="si">{</span><span class="n">updated_jobs</span><span class="si">}</span><span class="s2"> Jobs auf pending gesetzt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;batches_updated&quot;</span><span class="p">:</span> <span class="n">updated_batches</span><span class="p">,</span>
                <span class="s2">&quot;jobs_updated&quot;</span><span class="p">:</span> <span class="n">updated_jobs</span>
            <span class="p">}</span>
        <span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Setzen der Batches auf pending: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="p">}),</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/change-language&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_change_language</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ändert die Zielsprache für alle Jobs oder einen einzelnen Job im Event-Monitor.</span>

<span class="sd">    Parameter:</span>
<span class="sd">    - target_language: Die neue Zielsprache (z.B. &#39;de&#39;, &#39;en&#39;, etc.)</span>
<span class="sd">    - job_id: (Optional) Die ID eines einzelnen Jobs, dessen Sprache geändert werden soll</span>
<span class="sd">    - reset_status: (Optional) Ob der Status der Jobs auf &#39;pending&#39; zurückgesetzt werden soll</span>
<span class="sd">    - current_batches_only: (Optional) Ob nur aktuelle (nicht archivierte) Batches betroffen sein sollen</span>

<span class="sd">    Returns:</span>
<span class="sd">        JSON mit Erfolgs- oder Fehlermeldung</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Daten aus dem Request auslesen</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span> <span class="ow">or</span> <span class="p">{})</span>

        <span class="n">target_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;target_language&#39;</span><span class="p">)</span>
        <span class="n">job_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job_id&#39;</span><span class="p">)</span>
        <span class="n">reset_status</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reset_status&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">current_batches_only</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_batches_only&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_language</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Zielsprache (target_language) ist erforderlich&#39;</span><span class="p">}),</span> <span class="mi">400</span>

        <span class="c1"># Repository und weitere benötigte Objekte initialisieren</span>
        <span class="n">job_repo</span> <span class="o">=</span> <span class="n">get_job_repository</span><span class="p">()</span>
        <span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Bestimmen, ob ein einzelner Job oder mehrere Jobs aktualisiert werden sollen</span>
        <span class="k">if</span> <span class="n">job_id</span><span class="p">:</span>
            <span class="c1"># Einzelnen Job aktualisieren</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ändere Zielsprache für Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> auf </span><span class="si">{</span><span class="n">target_language</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">job</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Job mit ID </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s1"> nicht gefunden&#39;</span><span class="p">}),</span> <span class="mi">404</span>

            <span class="c1"># Job-Parameter aktualisieren</span>
            <span class="n">job_parameters</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">parameters</span> <span class="k">else</span> <span class="p">{}</span>
            <span class="n">job_parameters</span><span class="p">[</span><span class="s1">&#39;target_language&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_language</span>

            <span class="c1"># Status zurücksetzen, falls gewünscht</span>
            <span class="k">if</span> <span class="n">reset_status</span><span class="p">:</span>
                <span class="n">job_repo</span><span class="o">.</span><span class="n">update_job_status</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">)</span>

            <span class="c1"># Job-Parameter aktualisieren</span>
            <span class="n">job_repo</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;job_id&quot;</span><span class="p">:</span> <span class="n">job_id</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">job_parameters</span><span class="p">}}</span>
            <span class="p">)</span>
            <span class="n">success_count</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Zielsprache für Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> erfolgreich auf </span><span class="si">{</span><span class="n">target_language</span><span class="si">}</span><span class="s2"> geändert&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Alle Jobs in Batches aktualisieren</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ändere Zielsprache für alle Jobs auf </span><span class="si">{</span><span class="n">target_language</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Batches abrufen (basierend auf dem &#39;current_batches_only&#39; Parameter)</span>
            <span class="n">batches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Batch</span><span class="p">]</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">get_batches</span><span class="p">(</span><span class="n">archived</span><span class="o">=</span><span class="ow">not</span> <span class="n">current_batches_only</span><span class="p">)</span>

            <span class="c1"># Durch alle Batches iterieren und Jobs aktualisieren</span>
            <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">batches</span><span class="p">:</span>
                <span class="n">batch_id</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">batch_id</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Verarbeite Batch </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Jobs für den aktuellen Batch abrufen</span>
                <span class="n">jobs</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">get_jobs_for_batch</span><span class="p">(</span><span class="n">batch_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
                    <span class="c1"># Parameter aktualisieren</span>
                    <span class="n">job_parameters</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">parameters</span> <span class="k">else</span> <span class="p">{}</span>
                    <span class="n">job_parameters</span><span class="p">[</span><span class="s1">&#39;target_language&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_language</span>

                    <span class="c1"># Job-Parameter aktualisieren</span>
                    <span class="n">job_repo</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                        <span class="p">{</span><span class="s2">&quot;job_id&quot;</span><span class="p">:</span> <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">},</span>
                        <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">job_parameters</span><span class="p">}}</span>
                    <span class="p">)</span>
                    <span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1"># Status zurücksetzen, falls gewünscht</span>
                <span class="k">if</span> <span class="n">reset_status</span> <span class="ow">and</span> <span class="n">jobs</span><span class="p">:</span>
                    <span class="n">job_repo</span><span class="o">.</span><span class="n">update_batch_status</span><span class="p">(</span><span class="n">batch_id</span><span class="p">,</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">)</span>
                    <span class="n">job_repo</span><span class="o">.</span><span class="n">update_jobs_status_by_batch</span><span class="p">(</span><span class="n">batch_id</span><span class="p">,</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Zielsprache für </span><span class="si">{</span><span class="n">success_count</span><span class="si">}</span><span class="s2"> Jobs erfolgreich auf </span><span class="si">{</span><span class="n">target_language</span><span class="si">}</span><span class="s2"> geändert&quot;</span><span class="p">)</span>

        <span class="c1"># Erfolgreiche Antwort zurückgeben</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Zielsprache für </span><span class="si">{</span><span class="n">success_count</span><span class="si">}</span><span class="s1"> Job(s) erfolgreich auf </span><span class="si">{</span><span class="n">target_language</span><span class="si">}</span><span class="s1"> geändert&#39;</span><span class="p">,</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;updated_count&#39;</span><span class="p">:</span> <span class="n">success_count</span><span class="p">,</span>
                <span class="s1">&#39;target_language&#39;</span><span class="p">:</span> <span class="n">target_language</span>
            <span class="p">}</span>
        <span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Ändern der Zielsprache: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Fehler beim Ändern der Zielsprache: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}),</span> <span class="mi">500</span> 
</code></pre></div>

Verstanden: 
- Es gibt jetzt `docs/index.md` → wird zu `site/index.html`. Ich habe die Doku-Route so angepasst, dass `/docs` auf `/docs/` weiterleitet und `/docs/` bevorzugt `site/index.html` lädt.
- Top-Navigation erhalten: Ich habe eine Wrapper-Seite mit iframe eingebaut, damit die App-Navigation stehen bleibt und die MkDocs-Doku darunter läuft.

Was ich umgesetzt habe:
- Neue Route `GET /docs-view/` in `src/dashboard/routes/main_routes.py` mit Template `docs_wrapper.html`.
- Navbar „Docs“ verweist nun auf `{{ url_for('main.docs_view') }}` statt direkt auf `/docs/`.
- `docs_wrapper.html` lädt die Doku per iframe: Quelle `/docs/` (deine MkDocs-Site). So bleibt die Top-Navigation sichtbar.
- Doku-Blueprint liefert `/docs`, `/docs/` und statische Unterpfade korrekt aus. Falls `site/index.html` fehlt, wird auf die erste Sektion weitergeleitet.

Nutzen:
- Einheitliche UX. Immer die App-Navigation sichtbar.
- Du kannst jederzeit zur App zurückkehren.
- Die Doku bleibt unverändert im MkDocs-Layout.

Test:
- Baue Doku: `mkdocs build -c -d site` (falls noch nicht).
- Starte App und öffne: `http://127.0.0.1:5001/docs-view/`.
- Prüfe, ob `http://127.0.0.1:5001/docs/` direkt funktioniert (ohne Wrapper), falls du die Doku separat brauchst.

Optional:
- Wenn externe Links aus der Doku im selben Tab landen sollen, können wir `rel`/`target` per JS in der Wrapper-Seite anpassen.
- Falls du statt iframe lieber echte Integration willst (gemeinsames Template), ist das deutlich aufwändiger, da MkDocs statisch rendert. Der iframe ist die einfache und saubere Lösung für Single-Deployment.

---

**User**

Okay, irgendwie habe ich jetzt zwei Scrollbars rechts. Das ist sehr verwirrend. Einmal von meiner Anwendung und dann die von mkdocs. Ist es vielleicht möglich, bei mkdocs im Header oben einen Rückverweis zu integrieren zu unserer Anwendung, zu unserer Homepage, sodass man es so belassen kann, wie es vorher war, aber die Navigation nichts verliert?

---

**Cursor**

Ich entferne die iframe-Variante (um die doppelte Scrollbar zu vermeiden), stelle den Navbar-Link wieder direkt auf `/docs/` um und ergänze in `mkdocs.yml` einen prominenten Rück-Link zur Anwendung (als Top-NAV-Eintrag und als Home-Icon). Danach kannst du in der Doku jederzeit zurück zur App, ohne iframe.

<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Secretary Services Dashboard<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span><span class="p">&gt;</span>
    {% block extra_css %}{% endblock %}
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar navbar-expand-lg navbar-dark bg-dark&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container-fluid&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-brand&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;main.home&#39;) }}&quot;</span><span class="p">&gt;</span>Secretary Services v0.1.44<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-toggler&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">data-bs-toggle</span><span class="o">=</span><span class="s">&quot;collapse&quot;</span> <span class="na">data-bs-target</span><span class="o">=</span><span class="s">&quot;#navbarNav&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-toggler-icon&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;collapse navbar-collapse&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;navbarNav&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;navbar-nav&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link {% if request.endpoint == &#39;main.home&#39; %}active{% endif %}&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;main.home&#39;) }}&quot;</span><span class="p">&gt;</span>Dashboard<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link {% if request.endpoint == &#39;main.logs&#39; %}active{% endif %}&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;main.logs&#39;) }}&quot;</span><span class="p">&gt;</span>Logs<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link {% if request.endpoint == &#39;main.event_monitor&#39; %}active{% endif %}&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;main.event_monitor&#39;) }}&quot;</span><span class="p">&gt;</span>Event-Monitor<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link {% if request.endpoint == &#39;main.config_page&#39; %}active{% endif %}&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;main.config_page&#39;) }}&quot;</span><span class="p">&gt;</span>Config<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link {% if request.endpoint == &#39;main.test_procedures&#39; %}active{% endif %}&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;main.test_procedures&#39;) }}&quot;</span><span class="p">&gt;</span>Tests<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/api/doc&quot;</span><span class="p">&gt;</span>API<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-item&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;nav-link&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/docs/&quot;</span><span class="p">&gt;</span>Docs<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container mt-4&quot;</span><span class="p">&gt;</span>
        {% block content %}{% endblock %}
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://code.jquery.com/jquery-3.6.0.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    {% block scripts %}{% endblock %}
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span> 
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Main routes for the dashboard application.</span>
<span class="sd">Contains the main dashboard view and test routes.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Blueprint</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">current_app</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span><span class="p">,</span> <span class="n">timezone</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">cast</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">ApplicationConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.models.job_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Batch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.utils.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessingLogger</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_system_info</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">Config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.utils.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_logger</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.tests</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_youtube_test</span><span class="p">,</span> <span class="n">run_audio_test</span><span class="p">,</span> <span class="n">run_transformer_test</span><span class="p">,</span> <span class="n">run_health_test</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>  <span class="c1"># Neu hinzugefügt für API-Anfragen</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">markdown</span>  <span class="c1"># type: ignore</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.mongodb.repository</span><span class="w"> </span><span class="kn">import</span> <span class="n">SessionJobRepository</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.mongodb</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_job_repository</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.models.job_models</span><span class="w"> </span><span class="kn">import</span> <span class="n">JobStatus</span>

<span class="c1"># Create the blueprint</span>
<span class="n">main</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="p">:</span> <span class="n">ProcessingLogger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="n">process_id</span><span class="o">=</span><span class="s2">&quot;dashboard&quot;</span><span class="p">)</span>

<span class="c1"># Funktion zur Markdown-Konvertierung</span>
<span class="k">def</span><span class="w"> </span><span class="nf">render_markdown</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Konvertiert Markdown-Text in HTML&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">load_logs_for_requests</span><span class="p">(</span><span class="n">recent_requests</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load log entries for a list of requests from the detailed log file</span>

<span class="sd">    Args:</span>
<span class="sd">        recent_requests (list): List of request entries to load logs for</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Dictionary mapping process_ids to their log entries</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Lade Log-Pfad aus der Konfiguration</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
    <span class="n">log_file</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_all</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;logging&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;logs/detailed.log&#39;</span><span class="p">)</span>
    <span class="n">log_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="n">log_file</span><span class="p">)</span>
    <span class="n">request_logs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">current_entry</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">details_lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">collecting_details</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="c1"># Check if this is a new log entry</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d</span><span class="si">{4}</span><span class="s1">-\d</span><span class="si">{2}</span><span class="s1">-\d</span><span class="si">{2}</span><span class="s1"> \d</span><span class="si">{2}</span><span class="s1">:\d</span><span class="si">{2}</span><span class="s1">:\d</span><span class="si">{2}</span><span class="s1">,\d</span><span class="si">{3}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                    <span class="c1"># Save previous entry if exists</span>
                    <span class="k">if</span> <span class="n">current_entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">details_lines</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">details_text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">details_lines</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">details_text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Details: &#39;</span><span class="p">):</span>
                                    <span class="n">details_text</span> <span class="o">=</span> <span class="n">details_text</span><span class="p">[</span><span class="mi">9</span><span class="p">:]</span>
                                <span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">details_text</span><span class="p">))</span>
                            <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
                                <span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;raw&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">details_lines</span><span class="p">)})</span>

                        <span class="k">if</span> <span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;process_id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">request_logs</span><span class="p">:</span>
                            <span class="n">request_logs</span><span class="p">[</span><span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;process_id&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_entry</span><span class="p">)</span>

                    <span class="c1"># Parse new entry</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; - &#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">level</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">source</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># [logger.py:97]</span>
                        <span class="n">process_info</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># [TransformerProcessor] Process[1735640951800]</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39; - &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span>  <span class="c1"># Join remaining parts in case message contains &#39; - &#39;</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Extrahiere processor_name und process_id</span>
                            <span class="c1"># Format: &quot;[YoutubeProcessor] Process[1735641423754]&quot;</span>
                            <span class="k">if</span> <span class="s1">&#39;] Process[&#39;</span> <span class="ow">in</span> <span class="n">process_info</span><span class="p">:</span>
                                <span class="n">parts</span> <span class="o">=</span> <span class="n">process_info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;] Process[&#39;</span><span class="p">)</span>
                                <span class="n">processor_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span>  <span class="c1"># YoutubeProcessor</span>
                                <span class="n">process_id</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>      <span class="c1"># 1735641423754</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">processor_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                                <span class="n">process_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                            <span class="c1"># Initialize logs list for process_id if it&#39;s in recent requests</span>
                            <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;process_id&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">process_id</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="n">process_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">request_logs</span><span class="p">:</span>
                                        <span class="n">request_logs</span><span class="p">[</span><span class="n">process_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                            <span class="n">current_entry</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                                <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="n">level</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                                <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">source</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">),</span>
                                <span class="s1">&#39;processor_name&#39;</span><span class="p">:</span> <span class="n">processor_name</span><span class="p">,</span>
                                <span class="s1">&#39;process_id&#39;</span><span class="p">:</span> <span class="n">process_id</span><span class="p">,</span>
                                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="p">}</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error parsing log line: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">current_entry</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                                <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="n">level</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                                <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">source</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">),</span>
                                <span class="s1">&#39;processor_name&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                <span class="s1">&#39;process_id&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="p">}</span>
                        <span class="n">details_lines</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">collecting_details</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1"># Check if this is the start of details</span>
                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Details: &#39;</span><span class="p">):</span>
                    <span class="n">collecting_details</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">details_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">]</span>

                <span class="c1"># Add to details if we&#39;re collecting them</span>
                <span class="k">elif</span> <span class="n">collecting_details</span> <span class="ow">and</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">details_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>


            <span class="c1"># Don&#39;t forget to add the last entry</span>
            <span class="k">if</span> <span class="n">current_entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">details_lines</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">details_text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">details_lines</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">details_text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Details: &#39;</span><span class="p">):</span>
                            <span class="n">details_text</span> <span class="o">=</span> <span class="n">details_text</span><span class="p">[</span><span class="mi">9</span><span class="p">:]</span>
                        <span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">details_text</span><span class="p">))</span>
                    <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
                        <span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;raw&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">details_lines</span><span class="p">)})</span>

                <span class="c1"># Add to request logs if process_id matches</span>
                <span class="k">if</span> <span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;process_id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">request_logs</span><span class="p">:</span>
                    <span class="n">request_logs</span><span class="p">[</span><span class="n">current_entry</span><span class="p">[</span><span class="s1">&#39;process_id&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_entry</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading log file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">request_logs</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">home</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dashboard main page route.</span>
<span class="sd">    Displays statistics about recent requests.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize statistics</span>
    <span class="n">stats</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;total_requests&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;avg_duration&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s1">&#39;success_rate&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s1">&#39;total_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;hourly_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;operations&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;processor_stats&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;hourly_stats&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;recent_requests&#39;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Load performance data</span>
        <span class="n">perf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;logs&#39;</span><span class="p">,</span> <span class="s1">&#39;performance.json&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading performance data from </span><span class="si">{</span><span class="n">perf_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">perf_path</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Performance file not found at </span><span class="si">{</span><span class="n">perf_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;dashboard.html&#39;</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span> <span class="n">system_info</span><span class="o">=</span><span class="n">get_system_info</span><span class="p">())</span>

        <span class="c1"># Prüfe, ob die Datei leer ist</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">perf_path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Performance file is empty&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;dashboard.html&#39;</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span> <span class="n">system_info</span><span class="o">=</span><span class="n">get_system_info</span><span class="p">())</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">perf_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">perf_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">perf_data</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Performance data is empty&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;dashboard.html&#39;</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span> <span class="n">system_info</span><span class="o">=</span><span class="n">get_system_info</span><span class="p">())</span>

        <span class="c1"># Calculate time window</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="n">day_ago</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Filter recent requests and ensure timestamp is valid</span>
        <span class="n">recent_requests</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">perf_data</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;+00:00&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">timestamp</span> <span class="o">&gt;</span> <span class="n">day_ago</span><span class="p">:</span>
                    <span class="n">r</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
                    <span class="n">recent_requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing request timestamp: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="k">if</span> <span class="n">recent_requests</span><span class="p">:</span>
            <span class="c1"># Basic statistics</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_requests&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_requests</span><span class="p">)</span>
            <span class="n">total_duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_duration&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">)</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;avg_duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_duration</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_requests</span><span class="p">)</span>

            <span class="c1"># Success rate calculation</span>
            <span class="n">success_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recent_requests</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;success&#39;</span><span class="p">)</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;success_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">success_count</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_requests</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>

            <span class="c1"># Token calculation</span>
            <span class="n">total_tokens</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_tokens&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">)</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;hourly_tokens&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_tokens</span> <span class="o">//</span> <span class="mi">24</span> <span class="k">if</span> <span class="n">total_tokens</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

            <span class="c1"># Operation statistics</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;operations&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">op_name</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;operations&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">:</span>
                        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;operations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">operations_dict</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;operations&#39;</span><span class="p">])</span>
                    <span class="n">operations_dict</span><span class="p">[</span><span class="n">op_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">operations_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">op_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="c1"># Processor statistics</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">processor</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;processors&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">processor</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;processor_stats&#39;</span><span class="p">]:</span>
                        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;processor_stats&#39;</span><span class="p">][</span><span class="n">processor</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;request_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;total_duration&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;success_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;error_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;total_tokens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;total_cost&#39;</span><span class="p">:</span> <span class="mi">0</span>
                        <span class="p">}</span>

                    <span class="n">proc_stats</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;processor_stats&#39;</span><span class="p">][</span><span class="n">processor</span><span class="p">]</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;request_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;total_duration&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_duration&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;success_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;success_count&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;error_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error_count&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                    <span class="c1"># Add token and cost data if available</span>
                    <span class="n">resources</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;total_tokens&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_tokens&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;total_cost&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">resources</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_cost&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

            <span class="c1"># Calculate averages for processor stats</span>
            <span class="k">for</span> <span class="n">proc_stats</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;processor_stats&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">req_count</span> <span class="o">=</span> <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;request_count&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">req_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;avg_duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;total_duration&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">req_count</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;success_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;success_count&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">req_count</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;avg_tokens&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;total_tokens&#39;</span><span class="p">]</span> <span class="o">//</span> <span class="n">req_count</span>
                    <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;avg_cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proc_stats</span><span class="p">[</span><span class="s1">&#39;total_cost&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">req_count</span>

            <span class="c1"># Hourly statistics</span>
            <span class="n">hour_counts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">hour</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:00&#39;</span><span class="p">)</span>
                    <span class="n">hour_counts</span><span class="p">[</span><span class="n">hour</span><span class="p">]</span> <span class="o">=</span> <span class="n">hour_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hour</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing hour statistics: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>

            <span class="c1"># Sort hours and create final hourly stats</span>
            <span class="n">sorted_hours</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">hour_counts</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;hourly_stats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">hour</span><span class="p">:</span> <span class="n">hour_counts</span><span class="p">[</span><span class="n">hour</span><span class="p">]</span> <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="n">sorted_hours</span><span class="p">}</span>

            <span class="c1"># Process recent requests (last 10)</span>
            <span class="n">recent_requests</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">recent_requests</span><span class="p">,</span> 
                                  <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span>
                                  <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>

            <span class="c1"># Add logs to recent requests</span>
            <span class="n">request_logs</span> <span class="o">=</span> <span class="n">load_logs_for_requests</span><span class="p">(</span><span class="n">recent_requests</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">:</span>
                <span class="n">process_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;process_id&#39;</span><span class="p">)</span>
                <span class="n">request</span><span class="p">[</span><span class="s1">&#39;logs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request_logs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">process_id</span><span class="p">,</span> <span class="p">[])</span> <span class="k">if</span> <span class="n">process_id</span> <span class="k">else</span> <span class="p">[]</span>

                <span class="c1"># Get the main operation</span>
                <span class="n">main_op</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;operations&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;operation&#39;</span><span class="p">):</span>
                        <span class="n">main_op</span> <span class="o">=</span> <span class="n">op</span>
                        <span class="k">break</span>

                <span class="c1"># Prepare the main process data</span>
                <span class="n">request</span><span class="p">[</span><span class="s1">&#39;main_process&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;duration_seconds&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_duration&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
                    <span class="s1">&#39;operation&#39;</span><span class="p">:</span> <span class="n">main_op</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;processor&#39;</span><span class="p">:</span> <span class="n">main_op</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;processor&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;file_size&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file_size&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="s1">&#39;duration&#39;</span><span class="p">:</span> <span class="n">main_op</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;text_length&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)),</span>
                    <span class="s1">&#39;llm_model&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;models_used&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s1">&#39;tokens&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;resources&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_tokens&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">}</span>

            <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;recent_requests&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recent_requests</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing dashboard data: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;dashboard.html&#39;</span><span class="p">,</span> 
                         <span class="n">stats</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span>
                         <span class="n">system_info</span><span class="o">=</span><span class="n">get_system_info</span><span class="p">())</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/config&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">save_config</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Speichert die Konfiguration in der config.yaml.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">yaml_content</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">yaml_content</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Keine YAML-Daten empfangen&quot;</span><span class="p">}),</span> <span class="mi">400</span>

        <span class="c1"># Parse YAML-String zu Dictionary</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">config_data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">yaml_content</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Ungültiges YAML Format: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}),</span> <span class="mi">400</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="c1"># Extrahiere und validiere API Key, falls vorhanden</span>
        <span class="n">api_key_updated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;api_keys&#39;</span> <span class="ow">in</span> <span class="n">config_data</span> <span class="ow">and</span> <span class="s1">&#39;openai_api_key&#39;</span> <span class="ow">in</span> <span class="n">config_data</span><span class="p">[</span><span class="s1">&#39;api_keys&#39;</span><span class="p">]:</span>
            <span class="n">api_key</span> <span class="o">=</span> <span class="n">config_data</span><span class="p">[</span><span class="s1">&#39;api_keys&#39;</span><span class="p">][</span><span class="s1">&#39;openai_api_key&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">api_key</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">api_key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;sk-...&#39;</span><span class="p">):</span>  <span class="c1"># Nur speichern wenn es kein maskierter Key ist</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Verwende die ConfigKeys-Klasse anstatt config.set_api_key</span>
                    <span class="kn">from</span><span class="w"> </span><span class="nn">src.core.config_keys</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigKeys</span>
                    <span class="n">config_keys</span> <span class="o">=</span> <span class="n">ConfigKeys</span><span class="p">()</span>
                    <span class="n">config_keys</span><span class="o">.</span><span class="n">set_openai_api_key</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>
                    <span class="n">api_key_updated</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}),</span> <span class="mi">400</span>
            <span class="c1"># Entferne API Keys aus config_data</span>
            <span class="k">del</span> <span class="n">config_data</span><span class="p">[</span><span class="s1">&#39;api_keys&#39;</span><span class="p">]</span>

        <span class="c1"># Hole den Pfad zur config.yaml</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="s1">&#39;config&#39;</span> <span class="o">/</span> <span class="s1">&#39;config.yaml&#39;</span>

        <span class="c1"># Speichere die aktualisierte Konfiguration</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">config_data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;API Key aktualisiert. &quot;</span> <span class="k">if</span> <span class="n">api_key_updated</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Lade die aktuelle Konfiguration neu</span>
        <span class="n">config_yaml</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_all</span><span class="p">(),</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">Konfiguration erfolgreich gespeichert&quot;</span><span class="p">,</span>
            <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="n">config_yaml</span>
        <span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Fehler beim Speichern der Konfiguration&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Speichern: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/config&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">config_page</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zeigt die Konfigurationsseite an.</span>

<span class="sd">    Returns:</span>
<span class="sd">        rendered template: Die config.html Template mit der aktuellen Konfiguration</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Lade die aktuelle Konfiguration</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">config_data</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_all</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Config Data:&quot;</span><span class="p">,</span> <span class="n">config_data</span><span class="p">)</span>  <span class="c1"># Debug-Ausgabe</span>

        <span class="c1"># Konvertiere zu YAML</span>
        <span class="n">config_yaml</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">config_data</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Config YAML:&quot;</span><span class="p">,</span> <span class="n">config_yaml</span><span class="p">)</span>  <span class="c1"># Debug-Ausgabe</span>

        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;config.html&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config_yaml</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Fehler beim Laden der Konfiguration&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>  <span class="c1"># Debug-Ausgabe</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;config.html&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/test&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_page</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test page with Swagger UI integration for API testing</span>

<span class="sd">    Returns:</span>
<span class="sd">        rendered template: The apitest.html template with Swagger UI</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;apitest.html&#39;</span><span class="p">)</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/test-procedures&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_procedures</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zeigt die Testseite an.</span>

<span class="sd">    Returns:</span>
<span class="sd">        rendered template: Die test_procedures.html Template</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;test_procedures.html&#39;</span><span class="p">)</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/run_youtube_test&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">youtube_test</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Route handler for Youtube test&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">run_youtube_test</span><span class="p">()</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/run_audio_test&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">audio_test</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Route handler for audio test&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">run_audio_test</span><span class="p">()</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/run_transformer_test&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">transformer_test</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Route handler for transformer test&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">run_transformer_test</span><span class="p">()</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/run_health_test&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">health_test</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Route handler for health test&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">run_health_test</span><span class="p">()</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/logs&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">logs</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zeigt die Logs der Anwendung an.</span>

<span class="sd">    Diese Funktion lädt die in der config.yaml definierte Log-Datei und zeigt die letzten X Einträge an.</span>
<span class="sd">    Die Log-Datei wird zentral durch den LoggerService initialisiert.</span>

<span class="sd">    Returns:</span>
<span class="sd">        rendered template: Die logs.html Template mit den Log-Einträgen</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Lade Konfiguration</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">config_data</span><span class="p">:</span> <span class="n">ApplicationConfig</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_all</span><span class="p">()</span>

        <span class="n">max_entries</span> <span class="o">=</span> <span class="n">config_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;logging&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_log_entries&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">log_file</span> <span class="o">=</span> <span class="n">config_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;logging&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;logs/detailed.log&#39;</span><span class="p">)</span>
        <span class="n">log_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span>

        <span class="n">log_files</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Lese die Log-Datei</span>
        <span class="k">if</span> <span class="n">log_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">log_files</span><span class="p">[</span><span class="n">log_file</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="o">-</span><span class="n">max_entries</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log_files</span><span class="p">[</span><span class="n">log_file</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;logs.html&#39;</span><span class="p">,</span> <span class="n">log_files</span><span class="o">=</span><span class="n">log_files</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Laden der Logs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Laden der Logs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/clear-logs&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">clear_logs</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Löscht den Inhalt der Log-Datei und stellt sicher, dass sie danach wieder existiert.</span>
<span class="sd">    Die Log-Datei wird mit einem leeren Inhalt neu erstellt.</span>

<span class="sd">    Returns:</span>
<span class="sd">        redirect: Leitet zurück zur Logs-Ansicht</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Lade Log-Pfad aus der Konfiguration</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">log_file</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_all</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;logging&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;logs/detailed.log&#39;</span><span class="p">)</span>
        <span class="n">log_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span>

        <span class="c1"># Stelle sicher, dass das Verzeichnis existiert</span>
        <span class="n">log_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Leere die Datei oder erstelle sie neu</span>
        <span class="n">log_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;main.logs&#39;</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error clearing logs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/recent-requests&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_recent_requests</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Abrufen der neuesten Anfragen.</span>
<span class="sd">    Gibt die letzten 10 Anfragen zurück.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Response: JSON mit den neuesten Anfragen</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Load performance data</span>
        <span class="n">perf_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;logs&#39;</span><span class="p">,</span> <span class="s1">&#39;performance.json&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">perf_path</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">([])</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">perf_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">perf_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">perf_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">([])</span>

        <span class="c1"># Calculate time window</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="n">day_ago</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Filter recent requests and ensure timestamp is valid</span>
        <span class="n">recent_requests</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">perf_data</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;+00:00&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">timestamp</span> <span class="o">&gt;</span> <span class="n">day_ago</span><span class="p">:</span>
                    <span class="n">r</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
                    <span class="n">recent_requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing request timestamp: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="c1"># Sort by timestamp (newest first) and take last 10</span>
        <span class="n">recent_requests</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">recent_requests</span><span class="p">,</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>

        <span class="c1"># Render only the requests list part</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;_recent_requests.html&#39;</span><span class="p">,</span> 
                             <span class="n">recent_requests</span><span class="o">=</span><span class="n">recent_requests</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;html&#39;</span><span class="p">:</span> <span class="n">html</span><span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting recent requests: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;html&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;&lt;div class=&quot;text-danger&quot;&gt;Fehler beim Laden: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&lt;/div&gt;&#39;</span><span class="p">})</span> 

<span class="c1">## Entfernt: iframe-basierte Docs-Ansicht, um doppelte Scrollbars zu vermeiden</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/event-monitor&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">event_monitor</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zeigt die Monitoring-Seite für asynchrone Event-Verarbeitung an.</span>
<span class="sd">    Hier werden aktuelle Batches und archivierte Batches aus dem event-job API-Endpoint angezeigt.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Konfigurationsdaten laden (sofern benötigt)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">event_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;processors.event&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">max_concurrent_tasks</span> <span class="o">=</span> <span class="n">event_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_concurrent_tasks&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Basis-URL für API-Anfragen</span>
        <span class="n">api_base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="c1"># Filterparameter aus dem Request</span>
        <span class="n">status_filter</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">date_filter</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># Aktuelle (nicht-archivierte) Batches abrufen</span>
        <span class="n">current_batches_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_base_url</span><span class="si">}</span><span class="s2">/api/event-job/batches?archived=false&quot;</span>
        <span class="k">if</span> <span class="n">status_filter</span><span class="p">:</span>
            <span class="n">current_batches_url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&amp;status=</span><span class="si">{</span><span class="n">status_filter</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Standardwerte initialisieren, um Schattierung/Redeklaration zu vermeiden</span>
        <span class="n">current_batches_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;batches&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="n">jobs_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># HTTP-Request für aktuelle Batches</span>
            <span class="n">current_batches_response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">current_batches_url</span><span class="p">)</span>
            <span class="n">current_batches_response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="n">current_batches_data</span> <span class="o">=</span> <span class="n">current_batches_response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="c1"># KEINE Jobs mehr vorab laden - das wird bei Bedarf über JavaScript gemacht</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der aktuellen Batch-Daten: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Daten für das Template vorbereiten</span>
        <span class="n">event_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;current_batches&quot;</span><span class="p">:</span> <span class="n">current_batches_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;batches&#39;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="s2">&quot;jobs_data&quot;</span><span class="p">:</span> <span class="n">jobs_data</span><span class="p">,</span>
            <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status_filter</span><span class="p">,</span>
                <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">date_filter</span>
            <span class="p">},</span>
            <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;max_concurrent_tasks&quot;</span><span class="p">:</span> <span class="n">max_concurrent_tasks</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;event_monitor.html&#39;</span><span class="p">,</span> <span class="n">event_data</span><span class="o">=</span><span class="n">event_data</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Laden der Event-Monitor-Seite: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Laden der Event-Monitor-Seite: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_batches</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Abrufen von Batch-Daten für die Event-Monitor-Oberfläche.</span>
<span class="sd">    Unterstützt Paginierung und Filterung.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Query-Parameter extrahieren</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span>
        <span class="n">status_filter</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">archived_filter</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;archived&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># Normalisieren zu Kleinbuchstaben</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;limit&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>

        <span class="c1"># Verwende verschiedene Routen basierend auf dem Status-Filter</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">api_base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="c1"># URL mit Status- und Archiv-Filter erstellen</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_base_url</span><span class="si">}</span><span class="s2">/api/event-job/batches?limit=</span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Filter hinzufügen</span>
        <span class="n">filters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">status_filter</span><span class="p">:</span>
            <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;status=</span><span class="si">{</span><span class="n">status_filter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Archived-Parameter korrekt übergeben (als String &#39;true&#39; oder &#39;false&#39;)</span>
        <span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;archived=</span><span class="si">{</span><span class="n">archived_filter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Filter zur URL hinzufügen</span>
        <span class="k">if</span> <span class="n">filters</span><span class="p">:</span>
            <span class="n">filter_string</span> <span class="o">=</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">&amp;</span><span class="si">{</span><span class="n">filter_string</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">base_url</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch-Anfrage an: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Batch-Daten: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Batch-Daten: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Batch-Daten: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Batch-Daten: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/job/&lt;job_id&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_job_detail</span><span class="p">(</span><span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Abrufen der Details eines einzelnen Jobs anhand seiner ID.</span>

<span class="sd">    :param job_id: Die ID des Jobs, dessen Details abgerufen werden sollen.</span>
<span class="sd">    :return: JSON-Antwort mit den Job-Details oder einer Fehlermeldung.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">job_id</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine job_id in der Anfrage&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;job_id ist ein erforderlicher Parameter&quot;</span>
        <span class="p">}),</span> <span class="mi">400</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># API-Basis-URL aus der Konfiguration laden</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lade Job-Details für job_id: </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Verwende die generische get-Methode für die API-Basis-URL</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">base_url</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine API-Basis-URL konfiguriert&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;API-Basis-URL nicht konfiguriert&quot;</span>
            <span class="p">}),</span> <span class="mi">500</span>

        <span class="c1"># Erstelle die Anfrage-URL für einen einzelnen Job</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/event-job/jobs/</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rufe API auf: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Führe die Anfrage durch</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Verarbeite die Antwort</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job-Detail API-Antwort erhalten: </span><span class="si">{</span><span class="n">response_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Prüfe, ob der Job in der Antwort enthalten ist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Kein Job in der API-Antwort gefunden für job_id: </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Job mit ID </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> nicht gefunden&quot;</span>
            <span class="p">}),</span> <span class="mi">404</span>

        <span class="c1"># Bereite die Antwort vor - direkte Struktur ohne Wrapping in &#39;data&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;job&quot;</span><span class="p">:</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Formatierte Antwort: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/jobs&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_jobs</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># API-Basis-URL aus der Konfiguration laden</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Lade Jobs&quot;</span><span class="p">)</span>

        <span class="c1"># Verwende die generische get-Methode anstelle einer nicht existierenden get_api_base_url-Methode</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">base_url</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine API-Basis-URL konfiguriert&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;API-Basis-URL nicht konfiguriert&quot;</span>
            <span class="p">}),</span> <span class="mi">500</span>

        <span class="c1"># Extrahiere alle Query-Parameter</span>
        <span class="n">batch_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;batch_id&#39;</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span>

        <span class="c1"># Erstelle die Basis-URL für Jobs</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/event-job/jobs&quot;</span>

        <span class="c1"># Füge Query-Parameter hinzu, wenn vorhanden</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">batch_id</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;batch_id=</span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;status=</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">?</span><span class="si">{</span><span class="s1">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rufe API auf: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Führe die Anfrage durch</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Verarbeite die Antwort</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jobs API-Antwort erhalten: </span><span class="si">{</span><span class="n">response_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Bereite die Antwort vor</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;jobs&quot;</span><span class="p">:</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;jobs&#39;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Formatierte Antwort: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;jobs&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/job/&lt;job_id&gt;/restart&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_job_restart</span><span class="p">(</span><span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Neustarten eines Jobs durch Zurücksetzen seines Status.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Konfiguration laden für API-Basis-URL</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="c1"># Request-Daten extrahieren (optional: batch_id)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;batch_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># Verwende die generische get-Methode für die API-Basis-URL</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>
        <span class="c1"># Korrigierter API-Pfad mit /api/ Präfix</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/event-job/</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">/restart&quot;</span>

        <span class="c1"># Debug-Ausgabe für die Problemdiagnose</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sende Neustart-Anfrage an: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Führe die API-Anfrage durch</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span> 
            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;batch_id&#39;</span><span class="p">:</span> <span class="n">batch_id</span><span class="p">},</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Verarbeite die Antwort</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job-Neustart API-Antwort erhalten: </span><span class="si">{</span><span class="n">response_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Bereite die Antwort vor</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> wurde erfolgreich für den Neustart markiert&quot;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;job&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Formatierte Antwort: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Neustarten des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Neustarten des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/job/&lt;job_id&gt;/archive&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_job_archive</span><span class="p">(</span><span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Archivieren eines Jobs durch Änderung des Status.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Konfiguration laden für API-Basis-URL</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="c1"># Request-Daten extrahieren (optional: batch_id)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;batch_id&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># Verwende die generische get-Methode für die API-Basis-URL</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/event-job/</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">/archive&quot;</span>

        <span class="c1"># Führe die API-Anfrage durch</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span> 
            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;batch_id&#39;</span><span class="p">:</span> <span class="n">batch_id</span><span class="p">},</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Verarbeite die Antwort</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job-Archivierung API-Antwort erhalten: </span><span class="si">{</span><span class="n">response_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Bereite die Antwort vor</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> wurde erfolgreich archiviert&quot;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;job&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Formatierte Antwort: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Archivieren des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Archivieren des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>


<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/jobs/&lt;job_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DELETE&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_job_delete</span><span class="p">(</span><span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Löschen eines Jobs.</span>

<span class="sd">    :param job_id: Die ID des Jobs, der gelöscht werden soll.</span>
<span class="sd">    :return: JSON-Antwort mit Erfolgsmeldung oder Fehlermeldung.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">job_id</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine job_id in der Anfrage&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;job_id ist ein erforderlicher Parameter&quot;</span>
        <span class="p">}),</span> <span class="mi">400</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># API-Basis-URL aus der Konfiguration laden</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lösche Job mit job_id: </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Verwende die generische get-Methode für die API-Basis-URL</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">base_url</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine API-Basis-URL konfiguriert&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;API-Basis-URL nicht konfiguriert&quot;</span>
            <span class="p">}),</span> <span class="mi">500</span>

        <span class="c1"># Erstelle die Anfrage-URL für das Löschen eines Jobs</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/event-job/jobs/</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rufe API auf (DELETE): </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Führe die Anfrage durch</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Verarbeite die Antwort</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job-Löschung API-Antwort erhalten: </span><span class="si">{</span><span class="n">response_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Bereite die Antwort vor</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> wurde erfolgreich gelöscht&quot;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Formatierte Antwort: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Löschen des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Löschen des Jobs: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/&lt;batch_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DELETE&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_batch_delete</span><span class="p">(</span><span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Löschen eines Batches und aller zugehörigen Jobs.</span>

<span class="sd">    :param batch_id: Die ID des Batches, der gelöscht werden soll.</span>
<span class="sd">    :return: JSON-Antwort mit Erfolgsmeldung oder Fehlermeldung.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">batch_id</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine batch_id in der Anfrage&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;batch_id ist ein erforderlicher Parameter&quot;</span>
        <span class="p">}),</span> <span class="mi">400</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># API-Basis-URL aus der Konfiguration laden</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lösche Batch mit batch_id: </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Verwende die generische get-Methode für die API-Basis-URL</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">base_url</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine API-Basis-URL konfiguriert&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;API-Basis-URL nicht konfiguriert&quot;</span>
            <span class="p">}),</span> <span class="mi">500</span>

        <span class="c1"># Erstelle die Anfrage-URL für das Löschen eines Batches</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/event-job/batches/</span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rufe API auf (DELETE): </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Führe die Anfrage durch</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Verarbeite die Antwort</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch-Löschung API-Antwort erhalten: </span><span class="si">{</span><span class="n">response_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Bereite die Antwort vor</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Batch </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2"> wurde erfolgreich gelöscht&quot;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Formatierte Antwort: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Löschen des Batches: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Löschen des Batches: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/&lt;string:batch_id&gt;/stats&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_batch_stats</span><span class="p">(</span><span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Abrufen aktueller Statistiken eines Batches ohne Änderungen in der Datenbank.</span>
<span class="sd">    Dies ist nützlich für Live-Updates im Frontend ohne vollständige Seitenneuladen.</span>

<span class="sd">    :param batch_id: Die ID des Batches, dessen Statistiken abgerufen werden sollen.</span>
<span class="sd">    :return: JSON-Antwort mit den aktuellen Batch-Statistiken.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">batch_id</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine batch_id in der Anfrage&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;batch_id ist ein erforderlicher Parameter&quot;</span>
        <span class="p">}),</span> <span class="mi">400</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Direkt das Repository für effizientere Abfragen verwenden</span>
        <span class="n">job_repo</span><span class="p">:</span> <span class="n">SessionJobRepository</span> <span class="o">=</span> <span class="n">get_job_repository</span><span class="p">()</span>

        <span class="c1"># Batch mit aktuellen Statistiken abrufen, ohne Status zu ändern</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">get_batch_with_current_stats</span><span class="p">(</span><span class="n">batch_id</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">batch</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch nicht gefunden: </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Batch mit ID </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2"> nicht gefunden&quot;</span>
            <span class="p">}),</span> <span class="mi">404</span>

        <span class="c1"># Erfolgsantwort zurückgeben</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;batch&quot;</span><span class="p">:</span> <span class="n">batch</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
        <span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Batch-Statistiken: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Abrufen der Batch-Statistiken: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/&lt;string:batch_id&gt;/toggle-active&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_toggle_active</span><span class="p">(</span><span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Umschalten des isActive-Status eines Batches.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Konfiguration laden für API-Basis-URL</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">api_base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="c1"># Request-Daten (falls vorhanden) weitergeben</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">is_json</span> <span class="k">else</span> <span class="p">{})</span>

        <span class="c1"># API-Anfrage zur Umschaltung des isActive-Status</span>
        <span class="c1"># Verwende standardisierte Event-Job-API-URL</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_base_url</span><span class="si">}</span><span class="s2">/api/event-job/batches/</span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">/toggle-active&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Toggle-Active-Anfrage an: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> mit Daten: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Antwort verarbeiten</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="c1"># Erfolgsantwort zurückgeben</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Umschalten des isActive-Status: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Umschalten des isActive-Status: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unerwarteter Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/&lt;string:batch_id&gt;/archive&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_batch_archive</span><span class="p">(</span><span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Archivieren eines Batches.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Konfiguration laden für API-Basis-URL</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="n">api_base_url</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server.api_base_url&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5001&#39;</span><span class="p">)</span>

        <span class="c1"># Request-Daten (falls vorhanden) weitergeben oder Standarddaten verwenden</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">is_json</span> <span class="k">else</span> <span class="p">{})</span>

        <span class="c1"># Sicherstellen, dass die Mindestanforderungen erfüllt sind</span>
        <span class="k">if</span> <span class="s1">&#39;batch_id&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;batch_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">batch_id</span>
        <span class="k">if</span> <span class="s1">&#39;archived&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;archived&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Archiviere Batch </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2"> mit Daten: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># API-Anfrage zum Archivieren des Batches</span>
        <span class="c1"># Korrigierte URL-Konstruktion - prüfe, ob Basis-URL bereits den API-Pfad enthält</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_base_url</span><span class="si">}</span><span class="s2">/api/event-job/batches/</span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">/archive&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch-Archivierung-Anfrage an: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Initialisiere response als None</span>
        <span class="n">response</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

            <span class="c1"># Antwort verarbeiten</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

            <span class="c1"># Erfolgsantwort zurückgeben</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">http_err</span><span class="p">:</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;HTTP-Fehler beim Archivieren des Batches: </span><span class="si">{</span><span class="n">http_err</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>

            <span class="c1"># Versuche, Details aus der Antwort zu extrahieren, wenn response existiert</span>
            <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">error_details</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;API-Fehlerdetails: </span><span class="si">{</span><span class="n">error_details</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">error_message</span><span class="p">,</span>
                        <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="n">error_details</span>
                    <span class="p">}),</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">error_message</span>
                <span class="p">}),</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

            <span class="c1"># Standardantwort, wenn keine Antwort vom Server kam</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">error_message</span>
            <span class="p">}),</span> <span class="mi">500</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Archivieren des Batches </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/&lt;string:batch_id&gt;/restart&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_batch_restart</span><span class="p">(</span><span class="n">batch_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Neustarten aller Jobs in einem Batch.</span>

<span class="sd">    :param batch_id: Die ID des Batches, dessen Jobs neu gestartet werden sollen.</span>
<span class="sd">    :return: JSON-Antwort mit Erfolgsmeldung oder Fehlermeldung.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">batch_id</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Keine batch_id in der Anfrage&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;batch_id ist ein erforderlicher Parameter&quot;</span>
        <span class="p">}),</span> <span class="mi">400</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Repository-Instanz holen</span>
        <span class="n">job_repo</span> <span class="o">=</span> <span class="n">get_job_repository</span><span class="p">()</span>

        <span class="c1"># Alle Jobs des Batches auf einmal auf PENDING setzen</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">update_jobs_status_by_batch</span><span class="p">(</span><span class="n">batch_id</span><span class="p">,</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Erfolgsantwort zurückgeben</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2"> Jobs wurden neu gestartet&quot;</span><span class="p">,</span>
                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;restarted_jobs&quot;</span><span class="p">:</span> <span class="n">result</span>
                <span class="p">}</span>
            <span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Keine Jobs für diesen Batch gefunden&quot;</span><span class="p">,</span>
                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;restarted_jobs&quot;</span><span class="p">:</span> <span class="mi">0</span>
                <span class="p">}</span>
            <span class="p">}),</span> <span class="mi">200</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Neustarten des Batches </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}),</span> <span class="mi">500</span>

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/fail-all&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_fail_all_batches</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum Setzen aller aktiven Batches auf failed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># API-URL zusammenbauen</span>
        <span class="n">api_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;API_BASE_URL&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/event-job/batches/fail-all&quot;</span>

        <span class="c1"># Headers vorbereiten</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span>
        <span class="p">}</span>

        <span class="c1"># Benutzer-ID aus den Headern weiterleiten</span>
        <span class="k">if</span> <span class="s1">&#39;X-User-ID&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
            <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-User-ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-User-ID&#39;</span><span class="p">]</span>

        <span class="c1"># API-Aufruf durchführen</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Erfolgreiche Antwort</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()),</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">http_err</span><span class="p">:</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;HTTP-Fehler beim Setzen der Batches auf failed: </span><span class="si">{</span><span class="n">http_err</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">error_message</span>
        <span class="p">}),</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">http_err</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;status_code&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Setzen der Batches auf failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">error_message</span>
        <span class="p">}),</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/force-fail-all&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_force_fail_all</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API-Endpunkt zum direkten Setzen ALLER Batches und Jobs auf failed.</span>
<span class="sd">    Dies ist eine direkte Datenbankoperation, die alle Batches und Jobs betrifft.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Repository-Instanz holen</span>
        <span class="n">job_repo</span> <span class="o">=</span> <span class="n">get_job_repository</span><span class="p">()</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>  <span class="c1"># Verwende utcnow statt now(UTC)</span>

        <span class="c1"># Direkte Batch-Aktualisierung</span>
        <span class="n">batch_result</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;archived&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$ne&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>  <span class="c1"># Nicht archivierte Batches</span>
            <span class="p">{</span>
                <span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;failed&quot;</span><span class="p">,</span>  <span class="c1"># Kleinbuchstaben statt Großbuchstaben</span>
                    <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
                    <span class="s2">&quot;completed_at&quot;</span><span class="p">:</span> <span class="n">now</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Direkte Job-Aktualisierung für alle Jobs</span>
        <span class="n">job_result</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span>
            <span class="p">{},</span>  <span class="c1"># Alle Jobs</span>
            <span class="p">{</span>
                <span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;failed&quot;</span><span class="p">,</span>  <span class="c1"># Kleinbuchstaben statt Großbuchstaben</span>
                    <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
                    <span class="s2">&quot;completed_at&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
                    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;FORCED_FAILURE&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Job wurde manuell auf failed gesetzt&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;forced_at&quot;</span><span class="p">:</span> <span class="n">now</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                            <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Manuelle Massenaktualisierung&quot;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Log die Änderungen</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Force-fail-all ausgeführt&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;updated_batches&quot;</span><span class="p">:</span> <span class="n">batch_result</span><span class="o">.</span><span class="n">modified_count</span><span class="p">,</span>
                <span class="s2">&quot;updated_jobs&quot;</span><span class="p">:</span> <span class="n">job_result</span><span class="o">.</span><span class="n">modified_count</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">batch_result</span><span class="o">.</span><span class="n">modified_count</span><span class="si">}</span><span class="s2"> Batches und </span><span class="si">{</span><span class="n">job_result</span><span class="o">.</span><span class="n">modified_count</span><span class="si">}</span><span class="s2"> Jobs auf failed gesetzt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;updated_batches&quot;</span><span class="p">:</span> <span class="n">batch_result</span><span class="o">.</span><span class="n">modified_count</span><span class="p">,</span>
                <span class="s2">&quot;updated_jobs&quot;</span><span class="p">:</span> <span class="n">job_result</span><span class="o">.</span><span class="n">modified_count</span>
            <span class="p">}</span>
        <span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Fehler beim Setzen aller Batches und Jobs auf failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">error_message</span>
        <span class="p">}),</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/set-pending-all&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_set_pending_all</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setzt alle nicht archivierten Batches und deren Jobs auf &#39;pending&#39;.</span>
<span class="sd">    Parameter:</span>
<span class="sd">    - target_language: Die neue Zielsprache (z.B. &#39;de&#39;, &#39;en&#39;, etc.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">target_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;target_language&#39;</span><span class="p">)</span>
        <span class="n">job_repository</span> <span class="o">=</span> <span class="n">get_job_repository</span><span class="p">()</span>

        <span class="c1"># Hole alle nicht archivierten Batches</span>
        <span class="n">batches</span> <span class="o">=</span> <span class="n">job_repository</span><span class="o">.</span><span class="n">get_batches</span><span class="p">(</span><span class="n">archived</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">updated_batches</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">updated_jobs</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Aktualisiere jeden Batch und seine Jobs</span>
        <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">batches</span><span class="p">:</span>
            <span class="c1"># Aktualisiere Batch und alle zugehörigen Jobs auf PENDING</span>
            <span class="k">if</span> <span class="n">job_repository</span><span class="o">.</span><span class="n">update_batch_status</span><span class="p">(</span><span class="n">batch</span><span class="o">.</span><span class="n">batch_id</span><span class="p">,</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">):</span>
                <span class="n">updated_batches</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Aktualisiere alle Jobs des Batches</span>
            <span class="n">jobs_updated</span> <span class="o">=</span> <span class="n">job_repository</span><span class="o">.</span><span class="n">update_jobs_status_by_batch</span><span class="p">(</span>
                <span class="n">batch</span><span class="o">.</span><span class="n">batch_id</span><span class="p">,</span> 
                <span class="n">JobStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">,</span>
                <span class="n">language</span><span class="o">=</span><span class="n">target_language</span>
            <span class="p">)</span>
            <span class="n">updated_jobs</span> <span class="o">+=</span> <span class="n">jobs_updated</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Alle Batches auf pending gesetzt&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;updated_batches&quot;</span><span class="p">:</span> <span class="n">updated_batches</span><span class="p">,</span>
                <span class="s2">&quot;updated_jobs&quot;</span><span class="p">:</span> <span class="n">updated_jobs</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">updated_batches</span><span class="si">}</span><span class="s2"> Batches und </span><span class="si">{</span><span class="n">updated_jobs</span><span class="si">}</span><span class="s2"> Jobs auf pending gesetzt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;batches_updated&quot;</span><span class="p">:</span> <span class="n">updated_batches</span><span class="p">,</span>
                <span class="s2">&quot;jobs_updated&quot;</span><span class="p">:</span> <span class="n">updated_jobs</span>
            <span class="p">}</span>
        <span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Setzen der Batches auf pending: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="p">}),</span> <span class="mi">500</span> 

<span class="nd">@main</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/api/dashboard/event-monitor/batches/change-language&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">api_event_monitor_change_language</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ändert die Zielsprache für alle Jobs oder einen einzelnen Job im Event-Monitor.</span>

<span class="sd">    Parameter:</span>
<span class="sd">    - target_language: Die neue Zielsprache (z.B. &#39;de&#39;, &#39;en&#39;, etc.)</span>
<span class="sd">    - job_id: (Optional) Die ID eines einzelnen Jobs, dessen Sprache geändert werden soll</span>
<span class="sd">    - reset_status: (Optional) Ob der Status der Jobs auf &#39;pending&#39; zurückgesetzt werden soll</span>
<span class="sd">    - current_batches_only: (Optional) Ob nur aktuelle (nicht archivierte) Batches betroffen sein sollen</span>

<span class="sd">    Returns:</span>
<span class="sd">        JSON mit Erfolgs- oder Fehlermeldung</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Daten aus dem Request auslesen</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span> <span class="ow">or</span> <span class="p">{})</span>

        <span class="n">target_language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;target_language&#39;</span><span class="p">)</span>
        <span class="n">job_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;job_id&#39;</span><span class="p">)</span>
        <span class="n">reset_status</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reset_status&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">current_batches_only</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_batches_only&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_language</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Zielsprache (target_language) ist erforderlich&#39;</span><span class="p">}),</span> <span class="mi">400</span>

        <span class="c1"># Repository und weitere benötigte Objekte initialisieren</span>
        <span class="n">job_repo</span> <span class="o">=</span> <span class="n">get_job_repository</span><span class="p">()</span>
        <span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Bestimmen, ob ein einzelner Job oder mehrere Jobs aktualisiert werden sollen</span>
        <span class="k">if</span> <span class="n">job_id</span><span class="p">:</span>
            <span class="c1"># Einzelnen Job aktualisieren</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ändere Zielsprache für Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> auf </span><span class="si">{</span><span class="n">target_language</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">job</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">get_job</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">job</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Job mit ID </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s1"> nicht gefunden&#39;</span><span class="p">}),</span> <span class="mi">404</span>

            <span class="c1"># Job-Parameter aktualisieren</span>
            <span class="n">job_parameters</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">parameters</span> <span class="k">else</span> <span class="p">{}</span>
            <span class="n">job_parameters</span><span class="p">[</span><span class="s1">&#39;target_language&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_language</span>

            <span class="c1"># Status zurücksetzen, falls gewünscht</span>
            <span class="k">if</span> <span class="n">reset_status</span><span class="p">:</span>
                <span class="n">job_repo</span><span class="o">.</span><span class="n">update_job_status</span><span class="p">(</span><span class="n">job_id</span><span class="p">,</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">)</span>

            <span class="c1"># Job-Parameter aktualisieren</span>
            <span class="n">job_repo</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;job_id&quot;</span><span class="p">:</span> <span class="n">job_id</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">job_parameters</span><span class="p">}}</span>
            <span class="p">)</span>
            <span class="n">success_count</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Zielsprache für Job </span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> erfolgreich auf </span><span class="si">{</span><span class="n">target_language</span><span class="si">}</span><span class="s2"> geändert&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Alle Jobs in Batches aktualisieren</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ändere Zielsprache für alle Jobs auf </span><span class="si">{</span><span class="n">target_language</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Batches abrufen (basierend auf dem &#39;current_batches_only&#39; Parameter)</span>
            <span class="n">batches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Batch</span><span class="p">]</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">get_batches</span><span class="p">(</span><span class="n">archived</span><span class="o">=</span><span class="ow">not</span> <span class="n">current_batches_only</span><span class="p">)</span>

            <span class="c1"># Durch alle Batches iterieren und Jobs aktualisieren</span>
            <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">batches</span><span class="p">:</span>
                <span class="n">batch_id</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">batch_id</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Verarbeite Batch </span><span class="si">{</span><span class="n">batch_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Jobs für den aktuellen Batch abrufen</span>
                <span class="n">jobs</span> <span class="o">=</span> <span class="n">job_repo</span><span class="o">.</span><span class="n">get_jobs_for_batch</span><span class="p">(</span><span class="n">batch_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
                    <span class="c1"># Parameter aktualisieren</span>
                    <span class="n">job_parameters</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">parameters</span> <span class="k">else</span> <span class="p">{}</span>
                    <span class="n">job_parameters</span><span class="p">[</span><span class="s1">&#39;target_language&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_language</span>

                    <span class="c1"># Job-Parameter aktualisieren</span>
                    <span class="n">job_repo</span><span class="o">.</span><span class="n">jobs</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                        <span class="p">{</span><span class="s2">&quot;job_id&quot;</span><span class="p">:</span> <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">},</span>
                        <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">job_parameters</span><span class="p">}}</span>
                    <span class="p">)</span>
                    <span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1"># Status zurücksetzen, falls gewünscht</span>
                <span class="k">if</span> <span class="n">reset_status</span> <span class="ow">and</span> <span class="n">jobs</span><span class="p">:</span>
                    <span class="n">job_repo</span><span class="o">.</span><span class="n">update_batch_status</span><span class="p">(</span><span class="n">batch_id</span><span class="p">,</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">)</span>
                    <span class="n">job_repo</span><span class="o">.</span><span class="n">update_jobs_status_by_batch</span><span class="p">(</span><span class="n">batch_id</span><span class="p">,</span> <span class="n">JobStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Zielsprache für </span><span class="si">{</span><span class="n">success_count</span><span class="si">}</span><span class="s2"> Jobs erfolgreich auf </span><span class="si">{</span><span class="n">target_language</span><span class="si">}</span><span class="s2"> geändert&quot;</span><span class="p">)</span>

        <span class="c1"># Erfolgreiche Antwort zurückgeben</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Zielsprache für </span><span class="si">{</span><span class="n">success_count</span><span class="si">}</span><span class="s1"> Job(s) erfolgreich auf </span><span class="si">{</span><span class="n">target_language</span><span class="si">}</span><span class="s1"> geändert&#39;</span><span class="p">,</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;updated_count&#39;</span><span class="p">:</span> <span class="n">success_count</span><span class="p">,</span>
                <span class="s1">&#39;target_language&#39;</span><span class="p">:</span> <span class="n">target_language</span>
            <span class="p">}</span>
        <span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Ändern der Zielsprache: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Fehler beim Ändern der Zielsprache: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}),</span> <span class="mi">500</span> 
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nt">site_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Common Secretary Services</span>
<span class="nt">site_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://example.local</span>
<span class="nt">repo_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://example.local/repo</span>
<span class="nt">docs_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docs</span>

<span class="nt">theme</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">material</span>
<span class="w">  </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">de</span>
<span class="w">  </span><span class="nt">logo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assets/images/logo.png</span>
<span class="w">  </span><span class="nt">favicon</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">assets/images/logo.png</span>

<span class="nt">plugins</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">search</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">redirects</span><span class="p">:</span>
<span class="w">      </span><span class="nt">redirect_maps</span><span class="p">:</span>
<span class="w">        </span><span class="s">&#39;01_architecture.md&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;explanations/architecture/overview.md&#39;</span>
<span class="w">        </span><span class="s">&#39;02_installation.md&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;guide/getting-started/installation.md&#39;</span>
<span class="w">        </span><span class="s">&#39;03_development.md&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;guide/getting-started/development.md&#39;</span>
<span class="w">        </span><span class="s">&#39;05_webinterface.md&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;guide/ui/dashboard.md&#39;</span>
<span class="w">        </span><span class="s">&#39;04_api.md&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;reference/api/overview.md&#39;</span>
<span class="w">        </span><span class="s">&#39;06_audio_processing.md&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;processors/audio/overview.md&#39;</span>
<span class="w">        </span><span class="s">&#39;HowToUseimageocr.md&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;processors/image-ocr/overview.md&#39;</span>
<span class="w">        </span><span class="s">&#39;swagger_llm_ocr_integration.md&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;processors/image-ocr/overview.md&#39;</span>
<span class="w">        </span><span class="s">&#39;07_youtube.md&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&#39;processors/video/overview.md&#39;</span>

<span class="nt">markdown_extensions</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admonition</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">toc</span><span class="p">:</span>
<span class="w">      </span><span class="nt">permalink</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pymdownx.details</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pymdownx.superfences</span>

<span class="nt">nav</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">« Zur Anwendung</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Home</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">index.md</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Guide</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Getting Started</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Installation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">guide/getting-started/installation.md</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Development</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">guide/getting-started/development.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">UI</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Dashboard</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">guide/ui/dashboard.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">How‑Tos</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Session‑Archive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">guide/how-tos/session-archive.md</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Explanations</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Architektur</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Überblick</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">explanations/architecture/overview.md</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Details</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">explanations/architecture/details.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Async Events</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Überblick</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">explanations/async-events/overview.md</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">n8n</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">explanations/async-events/how-to-n8n.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Caching</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">explanations/caching/overview.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Templates</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">explanations/templates/overview.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Typen &amp; Dataclasses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">explanations/types/overview.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Metaprocessor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">explanations/metaprocessor/overview.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Metadaten</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">explanations/metadata/overview.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">LLM‑Optimierung</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">explanations/llm/optimization.md</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Processors</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Audio</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">processors/audio/overview.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Video</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">processors/video/overview.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">PDF</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Überblick</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">processors/pdf/overview.md</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">OCR-Refactoring</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">processors/pdf/ocr-refactoring.md</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">PDF/ImageOCR Details</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">processors/pdf/endpoints.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Image-OCR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">processors/image-ocr/overview.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Transformer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">processors/transformer/overview.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Session</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">processors/session/overview.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Event-Job</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">processors/event-job/overview.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Story</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">processors/story/overview.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Track</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">processors/track/overview.md</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Reference</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">API Überblick</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reference/api/overview.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">OpenAPI / Swagger</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reference/api/openapi.md</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Ops</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Deployment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ops/deployment.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Sicherheit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ops/security.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Troubleshooting</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ops/troubleshooting.md</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Analysis</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Doku-Inventur</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_analysis/docs_inventory.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Routes-Index</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_analysis/routes_index.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Drift-Audit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_analysis/drift_audit.md</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Archiv (nur intern)</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">01_architecture (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/01_architecture.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">02_installation (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/02_installation.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">03_development (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/03_development.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">04_api (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/04_api.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">05_webinterface (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/05_webinterface.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">06_audio_processing (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/06_audio_processing.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">07_youtube (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/07_youtube.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">07_async_event_processing (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/07_async_event_processing.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">07_async_event_processing_implementation (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/07_async_event_processing_implementation.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">08_templates (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/08_templates.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">template_content_feature (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/template_content_feature.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">09_security (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/09_security.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">10_development_guidelines (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/10_development_guidelines.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">11_security (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/11_security.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">11_deployment (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/11_deployment.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">12_troubleshooting (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/12_troubleshooting.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">13_api_reference (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/13_api_reference.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">13_changelog (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/13_changelog.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">14_changelog (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/14_changelog.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">15_faq (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/15_faq.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">15_support (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/15_support.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">CommonSecretaryServicesAPI (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/CommonSecretaryServicesAPI.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">HowToUseimageocr (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/HowToUseimageocr.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">swagger_llm_ocr_integration (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/swagger_llm_ocr_integration.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">vimeo_support (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/vimeo_support.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">api-responses-concept (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/api-responses-concept.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">concept_storytelling_processor (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/concept_storytelling_processor.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dataclasses-types (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/dataclasses-types.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">events (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/events.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">generic_typing_improvements (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/generic_typing_improvements.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">historie</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/historie/</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">linting_strategy (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/linting_strategy.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">llm_ocr_configuration (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/llm_ocr_configuration.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">llm_ocr_integration (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/llm_ocr_integration.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">llm-optimierung (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/llm-optimierung.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">localbrain_architecture (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/localbrain_architecture.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metadata-concept (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/metadata-concept.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metaprocessor-* (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/metaprocessor-concept.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mongodb_caching_implementation (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/mongodb_caching_implementation.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">n8nEventsProcessing (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/n8nEventsProcessing.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">optimizeProzessWithBaseprocess (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/optimizeProzessWithBaseprocess.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">process_events (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/process_events.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">process-events-mongo-db (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/process-events-mongo-db.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ProcessorArchitecture (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/ProcessorArchitecture.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">refact-metaprocessor (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/refact-metaprocessor.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">scrape-notion (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/scrape-notion.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">session_archive_usage (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/session_archive_usage.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">storytelling (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/storytelling.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">template_content_feature (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/template_content_feature.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">testroutine (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/testroutine.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">track_processor (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/track_processor.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">track-processor-api (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/track-processor-api.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">transformer_mongodb_caching (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/transformer_mongodb_caching.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type-migration (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/type-migration.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">videoprocessor_typisierung (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/videoprocessor_typisierung.md</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">youtubeprocessor_typisierung (alt)</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_archive/youtubeprocessor_typisierung.md</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">&gt; </span><span class="ge">Zur Anwendung zurück: [/](\/)</span>

---
status: draft
<span class="gu">last_verified: 2025-08-15</span>
<span class="gu">---</span>

<span class="gh"># Common Secretary Services</span>

Willkommen zur Dokumentation. Dieses Projekt verarbeitet Medien (Audio, Video, PDF/Bilder) und erzeugt strukturierte Ergebnisse (Markdown/JSON) über eine REST‑API mit Flask‑RESTX.

<span class="gu">## Schnellstart</span>
```powershell
<span class="gh"># Windows</span>
venv\Scripts\activate
$env:PYTHONPATH = &quot;.&quot;
python src/main.py
</code></pre></div>
- Swagger UI: `http://127.0.0.1:5000/api/doc`
- OpenAPI JSON: `http://127.0.0.1:5000/api/swagger.json`

## Bereiche
- Guide
  - Getting Started → [Installation](guide/getting-started/installation.md), [Development](guide/getting-started/development.md)
  - How‑Tos → [Session‑Archive](guide/how-tos/session-archive.md)
  - UI → [Dashboard](guide/ui/dashboard.md)
- Explanations
  - Architektur → [Überblick](explanations/architecture/overview.md), [Details](explanations/architecture/details.md)
  - Async Events → [Überblick](explanations/async-events/overview.md), [n8n How‑To](explanations/async-events/how-to-n8n.md)
  - Caching → [Übersicht](explanations/caching/overview.md)
  - Templates → [Übersicht](explanations/templates/overview.md)
  - Typen → [Übersicht](explanations/types/overview.md)
  - Metaprocessor → [Überblick](explanations/metaprocessor/overview.md)
  - Metadaten → [Überblick](explanations/metadata/overview.md)
  - LLM → [Optimierung](explanations/llm/optimization.md)
- Processors
  - Audio → [Overview](processors/audio/overview.md)
  - Video → [Overview](processors/video/overview.md)
  - PDF → [Overview](processors/pdf/overview.md), [OCR‑Refactoring](processors/pdf/ocr-refactoring.md), [Endpoints](processors/pdf/endpoints.md)
  - Image‑OCR → [Overview](processors/image-ocr/overview.md)
  - Transformer → [Overview](processors/transformer/overview.md)
  - Session → [Overview](processors/session/overview.md)
  - Event‑Job → [Overview](processors/event-job/overview.md)
  - Story → [Overview](processors/story/overview.md)
  - Track → [Overview](processors/track/overview.md)
- Reference
  - API → [Überblick](reference/api/overview.md), [OpenAPI](reference/api/openapi.md)
- Ops → [Deployment](ops/deployment.md), [Sicherheit](ops/security.md), [Troubleshooting](ops/troubleshooting.md)
- Analysis → [Inventur](
  _analysis/docs_inventory.md), [Routes‑Index](_analysis/routes_index.md), [Drift‑Audit](_analysis/drift_audit.md)

## Response‑Standard (Kurz)
- `status` (success/error), `request`, `process`, `data`, `error`
- LLM‑Tracking: `process.llm_info`, Zeit in Millisekunden

Viel Erfolg!

```

Gut, wir entfernen die iframe-Variante (doppelte Scrollbar) und lassen MkDocs wieder nativ laufen. Dafür habe ich:

- Navbar „Docs“ wieder auf `/docs/` gesetzt.
- iframe-Route entfernt.
- In `mkdocs.yml` einen Top-Menüpunkt „« Zur Anwendung“ hinzugefügt, der auf `/` verweist.
- Zusätzlich auf der `docs/index.md` oben einen Rück-Link eingefügt.

Bitte einmal `mkdocs build -c -d site` ausführen, dann:
- App öffnen: `http://127.0.0.1:5001/`
- Doku: `http://127.0.0.1:5001/docs/`
- Rücksprung zur App über den neuen Link im MkDocs-Menü oder direkt oben auf der Startseite der Doku.

Kurz:
- Keine doppelte Scrollbar mehr.
- Persistenter Rückweg zur Anwendung in der Doku-Navigation.












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "In Zwischenablage kopiert", "clipboard.copy": "In Zwischenablage kopieren", "search.result.more.one": "1 weiteres Suchergebnis auf dieser Seite", "search.result.more.other": "# weitere Suchergebnisse auf dieser Seite", "search.result.none": "Keine Suchergebnisse", "search.result.one": "1 Suchergebnis", "search.result.other": "# Suchergebnisse", "search.result.placeholder": "Suchbegriff eingeben", "search.result.term.missing": "Es fehlt", "select.version": "Version ausw\u00e4hlen"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>