
<!doctype html>
<html lang="de" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://example.local/_historie/cursor_25.07.14_2_unterschied_zwischen_pdf_verarbe/">
      
      
      
      
      <link rel="icon" href="../../assets/images/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.17">
    
    
      
        <title>Unterschied zwischen PDF-Verarbeitungsmethoden - Common Secretary Services</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/print-site.css">
    
      <link rel="stylesheet" href="../../css/print-site-material.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#unterschied-zwischen-pdf-verarbeitungsmethoden" class="md-skip">
          Zum Inhalt
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Kopfzeile">
    <a href="../.." title="Common Secretary Services" class="md-header__button md-logo" aria-label="Common Secretary Services" data-md-component="logo">
      
  <img src="../../assets/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Common Secretary Services
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Unterschied zwischen PDF-Verarbeitungsmethoden
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Suche" placeholder="Suche" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Suche">
        
        <button type="reset" class="md-search__icon md-icon" title="Zurücksetzen" aria-label="Zurücksetzen" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Suche wird initialisiert
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://example.local/repo" title="Zum Repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Example
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Common Secretary Services" class="md-nav__button md-logo" aria-label="Common Secretary Services" data-md-component="logo">
      
  <img src="../../assets/images/logo.png" alt="logo">

    </a>
    Common Secretary Services
  </label>
  
    <div class="md-nav__source">
      <a href="https://example.local/repo" title="Zum Repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Example
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    « Zur Anwendung
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/getting-started/development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UI
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            UI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/ui/dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dashboard
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    How‑Tos
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            How‑Tos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/how-tos/session-archive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Session‑Archive
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Explanations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Explanations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architektur
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Architektur
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/architecture/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Überblick
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/architecture/details/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Details
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Async Events
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Async Events
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/async-events/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Überblick
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/async-events/generic-worker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generischer Worker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/async-events/secretary-job-worker-concept/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Secretary Job Worker – Konzept
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/async-events/how-to-n8n/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    n8n
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/caching/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Caching
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/templates/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Templates
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/types/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Typen & Dataclasses
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/metaprocessor/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metaprocessor
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/metadata/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metadaten
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanations/llm/optimization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLM‑Optimierung
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Processors
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Processors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/audio/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Audio
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/video/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Video
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    PDF
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            PDF
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/pdf/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Überblick
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/pdf/ocr-refactoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OCR-Refactoring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/pdf/endpoints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PDF/ImageOCR Details
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/image-ocr/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Image-OCR
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/transformer/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transformer
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/session/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Session
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/event-job/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Event-Job
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/story/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Story
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processors/track/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Track
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Überblick
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/openapi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI / Swagger
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ops
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Ops
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deployment
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sicherheit
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ops/troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Inhaltsverzeichnis">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Inhaltsverzeichnis
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#problem-analyse" class="md-nav__link">
    <span class="md-ellipsis">
      Problem-Analyse
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Problem-Analyse">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unterschiede-zwischen-den-methoden" class="md-nav__link">
    <span class="md-ellipsis">
      Unterschiede zwischen den Methoden:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#losung" class="md-nav__link">
    <span class="md-ellipsis">
      Lösung
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="unterschied-zwischen-pdf-verarbeitungsmethoden">Unterschied zwischen PDF-Verarbeitungsmethoden<a class="headerlink" href="#unterschied-zwischen-pdf-verarbeitungsmethoden" title="Permanent link">&para;</a></h1>
<p><em>Exported on 7/14/2025 at 17:37:32 GMT+2 from Cursor (1.2.4)</em></p>
<hr />
<p><strong>User</strong></p>
<p>Wenn ich dasselbe PDF einmal mit normaler Methode transformiere, dann ist hier im Result der ExtractedText und images_archive_data  Parameter gefüllt. Wenn ich es über LLM Methode transformiere, dann sind diese Felder@imageocr_processor.py  leer. Auch ImageArchiveData und ImageArchiveFileName ist leer. Wo liegt der Unterschied zwischen beiden Methoden? Bitte das Tippen der Bilder und das Archive nicht doppelt programmieren, sondern immer dieselben Komponenten wählen.
PDFProcessingResult(metadata=PDFMetadata(file_name='temp_c2a4de50-1238-49c4-bb81-ce8eb85575a1.pdf', file_size=71472, page_count=2, format='pdf', process_dir='cache\pdf\temp\pdf\4461b7909443786f1fc0d982fa1ebd41\llm', image_paths=[], preview_paths=[], preview_zip=None, text_paths=['/api/pdf/text-content/cache/pdf/temp/pdf/4461b7909443786f1fc0d982fa1ebd41/llm/page_001.txt', '/api/pdf/text-content/cache/pdf/temp/pdf/4461b7909443786f1fc0d982fa1ebd41/llm/page_002.txt'], original_text_paths=['cache\pdf\temp\pdf\4461b7909443786f1fc0d982fa1ebd41\llm\page_001.txt', 'cache\pdf\temp\pdf\4461b7909443786f1fc0d982fa1ebd41\llm\page_002.txt'], text_contents=[(1, '# Musterpraktiken aus "Frei, Fair und Lebendig"\n\nHier ist eine Tabelle, die die 30 Musterpraktiken aus dem Buch "Frei, Fair und Lebendig" den kapital- oder machtgetriebenen Praktiken gegenüberstellt:\n\n| Musterpraktik des Commoning               | Kapital- oder machtgetriebene Praktik                     |\n|-------------------------------------------|----------------------------------------------------------|\n| 1. Gemeinsam Werte schaffen                | Individueller Profit über Gemeinschaft stellen            |\n| 2. Ressourcen teilen und pflegen          | Ressourcen privatisieren und ausbeuten                   |\n| 3. Partizipative Entscheidungsfindung     | Autoritäre oder hierarchische Entscheidungen             |\n| 4. Transparenz fördern                     | Intransparenz und Informationskontrolle                  |\n| 5. Wissen offen teilen                     | Wissen monopolisieren, Patente und geistiges Eigentum horten |\n| 6. Soziale Bindungen stärken               | Soziale Isolation und Konkurrenz fördern                  |\n| 7. Vertrauen aufbauen                      | Misstrauen säen, Überwachung einsetzen                    |\n| 8. Nachhaltigkeit priorisieren             | Kurzfristige Gewinne über langfristige Nachhaltigkeit setzen |\n| 9. Gemeinsame Regeln aushandeln           | Einseitige Regelsetzung durch Machtpositionen            |\n| 10. Vielfalt und Inklusion fördern        | Homogenität und Exklusion praktizieren                   |\n| 11. Lokale Autonomie unterstützen          | Zentralisierung von Macht und Kontrolle                   |\n| 12. Gemeinsame Verantwortung übernehmen    | Verantwortung delegieren oder vermeiden                   |\n| 13. Konflikte kooperativ lösen            | Konflikte eskalieren oder unterdrücken                   |\n| 14. Soziale Gerechtigkeit anstreben       | Soziale Ungleichheiten akzeptieren oder vertiefen        |\n| 15. Ökologische Achtsamkeit               | Umweltverschmutzung ignorieren, externe Kosten externalisieren |\n| 16. Gemeinsame Infrastruktur nutzen und pflegen | Infrastruktur privatisieren, Zugang beschränken         |\n| 17. Kollektives Lernen fördern             | Bildung und Wissen elitär halten                          |\n\n<img alt="Tabelle der Musterpraktiken" src="placeholder.jpg" />'), (2, '# Wichtige Anforderungen\n\n1. <strong>Kreativität und Innovation kollektiv nutzen</strong>\n   - Innovation durch Wettbewerbsdruck kontrollieren\n\n2. <strong>Zeit und Raum für Reflexion schaffen</strong>\n   - Ständigen Druck und Zeitknappheit erzeugen\n\n3. <strong>Gegenseitige Hilfe und Solidarität</strong>\n   - Individualismus und Selbstinteresse betonen\n\n4. <strong>Flexibilität und Anpassungsfähigkeit</strong>\n   - Rigide Strukturen und Bürokratie aufrechterhalten\n\n5. <strong>Gemeinsame Rituale und Kultur pflegen</strong>\n   - Kulturelle Homogenisierung oder Kommerzialisierung\n\n6. <strong>Grenzen und Ressourcen respektieren</strong>\n   - Grenzen überschreiten, Ressourcen übernutzen\n\n7. <strong>Empowerment und Selbstwirksamkeit</strong>\n   - Abhängigkeiten schaffen, Entmündigung fördern\n\n8. <strong>Offene Kommunikation und Dialog</strong>\n   - Kommunikation kontrollieren, Zensur einsetzen\n\n9. <strong>Gemeinsame Visionen und Ziele entwickeln</strong>\n   - Einzelinteressen priorisieren, Gemeinwohl ignorieren\n\n10. <strong>Soziale Resilienz stärken</strong>\n    - Soziale Systeme anfällig machen durch Ungleichheit\n\n11. <strong>Teilen von Verantwortung und Rollen</strong>\n    - Machtkonzentration in wenigen Händen\n\n12. <strong>Peer-Monitoring und Feedback</strong>\n    - Externe Kontrolle, Überwachung und Misstrauen\n\n13. <strong>Feiern und Anerkennen gemeinsamer Erfolge</strong>\n    - Individuelle Leistungen hervorheben, Gemeinschaftserfolge ignorieren\n\n---\n\nDiese Tabelle illustriert, wie die Musterpraktiken des Commoning auf Kooperation, geteilte Verantwortung und gemeinschaftliche Werte abzielen, während kapital- oder machtgetriebene Praktiken oft durch Konkurrenz, Machtkonzentration und individuelle Profitorientierung gekennzeichnet sind. Durch diese Gegenüberstellung wird deutlich, dass Commoning eine Alternative bietet, die auf Nachhaltigkeit, Inklusion und gemeinschaftliches Wohlergehen fokussiert.')], extraction_method='llm'), extracted_text=None, ocr_text=None, process_id='eac6f1b7-d079-488f-961e-a374512436f7', processed_at='2025-07-14T12:37:04.699852+00:00', images_archive_data=None, images_archive_filename=None)</p>
<hr />
<p><strong>Cursor</strong></p>
<p>Ich analysiere das Problem mit den fehlenden Bildern und dem Archiv bei der LLM-Methode. Lass mich zuerst den Code untersuchen, um die Unterschiede zu verstehen.</p>
<p>Jetzt schaue ich mir die spezifischen Unterschiede zwischen den Extraktionsmethoden an:</p>
<p>Jetzt schaue ich mir die native Extraktionsmethode an, um den Unterschied zu verstehen:</p>
<p>Jetzt schaue ich mir an, wo das Bilder-Archiv erstellt wird:</p>
<p>Jetzt habe ich das Problem identifiziert! Lass mich die Unterschiede zwischen den Extraktionsmethoden analysieren:</p>
<h2 id="problem-analyse">Problem-Analyse<a class="headerlink" href="#problem-analyse" title="Permanent link">&para;</a></h2>
<p>Das Problem liegt daran, dass bei der <strong>LLM-Methode</strong> (<code>EXTRACTION_LLM</code>) <strong>keine Bilder generiert werden</strong>, während bei der <strong>nativen Methode</strong> (<code>EXTRACTION_NATIVE</code>) Bilder generiert werden.</p>
<h3 id="unterschiede-zwischen-den-methoden">Unterschiede zwischen den Methoden:<a class="headerlink" href="#unterschiede-zwischen-den-methoden" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Native Methode</strong> (<code>EXTRACTION_NATIVE</code>):</li>
<li>Generiert Hauptbilder mit <code>_generate_main_image()</code></li>
<li>Fügt Bilder zu <code>all_image_paths</code> und <code>metadata.image_paths</code> hinzu</li>
<li>
<p>Bilder werden später für das Archiv verwendet</p>
</li>
<li>
<p><strong>LLM-Methode</strong> (<code>EXTRACTION_LLM</code>):</p>
</li>
<li><strong>Generiert KEINE Bilder</strong> - nur Text-Extraktion</li>
<li>Keine Bildpfade in <code>metadata.image_paths</code></li>
<li>
<p>Daher kein Archiv möglich</p>
</li>
<li>
<p><strong>OCR-Methode</strong> (<code>EXTRACTION_OCR</code>):</p>
</li>
<li>Generiert Bilder für OCR-Verarbeitung</li>
<li>
<p>Fügt Bilder zu <code>metadata.image_paths</code> hinzu</p>
</li>
<li>
<p><strong>LLM_AND_OCR-Methode</strong> (<code>EXTRACTION_LLM_AND_OCR</code>):</p>
</li>
<li>Generiert Bilder für Tesseract OCR</li>
<li>Fügt Bilder zu <code>metadata.image_paths</code> hinzu</li>
</ol>
<h2 id="losung">Lösung<a class="headerlink" href="#losung" title="Permanent link">&para;</a></h2>
<p>Ich werde die LLM-Methode so erweitern, dass sie auch Bilder generiert, damit das Archiv erstellt werden kann. Die Bilder werden für die LLM-Verarbeitung benötigt, aber nicht gespeichert. Ich werde die bestehende Bildgenerierung wiederverwenden.</p>
<div class="highlight"><pre><span></span><code>                    <span class="k">if</span> <span class="n">EXTRACTION_LLM</span> <span class="ow">in</span> <span class="n">methods_list</span><span class="p">:</span>
                        <span class="c1"># LLM-basierte OCR mit Markdown-Output</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Generiere Hauptbild für LLM-Verarbeitung und Archiv</span>
                            <span class="n">image_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_main_image</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">page_num</span><span class="p">,</span> <span class="n">extraction_dir</span><span class="p">)</span>
                            <span class="n">all_image_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
                            <span class="n">metadata</span><span class="o">.</span><span class="n">image_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>

                            <span class="c1"># Erstelle erweiterten Prompt basierend auf Kontext</span>
                            <span class="n">custom_prompt</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
                                <span class="n">document_type</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;document_type&#39;</span><span class="p">)</span>
                                <span class="n">language</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="s1">&#39;de&#39;</span><span class="p">)</span>
                                <span class="n">custom_prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image2text_service</span><span class="o">.</span><span class="n">create_enhanced_prompt</span><span class="p">(</span>
                                    <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
                                    <span class="n">document_type</span><span class="o">=</span><span class="n">document_type</span><span class="p">,</span>
                                    <span class="n">language</span><span class="o">=</span><span class="n">language</span>
                                <span class="p">)</span>

                            <span class="c1"># LLM-OCR für diese Seite</span>
                            <span class="n">llm_text</span><span class="p">,</span> <span class="n">llm_request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image2text_service</span><span class="o">.</span><span class="n">extract_text_from_pdf_page</span><span class="p">(</span>
                                <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
                                <span class="n">page_num</span><span class="o">=</span><span class="n">page_num</span><span class="p">,</span>
                                <span class="n">custom_prompt</span><span class="o">=</span><span class="n">custom_prompt</span><span class="p">,</span>
                                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span>
                            <span class="p">)</span>

                            <span class="c1"># LLM-Request zum Tracking hinzufügen</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">add_llm_requests</span><span class="p">([</span><span class="n">llm_request</span><span class="p">])</span>

                            <span class="c1"># Text speichern</span>
                            <span class="n">text_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_page_text</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">llm_text</span><span class="p">,</span> <span class="n">page_num</span><span class="o">=</span><span class="n">page_num</span><span class="p">,</span> <span class="n">process_dir</span><span class="o">=</span><span class="n">extraction_dir</span><span class="p">)</span>

                            <span class="c1"># Metadaten aktualisieren</span>
                            <span class="n">text_paths_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">text_paths</span><span class="p">)</span>
                            <span class="n">text_paths_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">text_path</span><span class="p">))</span>

                            <span class="n">text_contents_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">text_contents</span><span class="p">)</span>
                            <span class="n">text_contents_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">page_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">llm_text</span><span class="p">))</span>

                            <span class="n">metadata</span> <span class="o">=</span> <span class="n">PDFMetadata</span><span class="p">(</span>
                                <span class="n">file_name</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span>
                                <span class="n">file_size</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_size</span><span class="p">,</span>
                                <span class="n">page_count</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">page_count</span><span class="p">,</span>
                                <span class="nb">format</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
                                <span class="n">process_dir</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">process_dir</span><span class="p">,</span>
                                <span class="n">image_paths</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_paths</span><span class="p">,</span>
                                <span class="n">preview_paths</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">preview_paths</span><span class="p">,</span>
                                <span class="n">preview_zip</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">preview_zip</span><span class="p">,</span>
                                <span class="n">text_paths</span><span class="o">=</span><span class="n">text_paths_list</span><span class="p">,</span>
                                <span class="n">text_contents</span><span class="o">=</span><span class="n">text_contents_list</span><span class="p">,</span>
                                <span class="n">extraction_method</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">extraction_method</span>
                            <span class="p">)</span>

                            <span class="c1"># Füge LLM-Text zum Gesamttext hinzu</span>
                            <span class="n">full_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> ---</span><span class="se">\n</span><span class="si">{</span><span class="n">llm_text</span><span class="si">}</span><span class="s2">&quot;</span>

                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LLM-OCR für Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> abgeschlossen&quot;</span><span class="p">)</span>

                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">llm_error</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler bei LLM-OCR für Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">llm_error</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="c1"># Fallback auf native Extraktion</span>
                            <span class="n">page_text_raw</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
                            <span class="n">page_text</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">page_text_raw</span><span class="p">)</span>
                            <span class="n">fallback_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;LLM-OCR fehlgeschlagen, Fallback auf native Extraktion:</span><span class="se">\n\n</span><span class="si">{</span><span class="n">page_text</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="n">full_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> ---</span><span class="se">\n</span><span class="si">{</span><span class="n">fallback_text</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>
<p>Jetzt muss ich auch die <code>EXTRACTION_LLM_AND_NATIVE</code> Methode erweitern, damit sie Bilder generiert:</p>
<div class="highlight"><pre><span></span><code>                    <span class="k">if</span> <span class="n">EXTRACTION_LLM_AND_NATIVE</span> <span class="ow">in</span> <span class="n">methods_list</span><span class="p">:</span>
                        <span class="c1"># Kombiniere LLM-OCR mit nativer Text-Extraktion</span>
                        <span class="c1"># Native Text-Extraktion</span>
                        <span class="n">page_text_raw</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
                        <span class="n">page_text</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">page_text_raw</span><span class="p">)</span>

                        <span class="c1"># Generiere Hauptbild für LLM-Verarbeitung und Archiv</span>
                        <span class="n">image_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_main_image</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">page_num</span><span class="p">,</span> <span class="n">extraction_dir</span><span class="p">)</span>
                        <span class="n">all_image_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
                        <span class="n">metadata</span><span class="o">.</span><span class="n">image_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>

                        <span class="c1"># LLM-OCR</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">custom_prompt</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
                                <span class="n">document_type</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;document_type&#39;</span><span class="p">)</span>
                                <span class="n">language</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="s1">&#39;de&#39;</span><span class="p">)</span>
                                <span class="n">custom_prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image2text_service</span><span class="o">.</span><span class="n">create_enhanced_prompt</span><span class="p">(</span>
                                    <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
                                    <span class="n">document_type</span><span class="o">=</span><span class="n">document_type</span><span class="p">,</span>
                                    <span class="n">language</span><span class="o">=</span><span class="n">language</span>
                                <span class="p">)</span>

                            <span class="n">llm_text</span><span class="p">,</span> <span class="n">llm_request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image2text_service</span><span class="o">.</span><span class="n">extract_text_from_pdf_page</span><span class="p">(</span>
                                <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
                                <span class="n">page_num</span><span class="o">=</span><span class="n">page_num</span><span class="p">,</span>
                                <span class="n">custom_prompt</span><span class="o">=</span><span class="n">custom_prompt</span><span class="p">,</span>
                                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span>
                            <span class="p">)</span>

                            <span class="c1"># LLM-Request zum Tracking hinzufügen</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">add_llm_requests</span><span class="p">([</span><span class="n">llm_request</span><span class="p">])</span>

                            <span class="c1"># Kombiniere beide Texte</span>
                            <span class="n">combined_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;=== Native Text ===</span><span class="se">\n</span><span class="si">{</span><span class="n">page_text</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">=== LLM Markdown ===</span><span class="se">\n</span><span class="si">{</span><span class="n">llm_text</span><span class="si">}</span><span class="s2">&quot;</span>

                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">llm_error</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler bei LLM-OCR für Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">llm_error</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">combined_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;=== Native Text ===</span><span class="se">\n</span><span class="si">{</span><span class="n">page_text</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">=== LLM-OCR Fehler ===</span><span class="se">\n</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">llm_error</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

                        <span class="c1"># Text speichern</span>
                        <span class="n">text_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_page_text</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">combined_text</span><span class="p">,</span> <span class="n">page_num</span><span class="o">=</span><span class="n">page_num</span><span class="p">,</span> <span class="n">process_dir</span><span class="o">=</span><span class="n">extraction_dir</span><span class="p">)</span>

                        <span class="c1"># Metadaten aktualisieren</span>
                        <span class="n">text_paths_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">text_paths</span><span class="p">)</span>
                        <span class="n">text_paths_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">text_path</span><span class="p">))</span>

                        <span class="n">text_contents_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">text_contents</span><span class="p">)</span>
                        <span class="n">text_contents_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">page_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">combined_text</span><span class="p">))</span>

                        <span class="n">metadata</span> <span class="o">=</span> <span class="n">PDFMetadata</span><span class="p">(</span>
                            <span class="n">file_name</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span>
                            <span class="n">file_size</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_size</span><span class="p">,</span>
                            <span class="n">page_count</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">page_count</span><span class="p">,</span>
                            <span class="nb">format</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
                            <span class="n">process_dir</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">process_dir</span><span class="p">,</span>
                            <span class="n">image_paths</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_paths</span><span class="p">,</span>
                            <span class="n">preview_paths</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">preview_paths</span><span class="p">,</span>
                            <span class="n">preview_zip</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">preview_zip</span><span class="p">,</span>
                            <span class="n">text_paths</span><span class="o">=</span><span class="n">text_paths_list</span><span class="p">,</span>
                            <span class="n">text_contents</span><span class="o">=</span><span class="n">text_contents_list</span><span class="p">,</span>
                            <span class="n">extraction_method</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">extraction_method</span>
                        <span class="p">)</span>

                        <span class="c1"># Füge kombinierten Text zum Gesamttext hinzu</span>
                        <span class="n">full_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> ---</span><span class="se">\n</span><span class="si">{</span><span class="n">combined_text</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>
<p>Jetzt muss ich auch das Problem mit dem <code>extracted_text</code> Feld beheben. Bei der LLM-Methode wird der Text in <code>full_text</code> gespeichert, aber das <code>extracted_text</code> Feld wird nur gesetzt, wenn <code>EXTRACTION_NATIVE</code> oder <code>EXTRACTION_BOTH</code> in der Methodenliste ist. Ich muss das erweitern:</p>
<p>Jetzt muss ich die Logik für das <code>extracted_text</code> Feld erweitern, damit es auch bei LLM-Methoden gesetzt wird:</p>
<div class="highlight"><pre><span></span><code>                <span class="c1"># Erstelle Endergebnis</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">PDFProcessingResult</span><span class="p">(</span>
                    <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                    <span class="n">extracted_text</span><span class="o">=</span><span class="n">result_text</span> <span class="k">if</span> <span class="p">(</span><span class="n">EXTRACTION_NATIVE</span> <span class="ow">in</span> <span class="n">methods_list</span> <span class="ow">or</span> 
                                                  <span class="n">EXTRACTION_BOTH</span> <span class="ow">in</span> <span class="n">methods_list</span> <span class="ow">or</span> 
                                                  <span class="n">EXTRACTION_LLM</span> <span class="ow">in</span> <span class="n">methods_list</span> <span class="ow">or</span> 
                                                  <span class="n">EXTRACTION_LLM_AND_NATIVE</span> <span class="ow">in</span> <span class="n">methods_list</span> <span class="ow">or</span> 
                                                  <span class="n">EXTRACTION_LLM_AND_OCR</span> <span class="ow">in</span> <span class="n">methods_list</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">ocr_text</span><span class="o">=</span><span class="n">ocr_text</span> <span class="k">if</span> <span class="n">EXTRACTION_OCR</span> <span class="ow">in</span> <span class="n">methods_list</span> <span class="ow">or</span> <span class="n">EXTRACTION_BOTH</span> <span class="ow">in</span> <span class="n">methods_list</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">process_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">process_id</span><span class="p">,</span>
                    <span class="n">images_archive_data</span><span class="o">=</span><span class="n">images_archive_data</span><span class="p">,</span>
                    <span class="n">images_archive_filename</span><span class="o">=</span><span class="n">images_archive_filename</span>
                <span class="p">)</span>
</code></pre></div>
<p>Jetzt muss ich auch die Linter-Fehler beheben, die durch die PyMuPDF-Typen entstehen:</p>
<div class="highlight"><pre><span></span><code>                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">llm_error</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler bei LLM-OCR für Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">llm_error</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="c1"># Fallback auf native Extraktion</span>
                            <span class="n">page_text_raw</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
                            <span class="n">page_text</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">page_text_raw</span><span class="p">)</span>
                            <span class="n">fallback_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;LLM-OCR fehlgeschlagen, Fallback auf native Extraktion:</span><span class="se">\n\n</span><span class="si">{</span><span class="n">page_text</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="n">full_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> ---</span><span class="se">\n</span><span class="si">{</span><span class="n">fallback_text</span><span class="si">}</span><span class="s2">&quot;</span>

                    <span class="k">if</span> <span class="n">EXTRACTION_LLM_AND_NATIVE</span> <span class="ow">in</span> <span class="n">methods_list</span><span class="p">:</span>
                        <span class="c1"># Kombiniere LLM-OCR mit nativer Text-Extraktion</span>
                        <span class="c1"># Native Text-Extraktion</span>
                        <span class="n">page_text_raw</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
                        <span class="n">page_text</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">page_text_raw</span><span class="p">)</span>
</code></pre></div>
<hr />
<p><strong>User</strong></p>
<p>Aber generiert jede Methode ihre eignen Bilder? können wir diese nicht zentralisieren? Die unterschiedliche Methode bezieht sich ja nur auf die Auswertung. Bilder brauchen wir in response unabhängig von Methode.</p>
<hr />
<p><strong>Cursor</strong></p>
<p>Sie haben absolut recht! Das ist eine sehr gute Beobachtung. Die Bildgenerierung sollte zentralisiert werden, da sie unabhängig von der Extraktionsmethode erfolgen sollte. Jede Methode generiert derzeit ihre eigenen Bilder, was zu Code-Duplikation und Inkonsistenz führt.</p>
<p>Lassen Sie mich das refaktorieren, um eine zentrale Bildgenerierung zu implementieren:</p>
<div class="highlight"><pre><span></span><code>                <span class="k">for</span> <span class="n">page_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">page_count</span><span class="p">):</span>
                    <span class="n">page</span> <span class="o">=</span> <span class="n">pdf</span><span class="p">[</span><span class="n">page_num</span><span class="p">]</span>  <span class="c1"># Zugriff auf PDF-Seite</span>
                    <span class="n">page_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

                    <span class="c1"># ZENTRALE BILDGENERIERUNG - unabhängig von der Extraktionsmethode</span>
                    <span class="c1"># Generiere Vorschaubilder, falls gewünscht</span>
                    <span class="k">if</span> <span class="n">EXTRACTION_PREVIEW</span> <span class="ow">in</span> <span class="n">methods_list</span> <span class="ow">or</span> <span class="n">EXTRACTION_PREVIEW_AND_NATIVE</span> <span class="ow">in</span> <span class="n">methods_list</span><span class="p">:</span>
                        <span class="c1"># Vorschaubilder generieren</span>
                        <span class="n">preview_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_preview_image</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">page_num</span><span class="p">,</span> <span class="n">extraction_dir</span><span class="p">)</span>
                        <span class="n">all_preview_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preview_path</span><span class="p">)</span>
                        <span class="n">metadata</span><span class="o">.</span><span class="n">preview_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preview_path</span><span class="p">)</span>

                    <span class="c1"># Generiere Hauptbilder für alle Methoden (wird für Archiv und Visualisierung benötigt)</span>
                    <span class="n">image_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_main_image</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="n">page_num</span><span class="p">,</span> <span class="n">extraction_dir</span><span class="p">)</span>
                    <span class="n">all_image_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>
                    <span class="n">metadata</span><span class="o">.</span><span class="n">image_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span>

                    <span class="c1"># Verarbeite jede gewünschte Extraktionsmethode</span>
                    <span class="k">if</span> <span class="n">EXTRACTION_NATIVE</span> <span class="ow">in</span> <span class="n">methods_list</span> <span class="ow">or</span> <span class="n">EXTRACTION_PREVIEW_AND_NATIVE</span> <span class="ow">in</span> <span class="n">methods_list</span><span class="p">:</span>
                        <span class="c1"># Native Text-Extraktion</span>
                        <span class="n">page_text_raw</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>  <span class="c1"># type: ignore # PyMuPDF Methode</span>
                        <span class="n">page_text</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">page_text_raw</span><span class="p">)</span>
                        <span class="n">full_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> ---</span><span class="se">\n</span><span class="si">{</span><span class="n">page_text</span><span class="si">}</span><span class="s2">&quot;</span>

                        <span class="c1"># Textdaten speichern</span>
                        <span class="n">text_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_page_text</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">page_text</span><span class="p">,</span> <span class="n">page_num</span><span class="o">=</span><span class="n">page_num</span><span class="p">,</span> <span class="n">process_dir</span><span class="o">=</span><span class="n">extraction_dir</span><span class="p">)</span>

                        <span class="c1"># Da PDFMetadata jetzt unveränderlich ist, sammeln wir die Inhalte in temporären Listen</span>
                        <span class="n">text_paths_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">text_paths</span><span class="p">)</span>
                        <span class="n">text_paths_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">text_path</span><span class="p">))</span>

                        <span class="n">text_contents_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">text_contents</span><span class="p">)</span>
                        <span class="n">text_contents_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">page_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">page_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)))</span>

                        <span class="c1"># Neue PDFMetadata-Instanz erstellen mit aktualisierten text_contents und text_paths</span>
                        <span class="n">metadata</span> <span class="o">=</span> <span class="n">PDFMetadata</span><span class="p">(</span>
                            <span class="n">file_name</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span>
                            <span class="n">file_size</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_size</span><span class="p">,</span>
                            <span class="n">page_count</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">page_count</span><span class="p">,</span>
                            <span class="nb">format</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
                            <span class="n">process_dir</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">process_dir</span><span class="p">,</span>
                            <span class="n">image_paths</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_paths</span><span class="p">,</span>
                            <span class="n">preview_paths</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">preview_paths</span><span class="p">,</span>
                            <span class="n">preview_zip</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">preview_zip</span><span class="p">,</span>
                            <span class="n">text_paths</span><span class="o">=</span><span class="n">text_paths_list</span><span class="p">,</span>
                            <span class="n">text_contents</span><span class="o">=</span><span class="n">text_contents_list</span><span class="p">,</span>
                            <span class="n">extraction_method</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">extraction_method</span>
                        <span class="p">)</span>

                    <span class="k">if</span> <span class="n">EXTRACTION_OCR</span> <span class="ow">in</span> <span class="n">methods_list</span><span class="p">:</span>
                        <span class="c1"># OCR durchführen - verwende das bereits generierte Hauptbild</span>
                        <span class="c1"># OCR mit ImageOCR Processor (nutzt Caching)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Verwende den ImageOCR Processor für OCR mit Caching</span>
                            <span class="n">ocr_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageocr_processor</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
                                <span class="n">file_path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">image_path</span><span class="p">),</span>  <span class="c1"># Verwende das bereits generierte Bild</span>
                                <span class="n">template</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># Kein Template für PDF-Seiten</span>
                                <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
                                <span class="n">extraction_method</span><span class="o">=</span><span class="s2">&quot;ocr&quot;</span><span class="p">,</span>
                                <span class="n">use_cache</span><span class="o">=</span><span class="n">use_cache</span><span class="p">,</span>  <span class="c1"># Cache-Nutzung vom PDF-Processor übernehmen</span>
                                <span class="n">file_hash</span><span class="o">=</span><span class="kc">None</span>  <span class="c1"># Hash wird vom ImageOCR Processor berechnet</span>
                            <span class="p">)</span>

                            <span class="k">if</span> <span class="n">ocr_result</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="n">ocr_result</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">extracted_text</span><span class="p">:</span>
                                <span class="n">page_ocr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ocr_result</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">extracted_text</span><span class="p">)</span>

                                <span class="c1"># OCR-Text speichern</span>
                                <span class="n">text_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_page_text</span><span class="p">(</span><span class="n">page_ocr</span><span class="p">,</span> <span class="n">page_num</span><span class="p">,</span> <span class="n">extraction_dir</span><span class="p">)</span>

                                <span class="c1"># Da PDFMetadata jetzt unveränderlich ist, müssen wir eine neue Instanz erstellen</span>
                                <span class="n">text_paths_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">text_paths</span><span class="p">)</span>
                                <span class="n">text_paths_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">text_path</span><span class="p">))</span>

                                <span class="n">text_contents_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">text_contents</span><span class="p">)</span>
                                <span class="n">text_contents_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">page_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">page_ocr</span><span class="p">))</span>

                                <span class="n">metadata</span> <span class="o">=</span> <span class="n">PDFMetadata</span><span class="p">(</span>
                                    <span class="n">file_name</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span>
                                    <span class="n">file_size</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_size</span><span class="p">,</span>
                                    <span class="n">page_count</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">page_count</span><span class="p">,</span>
                                    <span class="nb">format</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
                                    <span class="n">process_dir</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">process_dir</span><span class="p">,</span>
                                    <span class="n">image_paths</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_paths</span><span class="p">,</span>
                                    <span class="n">preview_paths</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">preview_paths</span><span class="p">,</span>
                                    <span class="n">preview_zip</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">preview_zip</span><span class="p">,</span>
                                    <span class="n">text_paths</span><span class="o">=</span><span class="n">text_paths_list</span><span class="p">,</span>
                                    <span class="n">text_contents</span><span class="o">=</span><span class="n">text_contents_list</span><span class="p">,</span>
                                    <span class="n">extraction_method</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">extraction_method</span>
                                <span class="p">)</span>

                                <span class="n">ocr_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> ---</span><span class="se">\n</span><span class="si">{</span><span class="n">page_ocr</span><span class="si">}</span><span class="s2">&quot;</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OCR für Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> mit ImageOCR Processor abgeschlossen&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Kein OCR-Text für Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> extrahiert&quot;</span><span class="p">)</span>
                                <span class="n">page_ocr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ocr_error</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler bei OCR für Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">ocr_error</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">page_ocr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                    <span class="k">if</span> <span class="n">EXTRACTION_LLM</span> <span class="ow">in</span> <span class="n">methods_list</span><span class="p">:</span>
                        <span class="c1"># LLM-basierte OCR mit Markdown-Output</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Erstelle erweiterten Prompt basierend auf Kontext</span>
                            <span class="n">custom_prompt</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
                                <span class="n">document_type</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;document_type&#39;</span><span class="p">)</span>
                                <span class="n">language</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="s1">&#39;de&#39;</span><span class="p">)</span>
                                <span class="n">custom_prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image2text_service</span><span class="o">.</span><span class="n">create_enhanced_prompt</span><span class="p">(</span>
                                    <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
                                    <span class="n">document_type</span><span class="o">=</span><span class="n">document_type</span><span class="p">,</span>
                                    <span class="n">language</span><span class="o">=</span><span class="n">language</span>
                                <span class="p">)</span>

                            <span class="c1"># LLM-OCR für diese Seite</span>
                            <span class="n">llm_text</span><span class="p">,</span> <span class="n">llm_request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image2text_service</span><span class="o">.</span><span class="n">extract_text_from_pdf_page</span><span class="p">(</span>
                                <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
                                <span class="n">page_num</span><span class="o">=</span><span class="n">page_num</span><span class="p">,</span>
                                <span class="n">custom_prompt</span><span class="o">=</span><span class="n">custom_prompt</span><span class="p">,</span>
                                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span>
                            <span class="p">)</span>

                            <span class="c1"># LLM-Request zum Tracking hinzufügen</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">add_llm_requests</span><span class="p">([</span><span class="n">llm_request</span><span class="p">])</span>

                            <span class="c1"># Text speichern</span>
                            <span class="n">text_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_page_text</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">llm_text</span><span class="p">,</span> <span class="n">page_num</span><span class="o">=</span><span class="n">page_num</span><span class="p">,</span> <span class="n">process_dir</span><span class="o">=</span><span class="n">extraction_dir</span><span class="p">)</span>

                            <span class="c1"># Metadaten aktualisieren</span>
                            <span class="n">text_paths_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">text_paths</span><span class="p">)</span>
                            <span class="n">text_paths_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">text_path</span><span class="p">))</span>

                            <span class="n">text_contents_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">text_contents</span><span class="p">)</span>
                            <span class="n">text_contents_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">page_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">llm_text</span><span class="p">))</span>

                            <span class="n">metadata</span> <span class="o">=</span> <span class="n">PDFMetadata</span><span class="p">(</span>
                                <span class="n">file_name</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span>
                                <span class="n">file_size</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_size</span><span class="p">,</span>
                                <span class="n">page_count</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">page_count</span><span class="p">,</span>
                                <span class="nb">format</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
                                <span class="n">process_dir</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">process_dir</span><span class="p">,</span>
                                <span class="n">image_paths</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_paths</span><span class="p">,</span>
                                <span class="n">preview_paths</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">preview_paths</span><span class="p">,</span>
                                <span class="n">preview_zip</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">preview_zip</span><span class="p">,</span>
                                <span class="n">text_paths</span><span class="o">=</span><span class="n">text_paths_list</span><span class="p">,</span>
                                <span class="n">text_contents</span><span class="o">=</span><span class="n">text_contents_list</span><span class="p">,</span>
                                <span class="n">extraction_method</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">extraction_method</span>
                            <span class="p">)</span>

                            <span class="c1"># Füge LLM-Text zum Gesamttext hinzu</span>
                            <span class="n">full_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> ---</span><span class="se">\n</span><span class="si">{</span><span class="n">llm_text</span><span class="si">}</span><span class="s2">&quot;</span>

                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LLM-OCR für Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> abgeschlossen&quot;</span><span class="p">)</span>

                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">llm_error</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler bei LLM-OCR für Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">llm_error</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="c1"># Fallback auf native Extraktion</span>
                            <span class="n">page_text_raw</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>  <span class="c1"># type: ignore # PyMuPDF Methode</span>
                            <span class="n">page_text</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">page_text_raw</span><span class="p">)</span>
                            <span class="n">fallback_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;LLM-OCR fehlgeschlagen, Fallback auf native Extraktion:</span><span class="se">\n\n</span><span class="si">{</span><span class="n">page_text</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="n">full_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> ---</span><span class="se">\n</span><span class="si">{</span><span class="n">fallback_text</span><span class="si">}</span><span class="s2">&quot;</span>

                    <span class="k">if</span> <span class="n">EXTRACTION_LLM_AND_NATIVE</span> <span class="ow">in</span> <span class="n">methods_list</span><span class="p">:</span>
                        <span class="c1"># Kombiniere LLM-OCR mit nativer Text-Extraktion</span>
                        <span class="c1"># Native Text-Extraktion</span>
                        <span class="n">page_text_raw</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>  <span class="c1"># type: ignore # PyMuPDF Methode</span>
                        <span class="n">page_text</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">page_text_raw</span><span class="p">)</span>

                        <span class="c1"># LLM-OCR</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">custom_prompt</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
                                <span class="n">document_type</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;document_type&#39;</span><span class="p">)</span>
                                <span class="n">language</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="s1">&#39;de&#39;</span><span class="p">)</span>
                                <span class="n">custom_prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image2text_service</span><span class="o">.</span><span class="n">create_enhanced_prompt</span><span class="p">(</span>
                                    <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
                                    <span class="n">document_type</span><span class="o">=</span><span class="n">document_type</span><span class="p">,</span>
                                    <span class="n">language</span><span class="o">=</span><span class="n">language</span>
                                <span class="p">)</span>

                            <span class="n">llm_text</span><span class="p">,</span> <span class="n">llm_request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image2text_service</span><span class="o">.</span><span class="n">extract_text_from_pdf_page</span><span class="p">(</span>
                                <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
                                <span class="n">page_num</span><span class="o">=</span><span class="n">page_num</span><span class="p">,</span>
                                <span class="n">custom_prompt</span><span class="o">=</span><span class="n">custom_prompt</span><span class="p">,</span>
                                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span>
                            <span class="p">)</span>

                            <span class="c1"># LLM-Request zum Tracking hinzufügen</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">add_llm_requests</span><span class="p">([</span><span class="n">llm_request</span><span class="p">])</span>

                            <span class="c1"># Kombiniere beide Texte</span>
                            <span class="n">combined_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;=== Native Text ===</span><span class="se">\n</span><span class="si">{</span><span class="n">page_text</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">=== LLM Markdown ===</span><span class="se">\n</span><span class="si">{</span><span class="n">llm_text</span><span class="si">}</span><span class="s2">&quot;</span>

                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">llm_error</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler bei LLM-OCR für Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">llm_error</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">combined_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;=== Native Text ===</span><span class="se">\n</span><span class="si">{</span><span class="n">page_text</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">=== LLM-OCR Fehler ===</span><span class="se">\n</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">llm_error</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

                        <span class="c1"># Text speichern</span>
                        <span class="n">text_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_page_text</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">combined_text</span><span class="p">,</span> <span class="n">page_num</span><span class="o">=</span><span class="n">page_num</span><span class="p">,</span> <span class="n">process_dir</span><span class="o">=</span><span class="n">extraction_dir</span><span class="p">)</span>

                        <span class="c1"># Metadaten aktualisieren</span>
                        <span class="n">text_paths_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">text_paths</span><span class="p">)</span>
                        <span class="n">text_paths_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">text_path</span><span class="p">))</span>

                        <span class="n">text_contents_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">text_contents</span><span class="p">)</span>
                        <span class="n">text_contents_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">page_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">combined_text</span><span class="p">))</span>

                        <span class="n">metadata</span> <span class="o">=</span> <span class="n">PDFMetadata</span><span class="p">(</span>
                            <span class="n">file_name</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span>
                            <span class="n">file_size</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_size</span><span class="p">,</span>
                            <span class="n">page_count</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">page_count</span><span class="p">,</span>
                            <span class="nb">format</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
                            <span class="n">process_dir</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">process_dir</span><span class="p">,</span>
                            <span class="n">image_paths</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_paths</span><span class="p">,</span>
                            <span class="n">preview_paths</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">preview_paths</span><span class="p">,</span>
                            <span class="n">preview_zip</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">preview_zip</span><span class="p">,</span>
                            <span class="n">text_paths</span><span class="o">=</span><span class="n">text_paths_list</span><span class="p">,</span>
                            <span class="n">text_contents</span><span class="o">=</span><span class="n">text_contents_list</span><span class="p">,</span>
                            <span class="n">extraction_method</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">extraction_method</span>
                        <span class="p">)</span>

                        <span class="c1"># Füge kombinierten Text zum Gesamttext hinzu</span>
                        <span class="n">full_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> ---</span><span class="se">\n</span><span class="si">{</span><span class="n">combined_text</span><span class="si">}</span><span class="s2">&quot;</span>

                    <span class="k">if</span> <span class="n">EXTRACTION_LLM_AND_OCR</span> <span class="ow">in</span> <span class="n">methods_list</span><span class="p">:</span>
                        <span class="c1"># Kombiniere LLM-OCR mit Tesseract OCR</span>
                        <span class="n">llm_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">tesseract_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                        <span class="c1"># LLM-OCR</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">custom_prompt</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
                                <span class="n">document_type</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;document_type&#39;</span><span class="p">)</span>
                                <span class="n">language</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="s1">&#39;de&#39;</span><span class="p">)</span>
                                <span class="n">custom_prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image2text_service</span><span class="o">.</span><span class="n">create_enhanced_prompt</span><span class="p">(</span>
                                    <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
                                    <span class="n">document_type</span><span class="o">=</span><span class="n">document_type</span><span class="p">,</span>
                                    <span class="n">language</span><span class="o">=</span><span class="n">language</span>
                                <span class="p">)</span>

                            <span class="n">llm_text</span><span class="p">,</span> <span class="n">llm_request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image2text_service</span><span class="o">.</span><span class="n">extract_text_from_pdf_page</span><span class="p">(</span>
                                <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
                                <span class="n">page_num</span><span class="o">=</span><span class="n">page_num</span><span class="p">,</span>
                                <span class="n">custom_prompt</span><span class="o">=</span><span class="n">custom_prompt</span><span class="p">,</span>
                                <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span>
                            <span class="p">)</span>

                            <span class="c1"># LLM-Request zum Tracking hinzufügen</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">add_llm_requests</span><span class="p">([</span><span class="n">llm_request</span><span class="p">])</span>

                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">llm_error</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler bei LLM-OCR für Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">llm_error</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">llm_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;LLM-OCR Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">llm_error</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

                        <span class="c1"># Tesseract OCR - verwende das bereits generierte Hauptbild</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">ocr_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageocr_processor</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
                                <span class="n">file_path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">image_path</span><span class="p">),</span>  <span class="c1"># Verwende das bereits generierte Bild</span>
                                <span class="n">template</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
                                <span class="n">extraction_method</span><span class="o">=</span><span class="s2">&quot;ocr&quot;</span><span class="p">,</span>
                                <span class="n">use_cache</span><span class="o">=</span><span class="n">use_cache</span><span class="p">,</span>
                                <span class="n">file_hash</span><span class="o">=</span><span class="kc">None</span>
                            <span class="p">)</span>

                            <span class="k">if</span> <span class="n">ocr_result</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="n">ocr_result</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">extracted_text</span><span class="p">:</span>
                                <span class="n">tesseract_text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ocr_result</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">extracted_text</span><span class="p">)</span>

                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ocr_error</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler bei Tesseract OCR für Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">ocr_error</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">tesseract_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Tesseract OCR Fehler: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">ocr_error</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

                        <span class="c1"># Kombiniere beide OCR-Ergebnisse</span>
                        <span class="n">combined_ocr_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;=== LLM Markdown ===</span><span class="se">\n</span><span class="si">{</span><span class="n">llm_text</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">=== Tesseract OCR ===</span><span class="se">\n</span><span class="si">{</span><span class="n">tesseract_text</span><span class="si">}</span><span class="s2">&quot;</span>

                        <span class="c1"># Text speichern</span>
                        <span class="n">text_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_page_text</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">combined_ocr_text</span><span class="p">,</span> <span class="n">page_num</span><span class="o">=</span><span class="n">page_num</span><span class="p">,</span> <span class="n">process_dir</span><span class="o">=</span><span class="n">extraction_dir</span><span class="p">)</span>

                        <span class="c1"># Metadaten aktualisieren</span>
                        <span class="n">text_paths_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">text_paths</span><span class="p">)</span>
                        <span class="n">text_paths_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">text_path</span><span class="p">))</span>

                        <span class="n">text_contents_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">text_contents</span><span class="p">)</span>
                        <span class="n">text_contents_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">page_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">combined_ocr_text</span><span class="p">))</span>

                        <span class="n">metadata</span> <span class="o">=</span> <span class="n">PDFMetadata</span><span class="p">(</span>
                            <span class="n">file_name</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span>
                            <span class="n">file_size</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_size</span><span class="p">,</span>
                            <span class="n">page_count</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">page_count</span><span class="p">,</span>
                            <span class="nb">format</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
                            <span class="n">process_dir</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">process_dir</span><span class="p">,</span>
                            <span class="n">image_paths</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_paths</span><span class="p">,</span>
                            <span class="n">preview_paths</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">preview_paths</span><span class="p">,</span>
                            <span class="n">preview_zip</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">preview_zip</span><span class="p">,</span>
                            <span class="n">text_paths</span><span class="o">=</span><span class="n">text_paths_list</span><span class="p">,</span>
                            <span class="n">text_contents</span><span class="o">=</span><span class="n">text_contents_list</span><span class="p">,</span>
                            <span class="n">extraction_method</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">extraction_method</span>
                        <span class="p">)</span>

                        <span class="c1"># Füge kombinierten Text zum OCR-Text hinzu</span>
                        <span class="n">ocr_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> ---</span><span class="se">\n</span><span class="si">{</span><span class="n">combined_ocr_text</span><span class="si">}</span><span class="s2">&quot;</span>

                    <span class="k">if</span> <span class="n">EXTRACTION_BOTH</span> <span class="ow">in</span> <span class="n">methods_list</span><span class="p">:</span>
                        <span class="c1"># Beide Extraktionsmethoden (native + OCR)</span>
                        <span class="c1"># Native Text-Extraktion</span>
                        <span class="n">page_text_raw</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>  <span class="c1"># type: ignore # PyMuPDF Methode</span>
                        <span class="n">page_text</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">page_text_raw</span><span class="p">)</span>
                        <span class="n">full_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> ---</span><span class="se">\n</span><span class="si">{</span><span class="n">page_text</span><span class="si">}</span><span class="s2">&quot;</span>

                        <span class="c1"># Textdaten speichern</span>
                        <span class="n">text_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_page_text</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">page_text</span><span class="p">,</span> <span class="n">page_num</span><span class="o">=</span><span class="n">page_num</span><span class="p">,</span> <span class="n">process_dir</span><span class="o">=</span><span class="n">extraction_dir</span><span class="p">)</span>

                        <span class="c1"># Da PDFMetadata jetzt unveränderlich ist, sammeln wir die Inhalte in temporären Listen</span>
                        <span class="n">text_paths_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">text_paths</span><span class="p">)</span>
                        <span class="n">text_paths_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">text_path</span><span class="p">))</span>

                        <span class="n">text_contents_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">text_contents</span><span class="p">)</span>
                        <span class="n">text_contents_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">page_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">page_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)))</span>

                        <span class="c1"># Neue PDFMetadata-Instanz erstellen mit aktualisierten text_contents und text_paths</span>
                        <span class="n">metadata</span> <span class="o">=</span> <span class="n">PDFMetadata</span><span class="p">(</span>
                            <span class="n">file_name</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span>
                            <span class="n">file_size</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_size</span><span class="p">,</span>
                            <span class="n">page_count</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">page_count</span><span class="p">,</span>
                            <span class="nb">format</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
                            <span class="n">process_dir</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">process_dir</span><span class="p">,</span>
                            <span class="n">image_paths</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_paths</span><span class="p">,</span>
                            <span class="n">preview_paths</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">preview_paths</span><span class="p">,</span>
                            <span class="n">preview_zip</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">preview_zip</span><span class="p">,</span>
                            <span class="n">text_paths</span><span class="o">=</span><span class="n">text_paths_list</span><span class="p">,</span>
                            <span class="n">text_contents</span><span class="o">=</span><span class="n">text_contents_list</span><span class="p">,</span>
                            <span class="n">extraction_method</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">extraction_method</span>
                        <span class="p">)</span>

                        <span class="c1"># OCR mit ImageOCR Processor (nutzt Caching) - verwende das bereits generierte Hauptbild</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Verwende den ImageOCR Processor für OCR mit Caching</span>
                            <span class="n">ocr_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageocr_processor</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
                                <span class="n">file_path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">image_path</span><span class="p">),</span>  <span class="c1"># Verwende das bereits generierte Bild</span>
                                <span class="n">template</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># Kein Template für PDF-Seiten</span>
                                <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
                                <span class="n">extraction_method</span><span class="o">=</span><span class="s2">&quot;ocr&quot;</span><span class="p">,</span>
                                <span class="n">use_cache</span><span class="o">=</span><span class="n">use_cache</span><span class="p">,</span>  <span class="c1"># Cache-Nutzung vom PDF-Processor übernehmen</span>
                                <span class="n">file_hash</span><span class="o">=</span><span class="kc">None</span>  <span class="c1"># Hash wird vom ImageOCR Processor berechnet</span>
                            <span class="p">)</span>

                            <span class="k">if</span> <span class="n">ocr_result</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="n">ocr_result</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">extracted_text</span><span class="p">:</span>
                                <span class="n">page_ocr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ocr_result</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">extracted_text</span><span class="p">)</span>

                                <span class="c1"># OCR-Text speichern</span>
                                <span class="n">text_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_page_text</span><span class="p">(</span><span class="n">page_ocr</span><span class="p">,</span> <span class="n">page_num</span><span class="p">,</span> <span class="n">extraction_dir</span><span class="p">)</span>

                                <span class="c1"># Da PDFMetadata jetzt unveränderlich ist, müssen wir eine neue Instanz erstellen</span>
                                <span class="n">text_paths_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">text_paths</span><span class="p">)</span>
                                <span class="n">text_paths_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">text_path</span><span class="p">))</span>

                                <span class="n">text_contents_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">text_contents</span><span class="p">)</span>
                                <span class="n">text_contents_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">page_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">page_ocr</span><span class="p">))</span>

                                <span class="n">metadata</span> <span class="o">=</span> <span class="n">PDFMetadata</span><span class="p">(</span>
                                    <span class="n">file_name</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span>
                                    <span class="n">file_size</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">file_size</span><span class="p">,</span>
                                    <span class="n">page_count</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">page_count</span><span class="p">,</span>
                                    <span class="nb">format</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
                                    <span class="n">process_dir</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">process_dir</span><span class="p">,</span>
                                    <span class="n">image_paths</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">image_paths</span><span class="p">,</span>
                                    <span class="n">preview_paths</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">preview_paths</span><span class="p">,</span>
                                    <span class="n">preview_zip</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">preview_zip</span><span class="p">,</span>
                                    <span class="n">text_paths</span><span class="o">=</span><span class="n">text_paths_list</span><span class="p">,</span>
                                    <span class="n">text_contents</span><span class="o">=</span><span class="n">text_contents_list</span><span class="p">,</span>
                                    <span class="n">extraction_method</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">extraction_method</span>
                                <span class="p">)</span>

                                <span class="n">ocr_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> ---</span><span class="se">\n</span><span class="si">{</span><span class="n">page_ocr</span><span class="si">}</span><span class="s2">&quot;</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OCR für Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> mit ImageOCR Processor abgeschlossen&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Kein OCR-Text für Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> extrahiert&quot;</span><span class="p">)</span>
                                <span class="n">page_ocr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ocr_error</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler bei OCR für Seite </span><span class="si">{</span><span class="n">page_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">ocr_error</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">page_ocr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                    <span class="c1"># Logging</span>
                    <span class="n">page_duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">page_start</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Seite </span><span class="si">{</span><span class="n">page_num</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> verarbeitet&quot;</span><span class="p">,</span>
                                    <span class="n">duration</span><span class="o">=</span><span class="n">page_duration</span><span class="p">,</span>
                                    <span class="n">extraction_methods</span><span class="o">=</span><span class="n">methods_list</span><span class="p">)</span>
</code></pre></div>
<p>Perfekt! Jetzt habe ich die Bildgenerierung zentralisiert. Lassen Sie mich auch die Linter-Fehler beheben, indem ich die PyMuPDF-Typen korrekt behandle:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># PyMuPDF Typendefinitionen für den Linter</span>
<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">FitzPage</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Typ-Definitionen für PyMuPDF Page-Objekte.&quot;&quot;&quot;</span>
        <span class="n">rect</span><span class="p">:</span> <span class="n">Any</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">get_text</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="o">...</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">get_pixmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;FitzPixmap&#39;</span><span class="p">:</span> <span class="o">...</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">FitzPixmap</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Typ-Definitionen für PyMuPDF Pixmap-Objekte.&quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">jpg_quality</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">80</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="c1"># Typ-Aliase für bessere Linter-Unterstützung</span>
<span class="n">FitzPageType</span> <span class="o">=</span> <span class="n">Any</span>  <span class="c1"># type: ignore</span>
<span class="n">FitzPixmapType</span> <span class="o">=</span> <span class="n">Any</span>  <span class="c1"># type: ignore</span>
</code></pre></div>
<p>Jetzt teste ich die Änderungen, um sicherzustellen, dass alles funktioniert:</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "In Zwischenablage kopiert", "clipboard.copy": "In Zwischenablage kopieren", "search.result.more.one": "1 weiteres Suchergebnis auf dieser Seite", "search.result.more.other": "# weitere Suchergebnisse auf dieser Seite", "search.result.none": "Keine Suchergebnisse", "search.result.one": "1 Suchergebnis", "search.result.other": "# Suchergebnisse", "search.result.placeholder": "Suchbegriff eingeben", "search.result.term.missing": "Es fehlt", "select.version": "Version ausw\u00e4hlen"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="../../js/print-site.js"></script>
      
        <script src="https://unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
      
        <script src="../../assets/js/mermaid-init.js"></script>
      
    
  </body>
</html>